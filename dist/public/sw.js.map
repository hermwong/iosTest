{"version":3,"sources":["node_modules/browser-pack/_prelude.js","public/js/sw/index.js","node_modules/process/browser.js","node_modules/regenerator-runtime/runtime.js","node_modules/regenerator/runtime.js","node_modules/serviceworker-cache-polyfill/index.js","node_modules/srcset/srcset.js","public/js/shared/indexeddouchbag.js","public/js/shared/storage.js","public/js/shared/wikipedia.js"],"names":[],"mappings":"AAAA;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACpNA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC1DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AChqBA;AACA;AACA;AACA;AACA;AACA;AACA;;ACNA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC7DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC7EA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACnGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACxCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"sw.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","'use strict';\n\nvar _this = this;\n\nrequire('regenerator/runtime');\nrequire('serviceworker-cache-polyfill');\nvar wikipedia = require('../shared/wikipedia');\nvar storage = require('../shared/storage');\n\nvar version = '24';\nvar prefix = 'wikioffline';\nvar staticCacheName = prefix + '-static-v' + version;\n\nself.addEventListener('install', function (event) {\n  event.waitUntil(caches.open(staticCacheName).then(function (cache) {\n    return cache.addAll(['/', '/shell.html', '/js/page.js', '/js/page-framework.js', // yeahhhh, we're caching waayyyyy more than we need, but keeps the request tests fair\n    '/css/head-wiki.css', // don't need this when it's inlined, but helps when rendered with blocking CSS in settings\n    '/css/wiki.css']).then(function () {\n      return cache.match('/shell.html');\n    }).then(function (response) {\n      // bit hacky, making the shell start & end from the shell just fetched\n      return response.text().then(function (text) {\n        var headerEnd = text.indexOf('<div class=\"article-header subheading\">');\n        var articleEnd = text.indexOf('<div class=\"background-load-offer card\">');\n        return Promise.all([cache.put('/shell-start.html', new Response(text.slice(0, headerEnd), response)), cache.put('/shell-end.html', new Response(text.slice(articleEnd), response))]);\n      });\n    });\n  }));\n});\n\nvar expectedCaches = [staticCacheName];\n\nself.addEventListener('activate', function (event) {\n  event.waitUntil(caches.keys().then(function (keys) {\n    return Promise.all(keys.map(function (key) {\n      if (key.startsWith(prefix + '-') && !key.startsWith(prefix + '-article-') && expectedCaches.indexOf(key) == -1) {\n        return caches['delete'](key);\n      }\n    }));\n  }));\n});\n\n// This will vanish when the ServiceWorker closes,\n// but that's cool, I want that.\nvar dataTmpCache = {};\n\nself.addEventListener('fetch', function (event) {\n  var requestURL = new URL(event.request.url);\n\n  // catch the root request\n  if (requestURL.origin == location.origin) {\n    if (requestURL.pathname == '/') {\n      event.respondWith(caches.match('/'));\n      return;\n    }\n    if (requestURL.pathname.startsWith('/wiki/')) {\n      if (/\\.(middle.inc)$/.test(requestURL.pathname)) {\n        return;\n      }\n\n      if (/\\.(json|inc)$/.test(requestURL.pathname)) {\n        if (dataTmpCache[requestURL.href]) {\n          var response = dataTmpCache[requestURL.href];\n          delete dataTmpCache[requestURL.href];\n          event.respondWith(response);\n        }\n        return;\n      }\n\n      if (requestURL.search.includes('sw-stream')) {\n        event.respondWith(streamArticle(requestURL));\n        return;\n      }\n\n      // Get ahead of the pack by starting the json request now\n      if (!requestURL.search.includes('no-prefetch')) {\n        var jsonURL = new URL(requestURL);\n        jsonURL.pathname += '.json';\n        jsonURL.search = '';\n        var incURL = new URL(requestURL);\n        incURL.pathname += '.inc';\n        incURL.search = '';\n        dataTmpCache[jsonURL.href] = fetch(jsonURL, {\n          credentials: 'include' // needed for flag cookies\n        });\n        dataTmpCache[incURL.href] = fetch(incURL, {\n          credentials: 'include' // needed for flag cookies\n        });\n      }\n\n      event.respondWith(caches.match('/shell.html'));\n      return;\n    }\n  }\n\n  // default fetch behaviour\n  event.respondWith(caches.match(event.request).then(function (response) {\n    return response || fetch(event.request);\n  }));\n});\n\nfunction streamArticle(url) {\n  try {\n    new ReadableStream({});\n  } catch (e) {\n    return new Response(\"Streams not supported\");\n  }\n  var stream = new ReadableStream({\n    start: function start(controller) {\n      var contentURL = new URL(url);\n      contentURL.pathname += '.middle.inc';\n      var startFetch = caches.match('/shell-start.html');\n      var contentFetch = fetch(contentURL)['catch'](function () {\n        return new Response(\"Failed, soz\");\n      });\n      var endFetch = caches.match('/shell-end.html');\n\n      function pushStream(stream) {\n        var reader = stream.getReader();\n        function read() {\n          return reader.read().then(function (result) {\n            if (result.done) return;\n            controller.enqueue(result.value);\n            return read();\n          });\n        }\n        return read();\n      }\n\n      startFetch.then(function (response) {\n        return pushStream(response.body);\n      }).then(function () {\n        return contentFetch;\n      }).then(function (response) {\n        return pushStream(response.body);\n      }).then(function () {\n        return endFetch;\n      }).then(function (response) {\n        return pushStream(response.body);\n      }).then(function () {\n        return controller.close();\n      });\n    }\n  });\n\n  return new Response(stream, {\n    headers: { 'Content-Type': 'text/html' }\n  });\n}\n\nself.addEventListener('sync', function (event) {\n  // My use of storage here has race conditions. Meh.\n  console.log(\"Good lord, a sync event\");\n\n  event.waitUntil(storage.get('to-bg-cache').then(function (toCache) {\n    toCache = toCache || [];\n\n    return Promise.all(toCache.map(function callee$2$0(articleName) {\n      var article;\n      return regeneratorRuntime.async(function callee$2$0$(context$3$0) {\n        while (1) switch (context$3$0.prev = context$3$0.next) {\n          case 0:\n            context$3$0.next = 2;\n            return regeneratorRuntime.awrap(wikipedia.article(articleName));\n\n          case 2:\n            article = context$3$0.sent;\n            context$3$0.next = 5;\n            return regeneratorRuntime.awrap(article.cache());\n\n          case 5:\n            context$3$0.t0 = registration;\n            context$3$0.next = 8;\n            return regeneratorRuntime.awrap(article.meta);\n\n          case 8:\n            context$3$0.t1 = context$3$0.sent.title;\n            context$3$0.t2 = context$3$0.t1 + \" ready!\";\n            context$3$0.next = 12;\n            return regeneratorRuntime.awrap(article.meta);\n\n          case 12:\n            context$3$0.t3 = context$3$0.sent.urlId;\n            context$3$0.t4 = {\n              icon: \"/imgs/wikipedia-192.png\",\n              body: \"View the article\",\n              data: context$3$0.t3\n            };\n            context$3$0.t0.showNotification.call(context$3$0.t0, context$3$0.t2, context$3$0.t4);\n\n          case 15:\n          case 'end':\n            return context$3$0.stop();\n        }\n      }, null, _this);\n    }));\n  }).then(function (_) {\n    storage.set('to-bg-cache', []);\n  }));\n});\n\nself.addEventListener('notificationclick', function (event) {\n  // assuming only one type of notification right now\n  event.notification.close();\n  clients.openWindow(location.origin + '/wiki/' + event.notification.data);\n});\n\nself.addEventListener('message', function (event) {\n  if (event.data == 'skipWaiting') {\n    self.skipWaiting();\n  }\n});\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9oZXJtYW53L0RvY3VtZW50cy9oZXJtd29uZy9vZmZsaW5lLXdpa2lwZWRpYS9wdWJsaWMvanMvc3cvaW5kZXguanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDO0FBQy9CLE9BQU8sQ0FBQyw4QkFBOEIsQ0FBQyxDQUFDO0FBQ3hDLElBQUksU0FBUyxHQUFHLE9BQU8sQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDO0FBQy9DLElBQUksT0FBTyxHQUFHLE9BQU8sQ0FBQyxtQkFBbUIsQ0FBQyxDQUFDOztBQUUzQyxJQUFJLE9BQU8sR0FBRyxJQUFJLENBQUM7QUFDbkIsSUFBSSxNQUFNLEdBQUcsYUFBYSxDQUFDO0FBQzNCLElBQUksZUFBZSxHQUFNLE1BQU0saUJBQVksT0FBTyxBQUFFLENBQUM7O0FBRXJELElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxTQUFTLEVBQUUsVUFBQSxLQUFLLEVBQUk7QUFDeEMsT0FBSyxDQUFDLFNBQVMsQ0FDYixNQUFNLENBQUMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxDQUFDLElBQUksQ0FBQyxVQUFBLEtBQUssRUFBSTtBQUN6QyxXQUFPLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FDbEIsR0FBRyxFQUNILGFBQWEsRUFDYixhQUFhLEVBQ2IsdUJBQXVCO0FBQ3ZCLHdCQUFvQjtBQUNwQixtQkFBZSxDQUNoQixDQUFDLENBQUMsSUFBSSxDQUFDO2FBQU0sS0FBSyxDQUFDLEtBQUssQ0FBQyxhQUFhLENBQUM7S0FBQSxDQUFDLENBQUMsSUFBSSxDQUFDLFVBQUEsUUFBUSxFQUFJOztBQUV6RCxhQUFPLFFBQVEsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxJQUFJLENBQUMsVUFBQSxJQUFJLEVBQUk7QUFDbEMsWUFBTSxTQUFTLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyx5Q0FBeUMsQ0FBQyxDQUFDO0FBQzFFLFlBQU0sVUFBVSxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMs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SUFBSSxDQUFDLGdCQUFnQixDQUFDLG1CQUFtQixFQUFFLFVBQVMsS0FBSyxFQUFFOztBQUV6RCxPQUFLLENBQUMsWUFBWSxDQUFDLEtBQUssRUFBRSxDQUFDO0FBQzNCLFNBQU8sQ0FBQyxVQUFVLENBQUksUUFBUSxDQUFDLE1BQU0sY0FBUyxLQUFLLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBRyxDQUFDO0NBQzFFLENBQUMsQ0FBQzs7QUFFSCxJQUFJLENBQUMsZ0JBQWdCLENBQUMsU0FBUyxFQUFFLFVBQUEsS0FBSyxFQUFJO0FBQ3hDLE1BQUksS0FBSyxDQUFDLElBQUksSUFBSSxhQUFhLEVBQUU7QUFDL0IsUUFBSSxDQUFDLFdBQVcsRUFBRSxDQUFDO0dBQ3BCO0NBQ0YsQ0FBQyxDQUFDIiwiZmlsZSI6Ii9Vc2Vycy9oZXJtYW53L0RvY3VtZW50cy9oZXJtd29uZy9vZmZsaW5lLXdpa2lwZWRpYS9wdWJsaWMvanMvc3cvaW5kZXguanMiLCJzb3VyY2VzQ29udGVudCI6WyJyZXF1aXJlKCdyZWdlbmVyYXRvci9ydW50aW1lJyk7XG5yZXF1aXJlKCdzZXJ2aWNld29ya2VyLWNhY2hlLXBvbHlmaWxsJyk7XG52YXIgd2lraXBlZGlhID0gcmVxdWlyZSgnLi4vc2hhcmVkL3dpa2lwZWRpYScpO1xudmFyIHN0b3JhZ2UgPSByZXF1aXJlKCcuLi9zaGFyZWQvc3RvcmFnZScpO1xuXG52YXIgdmVyc2lvbiA9ICcyNCc7XG52YXIgcHJlZml4ID0gJ3dpa2lvZmZsaW5lJztcbnZhciBzdGF0aWNDYWNoZU5hbWUgPSBgJHtwcmVmaXh9LXN0YXRpYy12JHt2ZXJzaW9ufWA7XG4gXG5zZWxmLmFkZEV2ZW50TGlzdGVuZXIoJ2luc3RhbGwnLCBldmVudCA9PiB7XG4gIGV2ZW50LndhaXRVbnRpbChcbiAgICBjYWNoZXMub3BlbihzdGF0aWNDYWNoZU5hbWUpLnRoZW4oY2FjaGUgPT4ge1xuICAgICAgcmV0dXJuIGNhY2hlLmFkZEFsbChbXG4gICAgICAgICcvJyxcbiAgICAgICAgJy9zaGVsbC5odG1sJyxcbiAgICAgICAgJy9qcy9wYWdlLmpzJyxcbiAgICAgICAgJy9qcy9wYWdlLWZyYW1ld29yay5qcycsIC8vIHllYWhoaGgsIHdlJ3JlIGNhY2hpbmcgd2FheXl5eXkgbW9yZSB0aGFuIHdlIG5lZWQsIGJ1dCBrZWVwcyB0aGUgcmVxdWVzdCB0ZXN0cyBmYWlyXG4gICAgICAgICcvY3NzL2hlYWQtd2lraS5jc3MnLCAvLyBkb24ndCBuZWVkIHRoaXMgd2hlbiBpdCdzIGlubGluZWQsIGJ1dCBoZWxwcyB3aGVuIHJlbmRlcmVkIHdpdGggYmxvY2tpbmcgQ1NTIGluIHNldHRpbmdzXG4gICAgICAgICcvY3NzL3dpa2kuY3NzJ1xuICAgICAgXSkudGhlbigoKSA9PiBjYWNoZS5tYXRjaCgnL3NoZWxsLmh0bWwnKSkudGhlbihyZXNwb25zZSA9PiB7XG4gICAgICAgIC8vIGJpdCBoYWNreSwgbWFraW5nIHRoZSBzaGVsbCBzdGFydCAmIGVuZCBmcm9tIHRoZSBzaGVsbCBqdXN0IGZldGNoZWRcbiAgICAgICAgcmV0dXJuIHJlc3BvbnNlLnRleHQoKS50aGVuKHRleHQgPT4ge1xuICAgICAgICAgIGNvbnN0IGhlYWRlckVuZCA9IHRleHQuaW5kZXhPZignPGRpdiBjbGFzcz1cImFydGljbGUtaGVhZGVyIHN1YmhlYWRpbmdcIj4nKTtcbiAgICAgICAgICBjb25zdCBhcnRpY2xlRW5kID0gdGV4dC5pbmRleE9mKCc8ZGl2IGNsYXNzPVwiYmFja2dyb3VuZC1sb2FkLW9mZmVyIGNhcmRcIj4nKTtcbiAgICAgICAgICByZXR1cm4gUHJvbWlzZS5hbGwoW1xuICAgICAgICAgICAgY2FjaGUucHV0KCcvc2hlbGwtc3RhcnQuaHRtbCcsIG5ldyBSZXNwb25zZSh0ZXh0LnNsaWNlKDAsIGhlYWRlckVuZCksIHJlc3BvbnNlKSksXG4gICAgICAgICAgICBjYWNoZS5wdXQoJy9zaGVsbC1lbmQuaHRtbCcsIG5ldyBSZXNwb25zZSh0ZXh0LnNsaWNlKGFydGljbGVFbmQpLCByZXNwb25zZSkpXG4gICAgICAgICAgXSk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfSlcbiAgKTtcbn0pO1xuXG52YXIgZXhwZWN0ZWRDYWNoZXMgPSBbXG4gIHN0YXRpY0NhY2hlTmFtZVxuXTtcblxuc2VsZi5hZGRFdmVudExpc3RlbmVyKCdhY3RpdmF0ZScsIGV2ZW50ID0+IHtcbiAgZXZlbnQud2FpdFVudGlsKFxuICAgIGNhY2hlcy5rZXlzKCkudGhlbihrZXlzID0+IHtcbiAgICAgIHJldHVybiBQcm9taXNlLmFsbChcbiAgICAgICAga2V5cy5tYXAoa2V5ID0+IHtcbiAgICAgICAgICBpZiAoa2V5LnN0YXJ0c1dpdGgocHJlZml4ICsgJy0nKVxuICAgICAgICAgICAgJiYgIWtleS5zdGFydHNXaXRoKGAke3ByZWZpeH0tYXJ0aWNsZS1gKVxuICAgICAgICAgICAgJiYgZXhwZWN0ZWRDYWNoZXMuaW5kZXhPZihrZXkpID09IC0xKSB7XG4gICAgICAgICAgICByZXR1cm4gY2FjaGVzLmRlbGV0ZShrZXkpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICAgICk7XG4gICAgfSlcbiAgKTtcbn0pO1xuXG4vLyBUaGlzIHdpbGwgdmFuaXNoIHdoZW4gdGhlIFNlcnZpY2VXb3JrZXIgY2xvc2VzLFxuLy8gYnV0IHRoYXQncyBjb29sLCBJIHdhbnQgdGhhdC5cbnZhciBkYXRhVG1wQ2FjaGUgPSB7fTtcblxuc2VsZi5hZGRFdmVudExpc3RlbmVyKCdmZXRjaCcsIGV2ZW50ID0+IHtcbiAgdmFyIHJlcXVlc3RVUkwgPSBuZXcgVVJMKGV2ZW50LnJlcXVlc3QudXJsKTtcblxuICAvLyBjYXRjaCB0aGUgcm9vdCByZXF1ZXN0XG4gIGlmIChyZXF1ZXN0VVJMLm9yaWdpbiA9PSBsb2NhdGlvbi5vcmlnaW4pIHtcbiAgICBpZiAocmVxdWVzdFVSTC5wYXRobmFtZSA9PSAnLycpIHtcbiAgICAgIGV2ZW50LnJlc3BvbmRXaXRoKGNhY2hlcy5tYXRjaCgnLycpKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKHJlcXVlc3RVUkwucGF0aG5hbWUuc3RhcnRzV2l0aCgnL3dpa2kvJykpIHtcbiAgICAgIGlmICgvXFwuKG1pZGRsZS5pbmMpJC8udGVzdChyZXF1ZXN0VVJMLnBhdGhuYW1lKSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGlmICgvXFwuKGpzb258aW5jKSQvLnRlc3QocmVxdWVzdFVSTC5wYXRobmFtZSkpIHtcbiAgICAgICAgaWYgKGRhdGFUbXBDYWNoZVtyZXF1ZXN0VVJMLmhyZWZdKSB7XG4gICAgICAgICAgdmFyIHJlc3BvbnNlID0gZGF0YVRtcENhY2hlW3JlcXVlc3RVUkwuaHJlZl07XG4gICAgICAgICAgZGVsZXRlIGRhdGFUbXBDYWNoZVtyZXF1ZXN0VVJMLmhyZWZdO1xuICAgICAgICAgIGV2ZW50LnJlc3BvbmRXaXRoKHJlc3BvbnNlKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGlmIChyZXF1ZXN0VVJMLnNlYXJjaC5pbmNsdWRlcygnc3ctc3RyZWFtJykpIHtcbiAgICAgICAgZXZlbnQucmVzcG9uZFdpdGgoc3RyZWFtQXJ0aWNsZShyZXF1ZXN0VVJMKSk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgLy8gR2V0IGFoZWFkIG9mIHRoZSBwYWNrIGJ5IHN0YXJ0aW5nIHRoZSBqc29uIHJlcXVlc3Qgbm93XG4gICAgICBpZiAoIXJlcXVlc3RVUkwuc2VhcmNoLmluY2x1ZGVzKCduby1wcmVmZXRjaCcpKSB7XG4gICAgICAgIHZhciBqc29uVVJMID0gbmV3IFVSTChyZXF1ZXN0VVJMKTtcbiAgICAgICAganNvblVSTC5wYXRobmFtZSArPSAnLmpzb24nO1xuICAgICAgICBqc29uVVJMLnNlYXJjaCA9ICcnO1xuICAgICAgICB2YXIgaW5jVVJMID0gbmV3IFVSTChyZXF1ZXN0VVJMKTtcbiAgICAgICAgaW5jVVJMLnBhdGhuYW1lICs9ICcuaW5jJztcbiAgICAgICAgaW5jVVJMLnNlYXJjaCA9ICcnO1xuICAgICAgICBkYXRhVG1wQ2FjaGVbanNvblVSTC5ocmVmXSA9IGZldGNoKGpzb25VUkwsIHtcbiAgICAgICAgICBjcmVkZW50aWFsczogJ2luY2x1ZGUnIC8vIG5lZWRlZCBmb3IgZmxhZyBjb29raWVzXG4gICAgICAgIH0pO1xuICAgICAgICBkYXRhVG1wQ2FjaGVbaW5jVVJMLmhyZWZdID0gZmV0Y2goaW5jVVJMLCB7XG4gICAgICAgICAgY3JlZGVudGlhbHM6ICdpbmNsdWRlJyAvLyBuZWVkZWQgZm9yIGZsYWcgY29va2llc1xuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgZXZlbnQucmVzcG9uZFdpdGgoY2FjaGVzLm1hdGNoKCcvc2hlbGwuaHRtbCcpKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gIH1cblxuICAvLyBkZWZhdWx0IGZldGNoIGJlaGF2aW91clxuICBldmVudC5yZXNwb25kV2l0aChcbiAgICBjYWNoZXMubWF0Y2goZXZlbnQucmVxdWVzdCkudGhlbihyZXNwb25zZSA9PiB7XG4gICAgICByZXR1cm4gcmVzcG9uc2UgfHwgZmV0Y2goZXZlbnQucmVxdWVzdCk7XG4gICAgfSlcbiAgKTtcbn0pO1xuXG5mdW5jdGlvbiBzdHJlYW1BcnRpY2xlKHVybCkge1xuICB0cnkge1xuICAgIG5ldyBSZWFkYWJsZVN0cmVhbSh7fSk7XG4gIH1cbiAgY2F0Y2goZSkge1xuICAgIHJldHVybiBuZXcgUmVzcG9uc2UoXCJTdHJlYW1zIG5vdCBzdXBwb3J0ZWRcIik7XG4gIH1cbiAgY29uc3Qgc3RyZWFtID0gbmV3IFJlYWRhYmxlU3RyZWFtKHtcbiAgICBzdGFydChjb250cm9sbGVyKSB7XG4gICAgICBjb25zdCBjb250ZW50VVJMID0gbmV3IFVSTCh1cmwpO1xuICAgICAgY29udGVudFVSTC5wYXRobmFtZSArPSAnLm1pZGRsZS5pbmMnO1xuICAgICAgY29uc3Qgc3RhcnRGZXRjaCA9IGNhY2hlcy5tYXRjaCgnL3NoZWxsLXN0YXJ0Lmh0bWwnKTtcbiAgICAgIGNvbnN0IGNvbnRlbnRGZXRjaCA9IGZldGNoKGNvbnRlbnRVUkwpLmNhdGNoKCgpID0+IG5ldyBSZXNwb25zZShcIkZhaWxlZCwgc296XCIpKTtcbiAgICAgIGNvbnN0IGVuZEZldGNoID0gY2FjaGVzLm1hdGNoKCcvc2hlbGwtZW5kLmh0bWwnKTtcblxuICAgICAgZnVuY3Rpb24gcHVzaFN0cmVhbShzdHJlYW0pIHtcbiAgICAgICAgY29uc3QgcmVhZGVyID0gc3RyZWFtLmdldFJlYWRlcigpO1xuICAgICAgICBmdW5jdGlvbiByZWFkKCkge1xuICAgICAgICAgIHJldHVybiByZWFkZXIucmVhZCgpLnRoZW4ocmVzdWx0ID0+IHtcbiAgICAgICAgICAgIGlmIChyZXN1bHQuZG9uZSkgcmV0dXJuO1xuICAgICAgICAgICAgY29udHJvbGxlci5lbnF1ZXVlKHJlc3VsdC52YWx1ZSk7XG4gICAgICAgICAgICByZXR1cm4gcmVhZCgpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiByZWFkKCk7XG4gICAgICB9XG5cbiAgICAgIHN0YXJ0RmV0Y2hcbiAgICAgICAgLnRoZW4ocmVzcG9uc2UgPT4gcHVzaFN0cmVhbShyZXNwb25zZS5ib2R5KSlcbiAgICAgICAgLnRoZW4oKCkgPT4gY29udGVudEZldGNoKVxuICAgICAgICAudGhlbihyZXNwb25zZSA9PiBwdXNoU3RyZWFtKHJlc3BvbnNlLmJvZHkpKVxuICAgICAgICAudGhlbigoKSA9PiBlbmRGZXRjaClcbiAgICAgICAgLnRoZW4ocmVzcG9uc2UgPT4gcHVzaFN0cmVhbShyZXNwb25zZS5ib2R5KSlcbiAgICAgICAgLnRoZW4oKCkgPT4gY29udHJvbGxlci5jbG9zZSgpKTtcbiAgICB9XG4gIH0pO1xuXG4gIHJldHVybiBuZXcgUmVzcG9uc2Uoc3RyZWFtLCB7XG4gICAgaGVhZGVyczogeydDb250ZW50LVR5cGUnOiAndGV4dC9odG1sJ31cbiAgfSlcbn1cblxuc2VsZi5hZGRFdmVudExpc3RlbmVyKCdzeW5jJywgZXZlbnQgPT4ge1xuICAvLyBNeSB1c2Ugb2Ygc3RvcmFnZSBoZXJlIGhhcyByYWNlIGNvbmRpdGlvbnMuIE1laC5cbiAgY29uc29sZS5sb2coXCJHb29kIGxvcmQsIGEgc3luYyBldmVudFwiKTtcblxuICBldmVudC53YWl0VW50aWwoXG4gICAgc3RvcmFnZS5nZXQoJ3RvLWJnLWNhY2hlJykudGhlbih0b0NhY2hlID0+IHtcbiAgICAgIHRvQ2FjaGUgPSB0b0NhY2hlIHx8IFtdO1xuXG4gICAgICByZXR1cm4gUHJvbWlzZS5hbGwodG9DYWNoZS5tYXAoYXN5bmMgYXJ0aWNsZU5hbWUgPT4ge1xuICAgICAgICB2YXIgYXJ0aWNsZSA9IGF3YWl0IHdpa2lwZWRpYS5hcnRpY2xlKGFydGljbGVOYW1lKTtcbiAgICAgICAgYXdhaXQgYXJ0aWNsZS5jYWNoZSgpO1xuICAgICAgICByZWdpc3RyYXRpb24uc2hvd05vdGlmaWNhdGlvbigoYXdhaXQgYXJ0aWNsZS5tZXRhKS50aXRsZSArIFwiIHJlYWR5IVwiLCB7XG4gICAgICAgICAgaWNvbjogXCIvaW1ncy93aWtpcGVkaWEtMTkyLnBuZ1wiLFxuICAgICAgICAgIGJvZHk6IFwiVmlldyB0aGUgYXJ0aWNsZVwiLFxuICAgICAgICAgIGRhdGE6IChhd2FpdCBhcnRpY2xlLm1ldGEpLnVybElkXG4gICAgICAgIH0pO1xuICAgICAgfSkpO1xuICAgIH0pLnRoZW4oXyA9PiB7XG4gICAgICBzdG9yYWdlLnNldCgndG8tYmctY2FjaGUnLCBbXSk7XG4gICAgfSlcbiAgKTtcbn0pO1xuXG5zZWxmLmFkZEV2ZW50TGlzdGVuZXIoJ25vdGlmaWNhdGlvbmNsaWNrJywgZnVuY3Rpb24oZXZlbnQpIHtcbiAgLy8gYXNzdW1pbmcgb25seSBvbmUgdHlwZSBvZiBub3RpZmljYXRpb24gcmlnaHQgbm93XG4gIGV2ZW50Lm5vdGlmaWNhdGlvbi5jbG9zZSgpO1xuICBjbGllbnRzLm9wZW5XaW5kb3coYCR7bG9jYXRpb24ub3JpZ2lufS93aWtpLyR7ZXZlbnQubm90aWZpY2F0aW9uLmRhdGF9YCk7XG59KTtcblxuc2VsZi5hZGRFdmVudExpc3RlbmVyKCdtZXNzYWdlJywgZXZlbnQgPT4ge1xuICBpZiAoZXZlbnQuZGF0YSA9PSAnc2tpcFdhaXRpbmcnKSB7XG4gICAgc2VsZi5za2lwV2FpdGluZygpO1xuICB9XG59KTsiXX0=","// shim for using process in browser\n\nvar process = module.exports = {};\nvar queue = [];\nvar draining = false;\n\nfunction drainQueue() {\n    if (draining) {\n        return;\n    }\n    draining = true;\n    var currentQueue;\n    var len = queue.length;\n    while(len) {\n        currentQueue = queue;\n        queue = [];\n        var i = -1;\n        while (++i < len) {\n            currentQueue[i]();\n        }\n        len = queue.length;\n    }\n    draining = false;\n}\nprocess.nextTick = function (fun) {\n    queue.push(fun);\n    if (!draining) {\n        setTimeout(drainQueue, 0);\n    }\n};\n\nprocess.title = 'browser';\nprocess.browser = true;\nprocess.env = {};\nprocess.argv = [];\nprocess.version = ''; // empty string to avoid regexp issues\nprocess.versions = {};\n\nfunction noop() {}\n\nprocess.on = noop;\nprocess.addListener = noop;\nprocess.once = noop;\nprocess.off = noop;\nprocess.removeListener = noop;\nprocess.removeAllListeners = noop;\nprocess.emit = noop;\n\nprocess.binding = function (name) {\n    throw new Error('process.binding is not supported');\n};\n\n// TODO(shtylman)\nprocess.cwd = function () { return '/' };\nprocess.chdir = function (dir) {\n    throw new Error('process.chdir is not supported');\n};\nprocess.umask = function() { return 0; };\n","(function (process,global){\n/**\n * Copyright (c) 2014, Facebook, Inc.\n * All rights reserved.\n *\n * This source code is licensed under the BSD-style license found in the\n * https://raw.github.com/facebook/regenerator/master/LICENSE file. An\n * additional grant of patent rights can be found in the PATENTS file in\n * the same directory.\n */\n\n!(function(global) {\n  \"use strict\";\n\n  var hasOwn = Object.prototype.hasOwnProperty;\n  var undefined; // More compressible than void 0.\n  var $Symbol = typeof Symbol === \"function\" ? Symbol : {};\n  var iteratorSymbol = $Symbol.iterator || \"@@iterator\";\n  var toStringTagSymbol = $Symbol.toStringTag || \"@@toStringTag\";\n\n  var inModule = typeof module === \"object\";\n  var runtime = global.regeneratorRuntime;\n  if (runtime) {\n    if (inModule) {\n      // If regeneratorRuntime is defined globally and we're in a module,\n      // make the exports object identical to regeneratorRuntime.\n      module.exports = runtime;\n    }\n    // Don't bother evaluating the rest of this file if the runtime was\n    // already defined globally.\n    return;\n  }\n\n  // Define the runtime globally (as expected by generated code) as either\n  // module.exports (if we're in a module) or a new, empty object.\n  runtime = global.regeneratorRuntime = inModule ? module.exports : {};\n\n  function wrap(innerFn, outerFn, self, tryLocsList) {\n    // If outerFn provided and outerFn.prototype is a Generator, then outerFn.prototype instanceof Generator.\n    var protoGenerator = outerFn && outerFn.prototype instanceof Generator ? outerFn : Generator;\n    var generator = Object.create(protoGenerator.prototype);\n    var context = new Context(tryLocsList || []);\n\n    // The ._invoke method unifies the implementations of the .next,\n    // .throw, and .return methods.\n    generator._invoke = makeInvokeMethod(innerFn, self, context);\n\n    return generator;\n  }\n  runtime.wrap = wrap;\n\n  // Try/catch helper to minimize deoptimizations. Returns a completion\n  // record like context.tryEntries[i].completion. This interface could\n  // have been (and was previously) designed to take a closure to be\n  // invoked without arguments, but in all the cases we care about we\n  // already have an existing method we want to call, so there's no need\n  // to create a new function object. We can even get away with assuming\n  // the method takes exactly one argument, since that happens to be true\n  // in every case, so we don't have to touch the arguments object. The\n  // only additional allocation required is the completion record, which\n  // has a stable shape and so hopefully should be cheap to allocate.\n  function tryCatch(fn, obj, arg) {\n    try {\n      return { type: \"normal\", arg: fn.call(obj, arg) };\n    } catch (err) {\n      return { type: \"throw\", arg: err };\n    }\n  }\n\n  var GenStateSuspendedStart = \"suspendedStart\";\n  var GenStateSuspendedYield = \"suspendedYield\";\n  var GenStateExecuting = \"executing\";\n  var GenStateCompleted = \"completed\";\n\n  // Returning this object from the innerFn has the same effect as\n  // breaking out of the dispatch switch statement.\n  var ContinueSentinel = {};\n\n  // Dummy constructor functions that we use as the .constructor and\n  // .constructor.prototype properties for functions that return Generator\n  // objects. For full spec compliance, you may wish to configure your\n  // minifier not to mangle the names of these two functions.\n  function Generator() {}\n  function GeneratorFunction() {}\n  function GeneratorFunctionPrototype() {}\n\n  var Gp = GeneratorFunctionPrototype.prototype = Generator.prototype;\n  GeneratorFunction.prototype = Gp.constructor = GeneratorFunctionPrototype;\n  GeneratorFunctionPrototype.constructor = GeneratorFunction;\n  GeneratorFunctionPrototype[toStringTagSymbol] = GeneratorFunction.displayName = \"GeneratorFunction\";\n\n  // Helper for defining the .next, .throw, and .return methods of the\n  // Iterator interface in terms of a single ._invoke method.\n  function defineIteratorMethods(prototype) {\n    [\"next\", \"throw\", \"return\"].forEach(function(method) {\n      prototype[method] = function(arg) {\n        return this._invoke(method, arg);\n      };\n    });\n  }\n\n  runtime.isGeneratorFunction = function(genFun) {\n    var ctor = typeof genFun === \"function\" && genFun.constructor;\n    return ctor\n      ? ctor === GeneratorFunction ||\n        // For the native GeneratorFunction constructor, the best we can\n        // do is to check its .name property.\n        (ctor.displayName || ctor.name) === \"GeneratorFunction\"\n      : false;\n  };\n\n  runtime.mark = function(genFun) {\n    if (Object.setPrototypeOf) {\n      Object.setPrototypeOf(genFun, GeneratorFunctionPrototype);\n    } else {\n      genFun.__proto__ = GeneratorFunctionPrototype;\n      if (!(toStringTagSymbol in genFun)) {\n        genFun[toStringTagSymbol] = \"GeneratorFunction\";\n      }\n    }\n    genFun.prototype = Object.create(Gp);\n    return genFun;\n  };\n\n  // Within the body of any async function, `await x` is transformed to\n  // `yield regeneratorRuntime.awrap(x)`, so that the runtime can test\n  // `value instanceof AwaitArgument` to determine if the yielded value is\n  // meant to be awaited. Some may consider the name of this method too\n  // cutesy, but they are curmudgeons.\n  runtime.awrap = function(arg) {\n    return new AwaitArgument(arg);\n  };\n\n  function AwaitArgument(arg) {\n    this.arg = arg;\n  }\n\n  function AsyncIterator(generator) {\n    function invoke(method, arg, resolve, reject) {\n      var record = tryCatch(generator[method], generator, arg);\n      if (record.type === \"throw\") {\n        reject(record.arg);\n      } else {\n        var result = record.arg;\n        var value = result.value;\n        if (value instanceof AwaitArgument) {\n          return Promise.resolve(value.arg).then(function(value) {\n            invoke(\"next\", value, resolve, reject);\n          }, function(err) {\n            invoke(\"throw\", err, resolve, reject);\n          });\n        }\n\n        return Promise.resolve(value).then(function(unwrapped) {\n          // When a yielded Promise is resolved, its final value becomes\n          // the .value of the Promise<{value,done}> result for the\n          // current iteration. If the Promise is rejected, however, the\n          // result for this iteration will be rejected with the same\n          // reason. Note that rejections of yielded Promises are not\n          // thrown back into the generator function, as is the case\n          // when an awaited Promise is rejected. This difference in\n          // behavior between yield and await is important, because it\n          // allows the consumer to decide what to do with the yielded\n          // rejection (swallow it and continue, manually .throw it back\n          // into the generator, abandon iteration, whatever). With\n          // await, by contrast, there is no opportunity to examine the\n          // rejection reason outside the generator function, so the\n          // only option is to throw it from the await expression, and\n          // let the generator function handle the exception.\n          result.value = unwrapped;\n          resolve(result);\n        }, reject);\n      }\n    }\n\n    if (typeof process === \"object\" && process.domain) {\n      invoke = process.domain.bind(invoke);\n    }\n\n    var previousPromise;\n\n    function enqueue(method, arg) {\n      function callInvokeWithMethodAndArg() {\n        return new Promise(function(resolve, reject) {\n          invoke(method, arg, resolve, reject);\n        });\n      }\n\n      return previousPromise =\n        // If enqueue has been called before, then we want to wait until\n        // all previous Promises have been resolved before calling invoke,\n        // so that results are always delivered in the correct order. If\n        // enqueue has not been called before, then it is important to\n        // call invoke immediately, without waiting on a callback to fire,\n        // so that the async generator function has the opportunity to do\n        // any necessary setup in a predictable way. This predictability\n        // is why the Promise constructor synchronously invokes its\n        // executor callback, and why async functions synchronously\n        // execute code before the first await. Since we implement simple\n        // async functions in terms of async generators, it is especially\n        // important to get this right, even though it requires care.\n        previousPromise ? previousPromise.then(\n          callInvokeWithMethodAndArg,\n          // Avoid propagating failures to Promises returned by later\n          // invocations of the iterator.\n          callInvokeWithMethodAndArg\n        ) : callInvokeWithMethodAndArg();\n    }\n\n    // Define the unified helper method that is used to implement .next,\n    // .throw, and .return (see defineIteratorMethods).\n    this._invoke = enqueue;\n  }\n\n  defineIteratorMethods(AsyncIterator.prototype);\n\n  // Note that simple async functions are implemented on top of\n  // AsyncIterator objects; they just return a Promise for the value of\n  // the final result produced by the iterator.\n  runtime.async = function(innerFn, outerFn, self, tryLocsList) {\n    var iter = new AsyncIterator(\n      wrap(innerFn, outerFn, self, tryLocsList)\n    );\n\n    return runtime.isGeneratorFunction(outerFn)\n      ? iter // If outerFn is a generator, return the full iterator.\n      : iter.next().then(function(result) {\n          return result.done ? result.value : iter.next();\n        });\n  };\n\n  function makeInvokeMethod(innerFn, self, context) {\n    var state = GenStateSuspendedStart;\n\n    return function invoke(method, arg) {\n      if (state === GenStateExecuting) {\n        throw new Error(\"Generator is already running\");\n      }\n\n      if (state === GenStateCompleted) {\n        if (method === \"throw\") {\n          throw arg;\n        }\n\n        // Be forgiving, per 25.3.3.3.3 of the spec:\n        // https://people.mozilla.org/~jorendorff/es6-draft.html#sec-generatorresume\n        return doneResult();\n      }\n\n      while (true) {\n        var delegate = context.delegate;\n        if (delegate) {\n          if (method === \"return\" ||\n              (method === \"throw\" && delegate.iterator[method] === undefined)) {\n            // A return or throw (when the delegate iterator has no throw\n            // method) always terminates the yield* loop.\n            context.delegate = null;\n\n            // If the delegate iterator has a return method, give it a\n            // chance to clean up.\n            var returnMethod = delegate.iterator[\"return\"];\n            if (returnMethod) {\n              var record = tryCatch(returnMethod, delegate.iterator, arg);\n              if (record.type === \"throw\") {\n                // If the return method threw an exception, let that\n                // exception prevail over the original return or throw.\n                method = \"throw\";\n                arg = record.arg;\n                continue;\n              }\n            }\n\n            if (method === \"return\") {\n              // Continue with the outer return, now that the delegate\n              // iterator has been terminated.\n              continue;\n            }\n          }\n\n          var record = tryCatch(\n            delegate.iterator[method],\n            delegate.iterator,\n            arg\n          );\n\n          if (record.type === \"throw\") {\n            context.delegate = null;\n\n            // Like returning generator.throw(uncaught), but without the\n            // overhead of an extra function call.\n            method = \"throw\";\n            arg = record.arg;\n            continue;\n          }\n\n          // Delegate generator ran and handled its own exceptions so\n          // regardless of what the method was, we continue as if it is\n          // \"next\" with an undefined arg.\n          method = \"next\";\n          arg = undefined;\n\n          var info = record.arg;\n          if (info.done) {\n            context[delegate.resultName] = info.value;\n            context.next = delegate.nextLoc;\n          } else {\n            state = GenStateSuspendedYield;\n            return info;\n          }\n\n          context.delegate = null;\n        }\n\n        if (method === \"next\") {\n          // Setting context._sent for legacy support of Babel's\n          // function.sent implementation.\n          context.sent = context._sent = arg;\n\n        } else if (method === \"throw\") {\n          if (state === GenStateSuspendedStart) {\n            state = GenStateCompleted;\n            throw arg;\n          }\n\n          if (context.dispatchException(arg)) {\n            // If the dispatched exception was caught by a catch block,\n            // then let that catch block handle the exception normally.\n            method = \"next\";\n            arg = undefined;\n          }\n\n        } else if (method === \"return\") {\n          context.abrupt(\"return\", arg);\n        }\n\n        state = GenStateExecuting;\n\n        var record = tryCatch(innerFn, self, context);\n        if (record.type === \"normal\") {\n          // If an exception is thrown from innerFn, we leave state ===\n          // GenStateExecuting and loop back for another invocation.\n          state = context.done\n            ? GenStateCompleted\n            : GenStateSuspendedYield;\n\n          var info = {\n            value: record.arg,\n            done: context.done\n          };\n\n          if (record.arg === ContinueSentinel) {\n            if (context.delegate && method === \"next\") {\n              // Deliberately forget the last sent value so that we don't\n              // accidentally pass it on to the delegate.\n              arg = undefined;\n            }\n          } else {\n            return info;\n          }\n\n        } else if (record.type === \"throw\") {\n          state = GenStateCompleted;\n          // Dispatch the exception by looping back around to the\n          // context.dispatchException(arg) call above.\n          method = \"throw\";\n          arg = record.arg;\n        }\n      }\n    };\n  }\n\n  // Define Generator.prototype.{next,throw,return} in terms of the\n  // unified ._invoke helper method.\n  defineIteratorMethods(Gp);\n\n  Gp[iteratorSymbol] = function() {\n    return this;\n  };\n\n  Gp[toStringTagSymbol] = \"Generator\";\n\n  Gp.toString = function() {\n    return \"[object Generator]\";\n  };\n\n  function pushTryEntry(locs) {\n    var entry = { tryLoc: locs[0] };\n\n    if (1 in locs) {\n      entry.catchLoc = locs[1];\n    }\n\n    if (2 in locs) {\n      entry.finallyLoc = locs[2];\n      entry.afterLoc = locs[3];\n    }\n\n    this.tryEntries.push(entry);\n  }\n\n  function resetTryEntry(entry) {\n    var record = entry.completion || {};\n    record.type = \"normal\";\n    delete record.arg;\n    entry.completion = record;\n  }\n\n  function Context(tryLocsList) {\n    // The root entry object (effectively a try statement without a catch\n    // or a finally block) gives us a place to store values thrown from\n    // locations where there is no enclosing try statement.\n    this.tryEntries = [{ tryLoc: \"root\" }];\n    tryLocsList.forEach(pushTryEntry, this);\n    this.reset(true);\n  }\n\n  runtime.keys = function(object) {\n    var keys = [];\n    for (var key in object) {\n      keys.push(key);\n    }\n    keys.reverse();\n\n    // Rather than returning an object with a next method, we keep\n    // things simple and return the next function itself.\n    return function next() {\n      while (keys.length) {\n        var key = keys.pop();\n        if (key in object) {\n          next.value = key;\n          next.done = false;\n          return next;\n        }\n      }\n\n      // To avoid creating an additional object, we just hang the .value\n      // and .done properties off the next function object itself. This\n      // also ensures that the minifier will not anonymize the function.\n      next.done = true;\n      return next;\n    };\n  };\n\n  function values(iterable) {\n    if (iterable) {\n      var iteratorMethod = iterable[iteratorSymbol];\n      if (iteratorMethod) {\n        return iteratorMethod.call(iterable);\n      }\n\n      if (typeof iterable.next === \"function\") {\n        return iterable;\n      }\n\n      if (!isNaN(iterable.length)) {\n        var i = -1, next = function next() {\n          while (++i < iterable.length) {\n            if (hasOwn.call(iterable, i)) {\n              next.value = iterable[i];\n              next.done = false;\n              return next;\n            }\n          }\n\n          next.value = undefined;\n          next.done = true;\n\n          return next;\n        };\n\n        return next.next = next;\n      }\n    }\n\n    // Return an iterator with no values.\n    return { next: doneResult };\n  }\n  runtime.values = values;\n\n  function doneResult() {\n    return { value: undefined, done: true };\n  }\n\n  Context.prototype = {\n    constructor: Context,\n\n    reset: function(skipTempReset) {\n      this.prev = 0;\n      this.next = 0;\n      // Resetting context._sent for legacy support of Babel's\n      // function.sent implementation.\n      this.sent = this._sent = undefined;\n      this.done = false;\n      this.delegate = null;\n\n      this.tryEntries.forEach(resetTryEntry);\n\n      if (!skipTempReset) {\n        for (var name in this) {\n          // Not sure about the optimal order of these conditions:\n          if (name.charAt(0) === \"t\" &&\n              hasOwn.call(this, name) &&\n              !isNaN(+name.slice(1))) {\n            this[name] = undefined;\n          }\n        }\n      }\n    },\n\n    stop: function() {\n      this.done = true;\n\n      var rootEntry = this.tryEntries[0];\n      var rootRecord = rootEntry.completion;\n      if (rootRecord.type === \"throw\") {\n        throw rootRecord.arg;\n      }\n\n      return this.rval;\n    },\n\n    dispatchException: function(exception) {\n      if (this.done) {\n        throw exception;\n      }\n\n      var context = this;\n      function handle(loc, caught) {\n        record.type = \"throw\";\n        record.arg = exception;\n        context.next = loc;\n        return !!caught;\n      }\n\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        var record = entry.completion;\n\n        if (entry.tryLoc === \"root\") {\n          // Exception thrown outside of any try block that could handle\n          // it, so set the completion value of the entire function to\n          // throw the exception.\n          return handle(\"end\");\n        }\n\n        if (entry.tryLoc <= this.prev) {\n          var hasCatch = hasOwn.call(entry, \"catchLoc\");\n          var hasFinally = hasOwn.call(entry, \"finallyLoc\");\n\n          if (hasCatch && hasFinally) {\n            if (this.prev < entry.catchLoc) {\n              return handle(entry.catchLoc, true);\n            } else if (this.prev < entry.finallyLoc) {\n              return handle(entry.finallyLoc);\n            }\n\n          } else if (hasCatch) {\n            if (this.prev < entry.catchLoc) {\n              return handle(entry.catchLoc, true);\n            }\n\n          } else if (hasFinally) {\n            if (this.prev < entry.finallyLoc) {\n              return handle(entry.finallyLoc);\n            }\n\n          } else {\n            throw new Error(\"try statement without catch or finally\");\n          }\n        }\n      }\n    },\n\n    abrupt: function(type, arg) {\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        if (entry.tryLoc <= this.prev &&\n            hasOwn.call(entry, \"finallyLoc\") &&\n            this.prev < entry.finallyLoc) {\n          var finallyEntry = entry;\n          break;\n        }\n      }\n\n      if (finallyEntry &&\n          (type === \"break\" ||\n           type === \"continue\") &&\n          finallyEntry.tryLoc <= arg &&\n          arg <= finallyEntry.finallyLoc) {\n        // Ignore the finally entry if control is not jumping to a\n        // location outside the try/catch block.\n        finallyEntry = null;\n      }\n\n      var record = finallyEntry ? finallyEntry.completion : {};\n      record.type = type;\n      record.arg = arg;\n\n      if (finallyEntry) {\n        this.next = finallyEntry.finallyLoc;\n      } else {\n        this.complete(record);\n      }\n\n      return ContinueSentinel;\n    },\n\n    complete: function(record, afterLoc) {\n      if (record.type === \"throw\") {\n        throw record.arg;\n      }\n\n      if (record.type === \"break\" ||\n          record.type === \"continue\") {\n        this.next = record.arg;\n      } else if (record.type === \"return\") {\n        this.rval = record.arg;\n        this.next = \"end\";\n      } else if (record.type === \"normal\" && afterLoc) {\n        this.next = afterLoc;\n      }\n    },\n\n    finish: function(finallyLoc) {\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        if (entry.finallyLoc === finallyLoc) {\n          this.complete(entry.completion, entry.afterLoc);\n          resetTryEntry(entry);\n          return ContinueSentinel;\n        }\n      }\n    },\n\n    \"catch\": function(tryLoc) {\n      for (var i = this.tryEntries.length - 1; i >= 0; --i) {\n        var entry = this.tryEntries[i];\n        if (entry.tryLoc === tryLoc) {\n          var record = entry.completion;\n          if (record.type === \"throw\") {\n            var thrown = record.arg;\n            resetTryEntry(entry);\n          }\n          return thrown;\n        }\n      }\n\n      // The context.catch method must only be called with a location\n      // argument that corresponds to a known catch block.\n      throw new Error(\"illegal catch attempt\");\n    },\n\n    delegateYield: function(iterable, resultName, nextLoc) {\n      this.delegate = {\n        iterator: values(iterable),\n        resultName: resultName,\n        nextLoc: nextLoc\n      };\n\n      return ContinueSentinel;\n    }\n  };\n})(\n  // Among the various tricks for obtaining a reference to the global\n  // object, this seems to be the most reliable technique that does not\n  // use indirect eval (which violates Content Security Policy).\n  typeof global === \"object\" ? global :\n  typeof window === \"object\" ? window :\n  typeof self === \"object\" ? self : this\n);\n\n}).call(this,require('_process'),typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {})\n//# sourceMappingURL=data:application/json;charset:utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9yZWdlbmVyYXRvci1ydW50aW1lL3J1bnRpbWUuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIENvcHlyaWdodCAoYykgMjAxNCwgRmFjZWJvb2ssIEluYy5cbiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4gKlxuICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgQlNELXN0eWxlIGxpY2Vuc2UgZm91bmQgaW4gdGhlXG4gKiBodHRwczovL3Jhdy5naXRodWIuY29tL2ZhY2Vib29rL3JlZ2VuZXJhdG9yL21hc3Rlci9MSUNFTlNFIGZpbGUuIEFuXG4gKiBhZGRpdGlvbmFsIGdyYW50IG9mIHBhdGVudCByaWdodHMgY2FuIGJlIGZvdW5kIGluIHRoZSBQQVRFTlRTIGZpbGUgaW5cbiAqIHRoZSBzYW1lIGRpcmVjdG9yeS5cbiAqL1xuXG4hKGZ1bmN0aW9uKGdsb2JhbCkge1xuICBcInVzZSBzdHJpY3RcIjtcblxuICB2YXIgaGFzT3duID0gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eTtcbiAgdmFyIHVuZGVmaW5lZDsgLy8gTW9yZSBjb21wcmVzc2libGUgdGhhbiB2b2lkIDAuXG4gIHZhciAkU3ltYm9sID0gdHlwZW9mIFN5bWJvbCA9PT0gXCJmdW5jdGlvblwiID8gU3ltYm9sIDoge307XG4gIHZhciBpdGVyYXRvclN5bWJvbCA9ICRTeW1ib2wuaXRlcmF0b3IgfHwgXCJAQGl0ZXJhdG9yXCI7XG4gIHZhciB0b1N0cmluZ1RhZ1N5bWJvbCA9ICRTeW1ib2wudG9TdHJpbmdUYWcgfHwgXCJAQHRvU3RyaW5nVGFnXCI7XG5cbiAgdmFyIGluTW9kdWxlID0gdHlwZW9mIG1vZHVsZSA9PT0gXCJvYmplY3RcIjtcbiAgdmFyIHJ1bnRpbWUgPSBnbG9iYWwucmVnZW5lcmF0b3JSdW50aW1lO1xuICBpZiAocnVudGltZSkge1xuICAgIGlmIChpbk1vZHVsZSkge1xuICAgICAgLy8gSWYgcmVnZW5lcmF0b3JSdW50aW1lIGlzIGRlZmluZWQgZ2xvYmFsbHkgYW5kIHdlJ3JlIGluIGEgbW9kdWxlLFxuICAgICAgLy8gbWFrZSB0aGUgZXhwb3J0cyBvYmplY3QgaWRlbnRpY2FsIHRvIHJlZ2VuZXJhdG9yUnVudGltZS5cbiAgICAgIG1vZHVsZS5leHBvcnRzID0gcnVudGltZTtcbiAgICB9XG4gICAgLy8gRG9uJ3QgYm90aGVyIGV2YWx1YXRpbmcgdGhlIHJlc3Qgb2YgdGhpcyBmaWxlIGlmIHRoZSBydW50aW1lIHdhc1xuICAgIC8vIGFscmVhZHkgZGVmaW5lZCBnbG9iYWxseS5cbiAgICByZXR1cm47XG4gIH1cblxuICAvLyBEZWZpbmUgdGhlIHJ1bnRpbWUgZ2xvYmFsbHkgKGFzIGV4cGVjdGVkIGJ5IGdlbmVyYXRlZCBjb2RlKSBhcyBlaXRoZXJcbiAgLy8gbW9kdWxlLmV4cG9ydHMgKGlmIHdlJ3JlIGluIGEgbW9kdWxlKSBvciBhIG5ldywgZW1wdHkgb2JqZWN0LlxuICBydW50aW1lID0gZ2xvYmFsLnJlZ2VuZXJhdG9yUnVudGltZSA9IGluTW9kdWxlID8gbW9kdWxlLmV4cG9ydHMgOiB7fTtcblxuICBmdW5jdGlvbiB3cmFwKGlubmVyRm4sIG91dGVyRm4sIHNlbGYsIHRyeUxvY3NMaXN0KSB7XG4gICAgLy8gSWYgb3V0ZXJGbiBwcm92aWRlZCBhbmQgb3V0ZXJGbi5wcm90b3R5cGUgaXMgYSBHZW5lcmF0b3IsIHRoZW4gb3V0ZXJGbi5wcm90b3R5cGUgaW5zdGFuY2VvZiBHZW5lcmF0b3IuXG4gICAgdmFyIHByb3RvR2VuZXJhdG9yID0gb3V0ZXJGbiAmJiBvdXRlckZuLnByb3RvdHlwZSBpbnN0YW5jZW9mIEdlbmVyYXRvciA/IG91dGVyRm4gOiBHZW5lcmF0b3I7XG4gICAgdmFyIGdlbmVyYXRvciA9IE9iamVjdC5jcmVhdGUocHJvdG9HZW5lcmF0b3IucHJvdG90eXBlKTtcbiAgICB2YXIgY29udGV4dCA9IG5ldyBDb250ZXh0KHRyeUxvY3NMaXN0IHx8IFtdKTtcblxuICAgIC8vIFRoZSAuX2ludm9rZSBtZXRob2QgdW5pZmllcyB0aGUgaW1wbGVtZW50YXRpb25zIG9mIHRoZSAubmV4dCxcbiAgICAvLyAudGhyb3csIGFuZCAucmV0dXJuIG1ldGhvZHMuXG4gICAgZ2VuZXJhdG9yLl9pbnZva2UgPSBtYWtlSW52b2tlTWV0aG9kKGlubmVyRm4sIHNlbGYsIGNvbnRleHQpO1xuXG4gICAgcmV0dXJuIGdlbmVyYXRvcjtcbiAgfVxuICBydW50aW1lLndyYXAgPSB3cmFwO1xuXG4gIC8vIFRyeS9jYXRjaCBoZWxwZXIgdG8gbWluaW1pemUgZGVvcHRpbWl6YXRpb25zLiBSZXR1cm5zIGEgY29tcGxldGlvblxuICAvLyByZWNvcmQgbGlrZSBjb250ZXh0LnRyeUVudHJpZXNbaV0uY29tcGxldGlvbi4gVGhpcyBpbnRlcmZhY2UgY291bGRcbiAgLy8gaGF2ZSBiZWVuIChhbmQgd2FzIHByZXZpb3VzbHkpIGRlc2lnbmVkIHRvIHRha2UgYSBjbG9zdXJlIHRvIGJlXG4gIC8vIGludm9rZWQgd2l0aG91dCBhcmd1bWVudHMsIGJ1dCBpbiBhbGwgdGhlIGNhc2VzIHdlIGNhcmUgYWJvdXQgd2VcbiAgLy8gYWxyZWFkeSBoYXZlIGFuIGV4aXN0aW5nIG1ldGhvZCB3ZSB3YW50IHRvIGNhbGwsIHNvIHRoZXJlJ3Mgbm8gbmVlZFxuICAvLyB0byBjcmVhdGUgYSBuZXcgZnVuY3Rpb24gb2JqZWN0LiBXZSBjYW4gZXZlbiBnZXQgYXdheSB3aXRoIGFzc3VtaW5nXG4gIC8vIHRoZSBtZXRob2QgdGFrZXMgZXhhY3RseSBvbmUgYXJndW1lbnQsIHNpbmNlIHRoYXQgaGFwcGVucyB0byBiZSB0cnVlXG4gIC8vIGluIGV2ZXJ5IGNhc2UsIHNvIHdlIGRvbid0IGhhdmUgdG8gdG91Y2ggdGhlIGFyZ3VtZW50cyBvYmplY3QuIFRoZVxuICAvLyBvbmx5IGFkZGl0aW9uYWwgYWxsb2NhdGlvbiByZXF1aXJlZCBpcyB0aGUgY29tcGxldGlvbiByZWNvcmQsIHdoaWNoXG4gIC8vIGhhcyBhIHN0YWJsZSBzaGFwZSBhbmQgc28gaG9wZWZ1bGx5IHNob3VsZCBiZSBjaGVhcCB0byBhbGxvY2F0ZS5cbiAgZnVuY3Rpb24gdHJ5Q2F0Y2goZm4sIG9iaiwgYXJnKSB7XG4gICAgdHJ5IHtcbiAgICAgIHJldHVybiB7IHR5cGU6IFwibm9ybWFsXCIsIGFyZzogZm4uY2FsbChvYmosIGFyZykgfTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIHJldHVybiB7IHR5cGU6IFwidGhyb3dcIiwgYXJnOiBlcnIgfTtcbiAgICB9XG4gIH1cblxuICB2YXIgR2VuU3RhdGVTdXNwZW5kZWRTdGFydCA9IFwic3VzcGVuZGVkU3RhcnRcIjtcbiAgdmFyIEdlblN0YXRlU3VzcGVuZGVkWWllbGQgPSBcInN1c3BlbmRlZFlpZWxkXCI7XG4gIHZhciBHZW5TdGF0ZUV4ZWN1dGluZyA9IFwiZXhlY3V0aW5nXCI7XG4gIHZhciBHZW5TdGF0ZUNvbXBsZXRlZCA9IFwiY29tcGxldGVkXCI7XG5cbiAgLy8gUmV0dXJuaW5nIHRoaXMgb2JqZWN0IGZyb20gdGhlIGlubmVyRm4gaGFzIHRoZSBzYW1lIGVmZmVjdCBhc1xuICAvLyBicmVha2luZyBvdXQgb2YgdGhlIGRpc3BhdGNoIHN3aXRjaCBzdGF0ZW1lbnQuXG4gIHZhciBDb250aW51ZVNlbnRpbmVsID0ge307XG5cbiAgLy8gRHVtbXkgY29uc3RydWN0b3IgZnVuY3Rpb25zIHRoYXQgd2UgdXNlIGFzIHRoZSAuY29uc3RydWN0b3IgYW5kXG4gIC8vIC5jb25zdHJ1Y3Rvci5wcm90b3R5cGUgcHJvcGVydGllcyBmb3IgZnVuY3Rpb25zIHRoYXQgcmV0dXJuIEdlbmVyYXRvclxuICAvLyBvYmplY3RzLiBGb3IgZnVsbCBzcGVjIGNvbXBsaWFuY2UsIHlvdSBtYXkgd2lzaCB0byBjb25maWd1cmUgeW91clxuICAvLyBtaW5pZmllciBub3QgdG8gbWFuZ2xlIHRoZSBuYW1lcyBvZiB0aGVzZSB0d28gZnVuY3Rpb25zLlxuICBmdW5jdGlvbiBHZW5lcmF0b3IoKSB7fVxuICBmdW5jdGlvbiBHZW5lcmF0b3JGdW5jdGlvbigpIHt9XG4gIGZ1bmN0aW9uIEdlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlKCkge31cblxuICB2YXIgR3AgPSBHZW5lcmF0b3JGdW5jdGlvblByb3RvdHlwZS5wcm90b3R5cGUgPSBHZW5lcmF0b3IucHJvdG90eXBlO1xuICBHZW5lcmF0b3JGdW5jdGlvbi5wcm90b3R5cGUgPSBHcC5jb25zdHJ1Y3RvciA9IEdlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlO1xuICBHZW5lcmF0b3JGdW5jdGlvblByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IEdlbmVyYXRvckZ1bmN0aW9uO1xuICBHZW5lcmF0b3JGdW5jdGlvblByb3RvdHlwZVt0b1N0cmluZ1RhZ1N5bWJvbF0gPSBHZW5lcmF0b3JGdW5jdGlvbi5kaXNwbGF5TmFtZSA9IFwiR2VuZXJhdG9yRnVuY3Rpb25cIjtcblxuICAvLyBIZWxwZXIgZm9yIGRlZmluaW5nIHRoZSAubmV4dCwgLnRocm93LCBhbmQgLnJldHVybiBtZXRob2RzIG9mIHRoZVxuICAvLyBJdGVyYXRvciBpbnRlcmZhY2UgaW4gdGVybXMgb2YgYSBzaW5nbGUgLl9pbnZva2UgbWV0aG9kLlxuICBmdW5jdGlvbiBkZWZpbmVJdGVyYXRvck1ldGhvZHMocHJvdG90eXBlKSB7XG4gICAgW1wibmV4dFwiLCBcInRocm93XCIsIFwicmV0dXJuXCJdLmZvckVhY2goZnVuY3Rpb24obWV0aG9kKSB7XG4gICAgICBwcm90b3R5cGVbbWV0aG9kXSA9IGZ1bmN0aW9uKGFyZykge1xuICAgICAgICByZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgYXJnKTtcbiAgICAgIH07XG4gICAgfSk7XG4gIH1cblxuICBydW50aW1lLmlzR2VuZXJhdG9yRnVuY3Rpb24gPSBmdW5jdGlvbihnZW5GdW4pIHtcbiAgICB2YXIgY3RvciA9IHR5cGVvZiBnZW5GdW4gPT09IFwiZnVuY3Rpb25cIiAmJiBnZW5GdW4uY29uc3RydWN0b3I7XG4gICAgcmV0dXJuIGN0b3JcbiAgICAgID8gY3RvciA9PT0gR2VuZXJhdG9yRnVuY3Rpb24gfHxcbiAgICAgICAgLy8gRm9yIHRoZSBuYXRpdmUgR2VuZXJhdG9yRnVuY3Rpb24gY29uc3RydWN0b3IsIHRoZSBiZXN0IHdlIGNhblxuICAgICAgICAvLyBkbyBpcyB0byBjaGVjayBpdHMgLm5hbWUgcHJvcGVydHkuXG4gICAgICAgIChjdG9yLmRpc3BsYXlOYW1lIHx8IGN0b3IubmFtZSkgPT09IFwiR2VuZXJhdG9yRnVuY3Rpb25cIlxuICAgICAgOiBmYWxzZTtcbiAgfTtcblxuICBydW50aW1lLm1hcmsgPSBmdW5jdGlvbihnZW5GdW4pIHtcbiAgICBpZiAoT2JqZWN0LnNldFByb3RvdHlwZU9mKSB7XG4gICAgICBPYmplY3Quc2V0UHJvdG90eXBlT2YoZ2VuRnVuLCBHZW5lcmF0b3JGdW5jdGlvblByb3RvdHlwZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGdlbkZ1bi5fX3Byb3RvX18gPSBHZW5lcmF0b3JGdW5jdGlvblByb3RvdHlwZTtcbiAgICAgIGlmICghKHRvU3RyaW5nVGFnU3ltYm9sIGluIGdlbkZ1bikpIHtcbiAgICAgICAgZ2VuRnVuW3RvU3RyaW5nVGFnU3ltYm9sXSA9IFwiR2VuZXJhdG9yRnVuY3Rpb25cIjtcbiAgICAgIH1cbiAgICB9XG4gICAgZ2VuRnVuLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoR3ApO1xuICAgIHJldHVybiBnZW5GdW47XG4gIH07XG5cbiAgLy8gV2l0aGluIHRoZSBib2R5IG9mIGFueSBhc3luYyBmdW5jdGlvbiwgYGF3YWl0IHhgIGlzIHRyYW5zZm9ybWVkIHRvXG4gIC8vIGB5aWVsZCByZWdlbmVyYXRvclJ1bnRpbWUuYXdyYXAoeClgLCBzbyB0aGF0IHRoZSBydW50aW1lIGNhbiB0ZXN0XG4gIC8vIGB2YWx1ZSBpbnN0YW5jZW9mIEF3YWl0QXJndW1lbnRgIHRvIGRldGVybWluZSBpZiB0aGUgeWllbGRlZCB2YWx1ZSBpc1xuICAvLyBtZWFudCB0byBiZSBhd2FpdGVkLiBTb21lIG1heSBjb25zaWRlciB0aGUgbmFtZSBvZiB0aGlzIG1ldGhvZCB0b29cbiAgLy8gY3V0ZXN5LCBidXQgdGhleSBhcmUgY3VybXVkZ2VvbnMuXG4gIHJ1bnRpbWUuYXdyYXAgPSBmdW5jdGlvbihhcmcpIHtcbiAgICByZXR1cm4gbmV3IEF3YWl0QXJndW1lbnQoYXJnKTtcbiAgfTtcblxuICBmdW5jdGlvbiBBd2FpdEFyZ3VtZW50KGFyZykge1xuICAgIHRoaXMuYXJnID0gYXJnO1xuICB9XG5cbiAgZnVuY3Rpb24gQXN5bmNJdGVyYXRvcihnZW5lcmF0b3IpIHtcbiAgICBmdW5jdGlvbiBpbnZva2UobWV0aG9kLCBhcmcsIHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgdmFyIHJlY29yZCA9IHRyeUNhdGNoKGdlbmVyYXRvclttZXRob2RdLCBnZW5lcmF0b3IsIGFyZyk7XG4gICAgICBpZiAocmVjb3JkLnR5cGUgPT09IFwidGhyb3dcIikge1xuICAgICAgICByZWplY3QocmVjb3JkLmFyZyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB2YXIgcmVzdWx0ID0gcmVjb3JkLmFyZztcbiAgICAgICAgdmFyIHZhbHVlID0gcmVzdWx0LnZhbHVlO1xuICAgICAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBBd2FpdEFyZ3VtZW50KSB7XG4gICAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh2YWx1ZS5hcmcpLnRoZW4oZnVuY3Rpb24odmFsdWUpIHtcbiAgICAgICAgICAgIGludm9rZShcIm5leHRcIiwgdmFsdWUsIHJlc29sdmUsIHJlamVjdCk7XG4gICAgICAgICAgfSwgZnVuY3Rpb24oZXJyKSB7XG4gICAgICAgICAgICBpbnZva2UoXCJ0aHJvd1wiLCBlcnIsIHJlc29sdmUsIHJlamVjdCk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHZhbHVlKS50aGVuKGZ1bmN0aW9uKHVud3JhcHBlZCkge1xuICAgICAgICAgIC8vIFdoZW4gYSB5aWVsZGVkIFByb21pc2UgaXMgcmVzb2x2ZWQsIGl0cyBmaW5hbCB2YWx1ZSBiZWNvbWVzXG4gICAgICAgICAgLy8gdGhlIC52YWx1ZSBvZiB0aGUgUHJvbWlzZTx7dmFsdWUsZG9uZX0+IHJlc3VsdCBmb3IgdGhlXG4gICAgICAgICAgLy8gY3VycmVudCBpdGVyYXRpb24uIElmIHRoZSBQcm9taXNlIGlzIHJlamVjdGVkLCBob3dldmVyLCB0aGVcbiAgICAgICAgICAvLyByZXN1bHQgZm9yIHRoaXMgaXRlcmF0aW9uIHdpbGwgYmUgcmVqZWN0ZWQgd2l0aCB0aGUgc2FtZVxuICAgICAgICAgIC8vIHJlYXNvbi4gTm90ZSB0aGF0IHJlamVjdGlvbnMgb2YgeWllbGRlZCBQcm9taXNlcyBhcmUgbm90XG4gICAgICAgICAgLy8gdGhyb3duIGJhY2sgaW50byB0aGUgZ2VuZXJhdG9yIGZ1bmN0aW9uLCBhcyBpcyB0aGUgY2FzZVxuICAgICAgICAgIC8vIHdoZW4gYW4gYXdhaXRlZCBQcm9taXNlIGlzIHJlamVjdGVkLiBUaGlzIGRpZmZlcmVuY2UgaW5cbiAgICAgICAgICAvLyBiZWhhdmlvciBiZXR3ZWVuIHlpZWxkIGFuZCBhd2FpdCBpcyBpbXBvcnRhbnQsIGJlY2F1c2UgaXRcbiAgICAgICAgICAvLyBhbGxvd3MgdGhlIGNvbnN1bWVyIHRvIGRlY2lkZSB3aGF0IHRvIGRvIHdpdGggdGhlIHlpZWxkZWRcbiAgICAgICAgICAvLyByZWplY3Rpb24gKHN3YWxsb3cgaXQgYW5kIGNvbnRpbnVlLCBtYW51YWxseSAudGhyb3cgaXQgYmFja1xuICAgICAgICAgIC8vIGludG8gdGhlIGdlbmVyYXRvciwgYWJhbmRvbiBpdGVyYXRpb24sIHdoYXRldmVyKS4gV2l0aFxuICAgICAgICAgIC8vIGF3YWl0LCBieSBjb250cmFzdCwgdGhlcmUgaXMgbm8gb3Bwb3J0dW5pdHkgdG8gZXhhbWluZSB0aGVcbiAgICAgICAgICAvLyByZWplY3Rpb24gcmVhc29uIG91dHNpZGUgdGhlIGdlbmVyYXRvciBmdW5jdGlvbiwgc28gdGhlXG4gICAgICAgICAgLy8gb25seSBvcHRpb24gaXMgdG8gdGhyb3cgaXQgZnJvbSB0aGUgYXdhaXQgZXhwcmVzc2lvbiwgYW5kXG4gICAgICAgICAgLy8gbGV0IHRoZSBnZW5lcmF0b3IgZnVuY3Rpb24gaGFuZGxlIHRoZSBleGNlcHRpb24uXG4gICAgICAgICAgcmVzdWx0LnZhbHVlID0gdW53cmFwcGVkO1xuICAgICAgICAgIHJlc29sdmUocmVzdWx0KTtcbiAgICAgICAgfSwgcmVqZWN0KTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAodHlwZW9mIHByb2Nlc3MgPT09IFwib2JqZWN0XCIgJiYgcHJvY2Vzcy5kb21haW4pIHtcbiAgICAgIGludm9rZSA9IHByb2Nlc3MuZG9tYWluLmJpbmQoaW52b2tlKTtcbiAgICB9XG5cbiAgICB2YXIgcHJldmlvdXNQcm9taXNlO1xuXG4gICAgZnVuY3Rpb24gZW5xdWV1ZShtZXRob2QsIGFyZykge1xuICAgICAgZnVuY3Rpb24gY2FsbEludm9rZVdpdGhNZXRob2RBbmRBcmcoKSB7XG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgICBpbnZva2UobWV0aG9kLCBhcmcsIHJlc29sdmUsIHJlamVjdCk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gcHJldmlvdXNQcm9taXNlID1cbiAgICAgICAgLy8gSWYgZW5xdWV1ZSBoYXMgYmVlbiBjYWxsZWQgYmVmb3JlLCB0aGVuIHdlIHdhbnQgdG8gd2FpdCB1bnRpbFxuICAgICAgICAvLyBhbGwgcHJldmlvdXMgUHJvbWlzZXMgaGF2ZSBiZWVuIHJlc29sdmVkIGJlZm9yZSBjYWxsaW5nIGludm9rZSxcbiAgICAgICAgLy8gc28gdGhhdCByZXN1bHRzIGFyZSBhbHdheXMgZGVsaXZlcmVkIGluIHRoZSBjb3JyZWN0IG9yZGVyLiBJZlxuICAgICAgICAvLyBlbnF1ZXVlIGhhcyBub3QgYmVlbiBjYWxsZWQgYmVmb3JlLCB0aGVuIGl0IGlzIGltcG9ydGFudCB0b1xuICAgICAgICAvLyBjYWxsIGludm9rZSBpbW1lZGlhdGVseSwgd2l0aG91dCB3YWl0aW5nIG9uIGEgY2FsbGJhY2sgdG8gZmlyZSxcbiAgICAgICAgLy8gc28gdGhhdCB0aGUgYXN5bmMgZ2VuZXJhdG9yIGZ1bmN0aW9uIGhhcyB0aGUgb3Bwb3J0dW5pdHkgdG8gZG9cbiAgICAgICAgLy8gYW55IG5lY2Vzc2FyeSBzZXR1cCBpbiBhIHByZWRpY3RhYmxlIHdheS4gVGhpcyBwcmVkaWN0YWJpbGl0eVxuICAgICAgICAvLyBpcyB3aHkgdGhlIFByb21pc2UgY29uc3RydWN0b3Igc3luY2hyb25vdXNseSBpbnZva2VzIGl0c1xuICAgICAgICAvLyBleGVjdXRvciBjYWxsYmFjaywgYW5kIHdoeSBhc3luYyBmdW5jdGlvbnMgc3luY2hyb25vdXNseVxuICAgICAgICAvLyBleGVjdXRlIGNvZGUgYmVmb3JlIHRoZSBmaXJzdCBhd2FpdC4gU2luY2Ugd2UgaW1wbGVtZW50IHNpbXBsZVxuICAgICAgICAvLyBhc3luYyBmdW5jdGlvbnMgaW4gdGVybXMgb2YgYXN5bmMgZ2VuZXJhdG9ycywgaXQgaXMgZXNwZWNpYWxseVxuICAgICAgICAvLyBpbXBvcnRhbnQgdG8gZ2V0IHRoaXMgcmlnaHQsIGV2ZW4gdGhvdWdoIGl0IHJlcXVpcmVzIGNhcmUuXG4gICAgICAgIHByZXZpb3VzUHJvbWlzZSA/IHByZXZpb3VzUHJvbWlzZS50aGVuKFxuICAgICAgICAgIGNhbGxJbnZva2VXaXRoTWV0aG9kQW5kQXJnLFxuICAgICAgICAgIC8vIEF2b2lkIHByb3BhZ2F0aW5nIGZhaWx1cmVzIHRvIFByb21pc2VzIHJldHVybmVkIGJ5IGxhdGVyXG4gICAgICAgICAgLy8gaW52b2NhdGlvbnMgb2YgdGhlIGl0ZXJhdG9yLlxuICAgICAgICAgIGNhbGxJbnZva2VXaXRoTWV0aG9kQW5kQXJnXG4gICAgICAgICkgOiBjYWxsSW52b2tlV2l0aE1ldGhvZEFuZEFyZygpO1xuICAgIH1cblxuICAgIC8vIERlZmluZSB0aGUgdW5pZmllZCBoZWxwZXIgbWV0aG9kIHRoYXQgaXMgdXNlZCB0byBpbXBsZW1lbnQgLm5leHQsXG4gICAgLy8gLnRocm93LCBhbmQgLnJldHVybiAoc2VlIGRlZmluZUl0ZXJhdG9yTWV0aG9kcykuXG4gICAgdGhpcy5faW52b2tlID0gZW5xdWV1ZTtcbiAgfVxuXG4gIGRlZmluZUl0ZXJhdG9yTWV0aG9kcyhBc3luY0l0ZXJhdG9yLnByb3RvdHlwZSk7XG5cbiAgLy8gTm90ZSB0aGF0IHNpbXBsZSBhc3luYyBmdW5jdGlvbnMgYXJlIGltcGxlbWVudGVkIG9uIHRvcCBvZlxuICAvLyBBc3luY0l0ZXJhdG9yIG9iamVjdHM7IHRoZXkganVzdCByZXR1cm4gYSBQcm9taXNlIGZvciB0aGUgdmFsdWUgb2ZcbiAgLy8gdGhlIGZpbmFsIHJlc3VsdCBwcm9kdWNlZCBieSB0aGUgaXRlcmF0b3IuXG4gIHJ1bnRpbWUuYXN5bmMgPSBmdW5jdGlvbihpbm5lckZuLCBvdXRlckZuLCBzZWxmLCB0cnlMb2NzTGlzdCkge1xuICAgIHZhciBpdGVyID0gbmV3IEFzeW5jSXRlcmF0b3IoXG4gICAgICB3cmFwKGlubmVyRm4sIG91dGVyRm4sIHNlbGYsIHRyeUxvY3NMaXN0KVxuICAgICk7XG5cbiAgICByZXR1cm4gcnVudGltZS5pc0dlbmVyYXRvckZ1bmN0aW9uKG91dGVyRm4pXG4gICAgICA/IGl0ZXIgLy8gSWYgb3V0ZXJGbiBpcyBhIGdlbmVyYXRvciwgcmV0dXJuIHRoZSBmdWxsIGl0ZXJhdG9yLlxuICAgICAgOiBpdGVyLm5leHQoKS50aGVuKGZ1bmN0aW9uKHJlc3VsdCkge1xuICAgICAgICAgIHJldHVybiByZXN1bHQuZG9uZSA/IHJlc3VsdC52YWx1ZSA6IGl0ZXIubmV4dCgpO1xuICAgICAgICB9KTtcbiAgfTtcblxuICBmdW5jdGlvbiBtYWtlSW52b2tlTWV0aG9kKGlubmVyRm4sIHNlbGYsIGNvbnRleHQpIHtcbiAgICB2YXIgc3RhdGUgPSBHZW5TdGF0ZVN1c3BlbmRlZFN0YXJ0O1xuXG4gICAgcmV0dXJuIGZ1bmN0aW9uIGludm9rZShtZXRob2QsIGFyZykge1xuICAgICAgaWYgKHN0YXRlID09PSBHZW5TdGF0ZUV4ZWN1dGluZykge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJHZW5lcmF0b3IgaXMgYWxyZWFkeSBydW5uaW5nXCIpO1xuICAgICAgfVxuXG4gICAgICBpZiAoc3RhdGUgPT09IEdlblN0YXRlQ29tcGxldGVkKSB7XG4gICAgICAgIGlmIChtZXRob2QgPT09IFwidGhyb3dcIikge1xuICAgICAgICAgIHRocm93IGFyZztcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEJlIGZvcmdpdmluZywgcGVyIDI1LjMuMy4zLjMgb2YgdGhlIHNwZWM6XG4gICAgICAgIC8vIGh0dHBzOi8vcGVvcGxlLm1vemlsbGEub3JnL35qb3JlbmRvcmZmL2VzNi1kcmFmdC5odG1sI3NlYy1nZW5lcmF0b3JyZXN1bWVcbiAgICAgICAgcmV0dXJuIGRvbmVSZXN1bHQoKTtcbiAgICAgIH1cblxuICAgICAgd2hpbGUgKHRydWUpIHtcbiAgICAgICAgdmFyIGRlbGVnYXRlID0gY29udGV4dC5kZWxlZ2F0ZTtcbiAgICAgICAgaWYgKGRlbGVnYXRlKSB7XG4gICAgICAgICAgaWYgKG1ldGhvZCA9PT0gXCJyZXR1cm5cIiB8fFxuICAgICAgICAgICAgICAobWV0aG9kID09PSBcInRocm93XCIgJiYgZGVsZWdhdGUuaXRlcmF0b3JbbWV0aG9kXSA9PT0gdW5kZWZpbmVkKSkge1xuICAgICAgICAgICAgLy8gQSByZXR1cm4gb3IgdGhyb3cgKHdoZW4gdGhlIGRlbGVnYXRlIGl0ZXJhdG9yIGhhcyBubyB0aHJvd1xuICAgICAgICAgICAgLy8gbWV0aG9kKSBhbHdheXMgdGVybWluYXRlcyB0aGUgeWllbGQqIGxvb3AuXG4gICAgICAgICAgICBjb250ZXh0LmRlbGVnYXRlID0gbnVsbDtcblxuICAgICAgICAgICAgLy8gSWYgdGhlIGRlbGVnYXRlIGl0ZXJhdG9yIGhhcyBhIHJldHVybiBtZXRob2QsIGdpdmUgaXQgYVxuICAgICAgICAgICAgLy8gY2hhbmNlIHRvIGNsZWFuIHVwLlxuICAgICAgICAgICAgdmFyIHJldHVybk1ldGhvZCA9IGRlbGVnYXRlLml0ZXJhdG9yW1wicmV0dXJuXCJdO1xuICAgICAgICAgICAgaWYgKHJldHVybk1ldGhvZCkge1xuICAgICAgICAgICAgICB2YXIgcmVjb3JkID0gdHJ5Q2F0Y2gocmV0dXJuTWV0aG9kLCBkZWxlZ2F0ZS5pdGVyYXRvciwgYXJnKTtcbiAgICAgICAgICAgICAgaWYgKHJlY29yZC50eXBlID09PSBcInRocm93XCIpIHtcbiAgICAgICAgICAgICAgICAvLyBJZiB0aGUgcmV0dXJuIG1ldGhvZCB0aHJldyBhbiBleGNlcHRpb24sIGxldCB0aGF0XG4gICAgICAgICAgICAgICAgLy8gZXhjZXB0aW9uIHByZXZhaWwgb3ZlciB0aGUgb3JpZ2luYWwgcmV0dXJuIG9yIHRocm93LlxuICAgICAgICAgICAgICAgIG1ldGhvZCA9IFwidGhyb3dcIjtcbiAgICAgICAgICAgICAgICBhcmcgPSByZWNvcmQuYXJnO1xuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChtZXRob2QgPT09IFwicmV0dXJuXCIpIHtcbiAgICAgICAgICAgICAgLy8gQ29udGludWUgd2l0aCB0aGUgb3V0ZXIgcmV0dXJuLCBub3cgdGhhdCB0aGUgZGVsZWdhdGVcbiAgICAgICAgICAgICAgLy8gaXRlcmF0b3IgaGFzIGJlZW4gdGVybWluYXRlZC5cbiAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgdmFyIHJlY29yZCA9IHRyeUNhdGNoKFxuICAgICAgICAgICAgZGVsZWdhdGUuaXRlcmF0b3JbbWV0aG9kXSxcbiAgICAgICAgICAgIGRlbGVnYXRlLml0ZXJhdG9yLFxuICAgICAgICAgICAgYXJnXG4gICAgICAgICAgKTtcblxuICAgICAgICAgIGlmIChyZWNvcmQudHlwZSA9PT0gXCJ0aHJvd1wiKSB7XG4gICAgICAgICAgICBjb250ZXh0LmRlbGVnYXRlID0gbnVsbDtcblxuICAgICAgICAgICAgLy8gTGlrZSByZXR1cm5pbmcgZ2VuZXJhdG9yLnRocm93KHVuY2F1Z2h0KSwgYnV0IHdpdGhvdXQgdGhlXG4gICAgICAgICAgICAvLyBvdmVyaGVhZCBvZiBhbiBleHRyYSBmdW5jdGlvbiBjYWxsLlxuICAgICAgICAgICAgbWV0aG9kID0gXCJ0aHJvd1wiO1xuICAgICAgICAgICAgYXJnID0gcmVjb3JkLmFyZztcbiAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIC8vIERlbGVnYXRlIGdlbmVyYXRvciByYW4gYW5kIGhhbmRsZWQgaXRzIG93biBleGNlcHRpb25zIHNvXG4gICAgICAgICAgLy8gcmVnYXJkbGVzcyBvZiB3aGF0IHRoZSBtZXRob2Qgd2FzLCB3ZSBjb250aW51ZSBhcyBpZiBpdCBpc1xuICAgICAgICAgIC8vIFwibmV4dFwiIHdpdGggYW4gdW5kZWZpbmVkIGFyZy5cbiAgICAgICAgICBtZXRob2QgPSBcIm5leHRcIjtcbiAgICAgICAgICBhcmcgPSB1bmRlZmluZWQ7XG5cbiAgICAgICAgICB2YXIgaW5mbyA9IHJlY29yZC5hcmc7XG4gICAgICAgICAgaWYgKGluZm8uZG9uZSkge1xuICAgICAgICAgICAgY29udGV4dFtkZWxlZ2F0ZS5yZXN1bHROYW1lXSA9IGluZm8udmFsdWU7XG4gICAgICAgICAgICBjb250ZXh0Lm5leHQgPSBkZWxlZ2F0ZS5uZXh0TG9jO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBzdGF0ZSA9IEdlblN0YXRlU3VzcGVuZGVkWWllbGQ7XG4gICAgICAgICAgICByZXR1cm4gaW5mbztcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBjb250ZXh0LmRlbGVnYXRlID0gbnVsbDtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChtZXRob2QgPT09IFwibmV4dFwiKSB7XG4gICAgICAgICAgLy8gU2V0dGluZyBjb250ZXh0Ll9zZW50IGZvciBsZWdhY3kgc3VwcG9ydCBvZiBCYWJlbCdzXG4gICAgICAgICAgLy8gZnVuY3Rpb24uc2VudCBpbXBsZW1lbnRhdGlvbi5cbiAgICAgICAgICBjb250ZXh0LnNlbnQgPSBjb250ZXh0Ll9zZW50ID0gYXJnO1xuXG4gICAgICAgIH0gZWxzZSBpZiAobWV0aG9kID09PSBcInRocm93XCIpIHtcbiAgICAgICAgICBpZiAoc3RhdGUgPT09IEdlblN0YXRlU3VzcGVuZGVkU3RhcnQpIHtcbiAgICAgICAgICAgIHN0YXRlID0gR2VuU3RhdGVDb21wbGV0ZWQ7XG4gICAgICAgICAgICB0aHJvdyBhcmc7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgaWYgKGNvbnRleHQuZGlzcGF0Y2hFeGNlcHRpb24oYXJnKSkge1xuICAgICAgICAgICAgLy8gSWYgdGhlIGRpc3BhdGNoZWQgZXhjZXB0aW9uIHdhcyBjYXVnaHQgYnkgYSBjYXRjaCBibG9jayxcbiAgICAgICAgICAgIC8vIHRoZW4gbGV0IHRoYXQgY2F0Y2ggYmxvY2sgaGFuZGxlIHRoZSBleGNlcHRpb24gbm9ybWFsbHkuXG4gICAgICAgICAgICBtZXRob2QgPSBcIm5leHRcIjtcbiAgICAgICAgICAgIGFyZyA9IHVuZGVmaW5lZDtcbiAgICAgICAgICB9XG5cbiAgICAgICAgfSBlbHNlIGlmIChtZXRob2QgPT09IFwicmV0dXJuXCIpIHtcbiAgICAgICAgICBjb250ZXh0LmFicnVwdChcInJldHVyblwiLCBhcmcpO1xuICAgICAgICB9XG5cbiAgICAgICAgc3RhdGUgPSBHZW5TdGF0ZUV4ZWN1dGluZztcblxuICAgICAgICB2YXIgcmVjb3JkID0gdHJ5Q2F0Y2goaW5uZXJGbiwgc2VsZiwgY29udGV4dCk7XG4gICAgICAgIGlmIChyZWNvcmQudHlwZSA9PT0gXCJub3JtYWxcIikge1xuICAgICAgICAgIC8vIElmIGFuIGV4Y2VwdGlvbiBpcyB0aHJvd24gZnJvbSBpbm5lckZuLCB3ZSBsZWF2ZSBzdGF0ZSA9PT1cbiAgICAgICAgICAvLyBHZW5TdGF0ZUV4ZWN1dGluZyBhbmQgbG9vcCBiYWNrIGZvciBhbm90aGVyIGludm9jYXRpb24uXG4gICAgICAgICAgc3RhdGUgPSBjb250ZXh0LmRvbmVcbiAgICAgICAgICAgID8gR2VuU3RhdGVDb21wbGV0ZWRcbiAgICAgICAgICAgIDogR2VuU3RhdGVTdXNwZW5kZWRZaWVsZDtcblxuICAgICAgICAgIHZhciBpbmZvID0ge1xuICAgICAgICAgICAgdmFsdWU6IHJlY29yZC5hcmcsXG4gICAgICAgICAgICBkb25lOiBjb250ZXh0LmRvbmVcbiAgICAgICAgICB9O1xuXG4gICAgICAgICAgaWYgKHJlY29yZC5hcmcgPT09IENvbnRpbnVlU2VudGluZWwpIHtcbiAgICAgICAgICAgIGlmIChjb250ZXh0LmRlbGVnYXRlICYmIG1ldGhvZCA9PT0gXCJuZXh0XCIpIHtcbiAgICAgICAgICAgICAgLy8gRGVsaWJlcmF0ZWx5IGZvcmdldCB0aGUgbGFzdCBzZW50IHZhbHVlIHNvIHRoYXQgd2UgZG9uJ3RcbiAgICAgICAgICAgICAgLy8gYWNjaWRlbnRhbGx5IHBhc3MgaXQgb24gdG8gdGhlIGRlbGVnYXRlLlxuICAgICAgICAgICAgICBhcmcgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBpbmZvO1xuICAgICAgICAgIH1cblxuICAgICAgICB9IGVsc2UgaWYgKHJlY29yZC50eXBlID09PSBcInRocm93XCIpIHtcbiAgICAgICAgICBzdGF0ZSA9IEdlblN0YXRlQ29tcGxldGVkO1xuICAgICAgICAgIC8vIERpc3BhdGNoIHRoZSBleGNlcHRpb24gYnkgbG9vcGluZyBiYWNrIGFyb3VuZCB0byB0aGVcbiAgICAgICAgICAvLyBjb250ZXh0LmRpc3BhdGNoRXhjZXB0aW9uKGFyZykgY2FsbCBhYm92ZS5cbiAgICAgICAgICBtZXRob2QgPSBcInRocm93XCI7XG4gICAgICAgICAgYXJnID0gcmVjb3JkLmFyZztcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH07XG4gIH1cblxuICAvLyBEZWZpbmUgR2VuZXJhdG9yLnByb3RvdHlwZS57bmV4dCx0aHJvdyxyZXR1cm59IGluIHRlcm1zIG9mIHRoZVxuICAvLyB1bmlmaWVkIC5faW52b2tlIGhlbHBlciBtZXRob2QuXG4gIGRlZmluZUl0ZXJhdG9yTWV0aG9kcyhHcCk7XG5cbiAgR3BbaXRlcmF0b3JTeW1ib2xdID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH07XG5cbiAgR3BbdG9TdHJpbmdUYWdTeW1ib2xdID0gXCJHZW5lcmF0b3JcIjtcblxuICBHcC50b1N0cmluZyA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiBcIltvYmplY3QgR2VuZXJhdG9yXVwiO1xuICB9O1xuXG4gIGZ1bmN0aW9uIHB1c2hUcnlFbnRyeShsb2NzKSB7XG4gICAgdmFyIGVudHJ5ID0geyB0cnlMb2M6IGxvY3NbMF0gfTtcblxuICAgIGlmICgxIGluIGxvY3MpIHtcbiAgICAgIGVudHJ5LmNhdGNoTG9jID0gbG9jc1sxXTtcbiAgICB9XG5cbiAgICBpZiAoMiBpbiBsb2NzKSB7XG4gICAgICBlbnRyeS5maW5hbGx5TG9jID0gbG9jc1syXTtcbiAgICAgIGVudHJ5LmFmdGVyTG9jID0gbG9jc1szXTtcbiAgICB9XG5cbiAgICB0aGlzLnRyeUVudHJpZXMucHVzaChlbnRyeSk7XG4gIH1cblxuICBmdW5jdGlvbiByZXNldFRyeUVudHJ5KGVudHJ5KSB7XG4gICAgdmFyIHJlY29yZCA9IGVudHJ5LmNvbXBsZXRpb24gfHwge307XG4gICAgcmVjb3JkLnR5cGUgPSBcIm5vcm1hbFwiO1xuICAgIGRlbGV0ZSByZWNvcmQuYXJnO1xuICAgIGVudHJ5LmNvbXBsZXRpb24gPSByZWNvcmQ7XG4gIH1cblxuICBmdW5jdGlvbiBDb250ZXh0KHRyeUxvY3NMaXN0KSB7XG4gICAgLy8gVGhlIHJvb3QgZW50cnkgb2JqZWN0IChlZmZlY3RpdmVseSBhIHRyeSBzdGF0ZW1lbnQgd2l0aG91dCBhIGNhdGNoXG4gICAgLy8gb3IgYSBmaW5hbGx5IGJsb2NrKSBnaXZlcyB1cyBhIHBsYWNlIHRvIHN0b3JlIHZhbHVlcyB0aHJvd24gZnJvbVxuICAgIC8vIGxvY2F0aW9ucyB3aGVyZSB0aGVyZSBpcyBubyBlbmNsb3NpbmcgdHJ5IHN0YXRlbWVudC5cbiAgICB0aGlzLnRyeUVudHJpZXMgPSBbeyB0cnlMb2M6IFwicm9vdFwiIH1dO1xuICAgIHRyeUxvY3NMaXN0LmZvckVhY2gocHVzaFRyeUVudHJ5LCB0aGlzKTtcbiAgICB0aGlzLnJlc2V0KHRydWUpO1xuICB9XG5cbiAgcnVudGltZS5rZXlzID0gZnVuY3Rpb24ob2JqZWN0KSB7XG4gICAgdmFyIGtleXMgPSBbXTtcbiAgICBmb3IgKHZhciBrZXkgaW4gb2JqZWN0KSB7XG4gICAgICBrZXlzLnB1c2goa2V5KTtcbiAgICB9XG4gICAga2V5cy5yZXZlcnNlKCk7XG5cbiAgICAvLyBSYXRoZXIgdGhhbiByZXR1cm5pbmcgYW4gb2JqZWN0IHdpdGggYSBuZXh0IG1ldGhvZCwgd2Uga2VlcFxuICAgIC8vIHRoaW5ncyBzaW1wbGUgYW5kIHJldHVybiB0aGUgbmV4dCBmdW5jdGlvbiBpdHNlbGYuXG4gICAgcmV0dXJuIGZ1bmN0aW9uIG5leHQoKSB7XG4gICAgICB3aGlsZSAoa2V5cy5sZW5ndGgpIHtcbiAgICAgICAgdmFyIGtleSA9IGtleXMucG9wKCk7XG4gICAgICAgIGlmIChrZXkgaW4gb2JqZWN0KSB7XG4gICAgICAgICAgbmV4dC52YWx1ZSA9IGtleTtcbiAgICAgICAgICBuZXh0LmRvbmUgPSBmYWxzZTtcbiAgICAgICAgICByZXR1cm4gbmV4dDtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvLyBUbyBhdm9pZCBjcmVhdGluZyBhbiBhZGRpdGlvbmFsIG9iamVjdCwgd2UganVzdCBoYW5nIHRoZSAudmFsdWVcbiAgICAgIC8vIGFuZCAuZG9uZSBwcm9wZXJ0aWVzIG9mZiB0aGUgbmV4dCBmdW5jdGlvbiBvYmplY3QgaXRzZWxmLiBUaGlzXG4gICAgICAvLyBhbHNvIGVuc3VyZXMgdGhhdCB0aGUgbWluaWZpZXIgd2lsbCBub3QgYW5vbnltaXplIHRoZSBmdW5jdGlvbi5cbiAgICAgIG5leHQuZG9uZSA9IHRydWU7XG4gICAgICByZXR1cm4gbmV4dDtcbiAgICB9O1xuICB9O1xuXG4gIGZ1bmN0aW9uIHZhbHVlcyhpdGVyYWJsZSkge1xuICAgIGlmIChpdGVyYWJsZSkge1xuICAgICAgdmFyIGl0ZXJhdG9yTWV0aG9kID0gaXRlcmFibGVbaXRlcmF0b3JTeW1ib2xdO1xuICAgICAgaWYgKGl0ZXJhdG9yTWV0aG9kKSB7XG4gICAgICAgIHJldHVybiBpdGVyYXRvck1ldGhvZC5jYWxsKGl0ZXJhYmxlKTtcbiAgICAgIH1cblxuICAgICAgaWYgKHR5cGVvZiBpdGVyYWJsZS5uZXh0ID09PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgICAgcmV0dXJuIGl0ZXJhYmxlO1xuICAgICAgfVxuXG4gICAgICBpZiAoIWlzTmFOKGl0ZXJhYmxlLmxlbmd0aCkpIHtcbiAgICAgICAgdmFyIGkgPSAtMSwgbmV4dCA9IGZ1bmN0aW9uIG5leHQoKSB7XG4gICAgICAgICAgd2hpbGUgKCsraSA8IGl0ZXJhYmxlLmxlbmd0aCkge1xuICAgICAgICAgICAgaWYgKGhhc093bi5jYWxsKGl0ZXJhYmxlLCBpKSkge1xuICAgICAgICAgICAgICBuZXh0LnZhbHVlID0gaXRlcmFibGVbaV07XG4gICAgICAgICAgICAgIG5leHQuZG9uZSA9IGZhbHNlO1xuICAgICAgICAgICAgICByZXR1cm4gbmV4dDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG5cbiAgICAgICAgICBuZXh0LnZhbHVlID0gdW5kZWZpbmVkO1xuICAgICAgICAgIG5leHQuZG9uZSA9IHRydWU7XG5cbiAgICAgICAgICByZXR1cm4gbmV4dDtcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4gbmV4dC5uZXh0ID0gbmV4dDtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBSZXR1cm4gYW4gaXRlcmF0b3Igd2l0aCBubyB2YWx1ZXMuXG4gICAgcmV0dXJuIHsgbmV4dDogZG9uZVJlc3VsdCB9O1xuICB9XG4gIHJ1bnRpbWUudmFsdWVzID0gdmFsdWVzO1xuXG4gIGZ1bmN0aW9uIGRvbmVSZXN1bHQoKSB7XG4gICAgcmV0dXJuIHsgdmFsdWU6IHVuZGVmaW5lZCwgZG9uZTogdHJ1ZSB9O1xuICB9XG5cbiAgQ29udGV4dC5wcm90b3R5cGUgPSB7XG4gICAgY29uc3RydWN0b3I6IENvbnRleHQsXG5cbiAgICByZXNldDogZnVuY3Rpb24oc2tpcFRlbXBSZXNldCkge1xuICAgICAgdGhpcy5wcmV2ID0gMDtcbiAgICAgIHRoaXMubmV4dCA9IDA7XG4gICAgICAvLyBSZXNldHRpbmcgY29udGV4dC5fc2VudCBmb3IgbGVnYWN5IHN1cHBvcnQgb2YgQmFiZWwnc1xuICAgICAgLy8gZnVuY3Rpb24uc2VudCBpbXBsZW1lbnRhdGlvbi5cbiAgICAgIHRoaXMuc2VudCA9IHRoaXMuX3NlbnQgPSB1bmRlZmluZWQ7XG4gICAgICB0aGlzLmRvbmUgPSBmYWxzZTtcbiAgICAgIHRoaXMuZGVsZWdhdGUgPSBudWxsO1xuXG4gICAgICB0aGlzLnRyeUVudHJpZXMuZm9yRWFjaChyZXNldFRyeUVudHJ5KTtcblxuICAgICAgaWYgKCFza2lwVGVtcFJlc2V0KSB7XG4gICAgICAgIGZvciAodmFyIG5hbWUgaW4gdGhpcykge1xuICAgICAgICAgIC8vIE5vdCBzdXJlIGFib3V0IHRoZSBvcHRpbWFsIG9yZGVyIG9mIHRoZXNlIGNvbmRpdGlvbnM6XG4gICAgICAgICAgaWYgKG5hbWUuY2hhckF0KDApID09PSBcInRcIiAmJlxuICAgICAgICAgICAgICBoYXNPd24uY2FsbCh0aGlzLCBuYW1lKSAmJlxuICAgICAgICAgICAgICAhaXNOYU4oK25hbWUuc2xpY2UoMSkpKSB7XG4gICAgICAgICAgICB0aGlzW25hbWVdID0gdW5kZWZpbmVkO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0sXG5cbiAgICBzdG9wOiBmdW5jdGlvbigpIHtcbiAgICAgIHRoaXMuZG9uZSA9IHRydWU7XG5cbiAgICAgIHZhciByb290RW50cnkgPSB0aGlzLnRyeUVudHJpZXNbMF07XG4gICAgICB2YXIgcm9vdFJlY29yZCA9IHJvb3RFbnRyeS5jb21wbGV0aW9uO1xuICAgICAgaWYgKHJvb3RSZWNvcmQudHlwZSA9PT0gXCJ0aHJvd1wiKSB7XG4gICAgICAgIHRocm93IHJvb3RSZWNvcmQuYXJnO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gdGhpcy5ydmFsO1xuICAgIH0sXG5cbiAgICBkaXNwYXRjaEV4Y2VwdGlvbjogZnVuY3Rpb24oZXhjZXB0aW9uKSB7XG4gICAgICBpZiAodGhpcy5kb25lKSB7XG4gICAgICAgIHRocm93IGV4Y2VwdGlvbjtcbiAgICAgIH1cblxuICAgICAgdmFyIGNvbnRleHQgPSB0aGlzO1xuICAgICAgZnVuY3Rpb24gaGFuZGxlKGxvYywgY2F1Z2h0KSB7XG4gICAgICAgIHJlY29yZC50eXBlID0gXCJ0aHJvd1wiO1xuICAgICAgICByZWNvcmQuYXJnID0gZXhjZXB0aW9uO1xuICAgICAgICBjb250ZXh0Lm5leHQgPSBsb2M7XG4gICAgICAgIHJldHVybiAhIWNhdWdodDtcbiAgICAgIH1cblxuICAgICAgZm9yICh2YXIgaSA9IHRoaXMudHJ5RW50cmllcy5sZW5ndGggLSAxOyBpID49IDA7IC0taSkge1xuICAgICAgICB2YXIgZW50cnkgPSB0aGlzLnRyeUVudHJpZXNbaV07XG4gICAgICAgIHZhciByZWNvcmQgPSBlbnRyeS5jb21wbGV0aW9uO1xuXG4gICAgICAgIGlmIChlbnRyeS50cnlMb2MgPT09IFwicm9vdFwiKSB7XG4gICAgICAgICAgLy8gRXhjZXB0aW9uIHRocm93biBvdXRzaWRlIG9mIGFueSB0cnkgYmxvY2sgdGhhdCBjb3VsZCBoYW5kbGVcbiAgICAgICAgICAvLyBpdCwgc28gc2V0IHRoZSBjb21wbGV0aW9uIHZhbHVlIG9mIHRoZSBlbnRpcmUgZnVuY3Rpb24gdG9cbiAgICAgICAgICAvLyB0aHJvdyB0aGUgZXhjZXB0aW9uLlxuICAgICAgICAgIHJldHVybiBoYW5kbGUoXCJlbmRcIik7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoZW50cnkudHJ5TG9jIDw9IHRoaXMucHJldikge1xuICAgICAgICAgIHZhciBoYXNDYXRjaCA9IGhhc093bi5jYWxsKGVudHJ5LCBcImNhdGNoTG9jXCIpO1xuICAgICAgICAgIHZhciBoYXNGaW5hbGx5ID0gaGFzT3duLmNhbGwoZW50cnksIFwiZmluYWxseUxvY1wiKTtcblxuICAgICAgICAgIGlmIChoYXNDYXRjaCAmJiBoYXNGaW5hbGx5KSB7XG4gICAgICAgICAgICBpZiAodGhpcy5wcmV2IDwgZW50cnkuY2F0Y2hMb2MpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIGhhbmRsZShlbnRyeS5jYXRjaExvYywgdHJ1ZSk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMucHJldiA8IGVudHJ5LmZpbmFsbHlMb2MpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIGhhbmRsZShlbnRyeS5maW5hbGx5TG9jKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgIH0gZWxzZSBpZiAoaGFzQ2F0Y2gpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLnByZXYgPCBlbnRyeS5jYXRjaExvYykge1xuICAgICAgICAgICAgICByZXR1cm4gaGFuZGxlKGVudHJ5LmNhdGNoTG9jLCB0cnVlKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgIH0gZWxzZSBpZiAoaGFzRmluYWxseSkge1xuICAgICAgICAgICAgaWYgKHRoaXMucHJldiA8IGVudHJ5LmZpbmFsbHlMb2MpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIGhhbmRsZShlbnRyeS5maW5hbGx5TG9jKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJ0cnkgc3RhdGVtZW50IHdpdGhvdXQgY2F0Y2ggb3IgZmluYWxseVwiKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9LFxuXG4gICAgYWJydXB0OiBmdW5jdGlvbih0eXBlLCBhcmcpIHtcbiAgICAgIGZvciAodmFyIGkgPSB0aGlzLnRyeUVudHJpZXMubGVuZ3RoIC0gMTsgaSA+PSAwOyAtLWkpIHtcbiAgICAgICAgdmFyIGVudHJ5ID0gdGhpcy50cnlFbnRyaWVzW2ldO1xuICAgICAgICBpZiAoZW50cnkudHJ5TG9jIDw9IHRoaXMucHJldiAmJlxuICAgICAgICAgICAgaGFzT3duLmNhbGwoZW50cnksIFwiZmluYWxseUxvY1wiKSAmJlxuICAgICAgICAgICAgdGhpcy5wcmV2IDwgZW50cnkuZmluYWxseUxvYykge1xuICAgICAgICAgIHZhciBmaW5hbGx5RW50cnkgPSBlbnRyeTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBpZiAoZmluYWxseUVudHJ5ICYmXG4gICAgICAgICAgKHR5cGUgPT09IFwiYnJlYWtcIiB8fFxuICAgICAgICAgICB0eXBlID09PSBcImNvbnRpbnVlXCIpICYmXG4gICAgICAgICAgZmluYWxseUVudHJ5LnRyeUxvYyA8PSBhcmcgJiZcbiAgICAgICAgICBhcmcgPD0gZmluYWxseUVudHJ5LmZpbmFsbHlMb2MpIHtcbiAgICAgICAgLy8gSWdub3JlIHRoZSBmaW5hbGx5IGVudHJ5IGlmIGNvbnRyb2wgaXMgbm90IGp1bXBpbmcgdG8gYVxuICAgICAgICAvLyBsb2NhdGlvbiBvdXRzaWRlIHRoZSB0cnkvY2F0Y2ggYmxvY2suXG4gICAgICAgIGZpbmFsbHlFbnRyeSA9IG51bGw7XG4gICAgICB9XG5cbiAgICAgIHZhciByZWNvcmQgPSBmaW5hbGx5RW50cnkgPyBmaW5hbGx5RW50cnkuY29tcGxldGlvbiA6IHt9O1xuICAgICAgcmVjb3JkLnR5cGUgPSB0eXBlO1xuICAgICAgcmVjb3JkLmFyZyA9IGFyZztcblxuICAgICAgaWYgKGZpbmFsbHlFbnRyeSkge1xuICAgICAgICB0aGlzLm5leHQgPSBmaW5hbGx5RW50cnkuZmluYWxseUxvYztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuY29tcGxldGUocmVjb3JkKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIENvbnRpbnVlU2VudGluZWw7XG4gICAgfSxcblxuICAgIGNvbXBsZXRlOiBmdW5jdGlvbihyZWNvcmQsIGFmdGVyTG9jKSB7XG4gICAgICBpZiAocmVjb3JkLnR5cGUgPT09IFwidGhyb3dcIikge1xuICAgICAgICB0aHJvdyByZWNvcmQuYXJnO1xuICAgICAgfVxuXG4gICAgICBpZiAocmVjb3JkLnR5cGUgPT09IFwiYnJlYWtcIiB8fFxuICAgICAgICAgIHJlY29yZC50eXBlID09PSBcImNvbnRpbnVlXCIpIHtcbiAgICAgICAgdGhpcy5uZXh0ID0gcmVjb3JkLmFyZztcbiAgICAgIH0gZWxzZSBpZiAocmVjb3JkLnR5cGUgPT09IFwicmV0dXJuXCIpIHtcbiAgICAgICAgdGhpcy5ydmFsID0gcmVjb3JkLmFyZztcbiAgICAgICAgdGhpcy5uZXh0ID0gXCJlbmRcIjtcbiAgICAgIH0gZWxzZSBpZiAocmVjb3JkLnR5cGUgPT09IFwibm9ybWFsXCIgJiYgYWZ0ZXJMb2MpIHtcbiAgICAgICAgdGhpcy5uZXh0ID0gYWZ0ZXJMb2M7XG4gICAgICB9XG4gICAgfSxcblxuICAgIGZpbmlzaDogZnVuY3Rpb24oZmluYWxseUxvYykge1xuICAgICAgZm9yICh2YXIgaSA9IHRoaXMudHJ5RW50cmllcy5sZW5ndGggLSAxOyBpID49IDA7IC0taSkge1xuICAgICAgICB2YXIgZW50cnkgPSB0aGlzLnRyeUVudHJpZXNbaV07XG4gICAgICAgIGlmIChlbnRyeS5maW5hbGx5TG9jID09PSBmaW5hbGx5TG9jKSB7XG4gICAgICAgICAgdGhpcy5jb21wbGV0ZShlbnRyeS5jb21wbGV0aW9uLCBlbnRyeS5hZnRlckxvYyk7XG4gICAgICAgICAgcmVzZXRUcnlFbnRyeShlbnRyeSk7XG4gICAgICAgICAgcmV0dXJuIENvbnRpbnVlU2VudGluZWw7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9LFxuXG4gICAgXCJjYXRjaFwiOiBmdW5jdGlvbih0cnlMb2MpIHtcbiAgICAgIGZvciAodmFyIGkgPSB0aGlzLnRyeUVudHJpZXMubGVuZ3RoIC0gMTsgaSA+PSAwOyAtLWkpIHtcbiAgICAgICAgdmFyIGVudHJ5ID0gdGhpcy50cnlFbnRyaWVzW2ldO1xuICAgICAgICBpZiAoZW50cnkudHJ5TG9jID09PSB0cnlMb2MpIHtcbiAgICAgICAgICB2YXIgcmVjb3JkID0gZW50cnkuY29tcGxldGlvbjtcbiAgICAgICAgICBpZiAocmVjb3JkLnR5cGUgPT09IFwidGhyb3dcIikge1xuICAgICAgICAgICAgdmFyIHRocm93biA9IHJlY29yZC5hcmc7XG4gICAgICAgICAgICByZXNldFRyeUVudHJ5KGVudHJ5KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIHRocm93bjtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvLyBUaGUgY29udGV4dC5jYXRjaCBtZXRob2QgbXVzdCBvbmx5IGJlIGNhbGxlZCB3aXRoIGEgbG9jYXRpb25cbiAgICAgIC8vIGFyZ3VtZW50IHRoYXQgY29ycmVzcG9uZHMgdG8gYSBrbm93biBjYXRjaCBibG9jay5cbiAgICAgIHRocm93IG5ldyBFcnJvcihcImlsbGVnYWwgY2F0Y2ggYXR0ZW1wdFwiKTtcbiAgICB9LFxuXG4gICAgZGVsZWdhdGVZaWVsZDogZnVuY3Rpb24oaXRlcmFibGUsIHJlc3VsdE5hbWUsIG5leHRMb2MpIHtcbiAgICAgIHRoaXMuZGVsZWdhdGUgPSB7XG4gICAgICAgIGl0ZXJhdG9yOiB2YWx1ZXMoaXRlcmFibGUpLFxuICAgICAgICByZXN1bHROYW1lOiByZXN1bHROYW1lLFxuICAgICAgICBuZXh0TG9jOiBuZXh0TG9jXG4gICAgICB9O1xuXG4gICAgICByZXR1cm4gQ29udGludWVTZW50aW5lbDtcbiAgICB9XG4gIH07XG59KShcbiAgLy8gQW1vbmcgdGhlIHZhcmlvdXMgdHJpY2tzIGZvciBvYnRhaW5pbmcgYSByZWZlcmVuY2UgdG8gdGhlIGdsb2JhbFxuICAvLyBvYmplY3QsIHRoaXMgc2VlbXMgdG8gYmUgdGhlIG1vc3QgcmVsaWFibGUgdGVjaG5pcXVlIHRoYXQgZG9lcyBub3RcbiAgLy8gdXNlIGluZGlyZWN0IGV2YWwgKHdoaWNoIHZpb2xhdGVzIENvbnRlbnQgU2VjdXJpdHkgUG9saWN5KS5cbiAgdHlwZW9mIGdsb2JhbCA9PT0gXCJvYmplY3RcIiA/IGdsb2JhbCA6XG4gIHR5cGVvZiB3aW5kb3cgPT09IFwib2JqZWN0XCIgPyB3aW5kb3cgOlxuICB0eXBlb2Ygc2VsZiA9PT0gXCJvYmplY3RcIiA/IHNlbGYgOiB0aGlzXG4pO1xuIl19","console.warn(\n  \"The regenerator/runtime module is deprecated; \" +\n    \"please import regenerator-runtime/runtime instead.\"\n);\n\nmodule.exports = require(\"regenerator-runtime/runtime\");\n","if (!Cache.prototype.add) {\n  Cache.prototype.add = function add(request) {\n    return this.addAll([request]);\n  };\n}\n\nif (!Cache.prototype.addAll) {\n  Cache.prototype.addAll = function addAll(requests) {\n    var cache = this;\n\n    // Since DOMExceptions are not constructable:\n    function NetworkError(message) {\n      this.name = 'NetworkError';\n      this.code = 19;\n      this.message = message;\n    }\n    NetworkError.prototype = Object.create(Error.prototype);\n\n    return Promise.resolve().then(function() {\n      if (arguments.length < 1) throw new TypeError();\n      \n      // Simulate sequence<(Request or USVString)> binding:\n      var sequence = [];\n\n      requests = requests.map(function(request) {\n        if (request instanceof Request) {\n          return request;\n        }\n        else {\n          return String(request); // may throw TypeError\n        }\n      });\n\n      return Promise.all(\n        requests.map(function(request) {\n          if (typeof request === 'string') {\n            request = new Request(request);\n          }\n\n          var scheme = new URL(request.url).protocol;\n\n          if (scheme !== 'http:' && scheme !== 'https:') {\n            throw new NetworkError(\"Invalid scheme\");\n          }\n\n          return fetch(request.clone());\n        })\n      );\n    }).then(function(responses) {\n      // TODO: check that requests don't overwrite one another\n      // (don't think this is possible to polyfill due to opaque responses)\n      return Promise.all(\n        responses.map(function(response, i) {\n          return cache.put(requests[i], response);\n        })\n      );\n    }).then(function() {\n      return undefined;\n    });\n  };\n}\n","/*global window */\n(function () {\n\t'use strict';\n\tvar srcset = {};\n\tvar reInt = /^\\d+$/;\n\n\tfunction deepUnique(arr) {\n\t\treturn arr.sort().filter(function (el, i) {\n\t\t\treturn JSON.stringify(el) !== JSON.stringify(arr[i - 1]);\n\t\t});\n\t}\n\n\tfunction unique(arr) {\n\t\treturn arr.filter(function (el, i) {\n\t\t\treturn arr.indexOf(el) === i;\n\t\t});\n\t}\n\n\tsrcset.parse = function (str) {\n\t\treturn deepUnique(str.split(',').map(function (el) {\n\t\t\tvar ret = {};\n\n\t\t\tel.trim().split(/\\s+/).forEach(function (el, i) {\n\t\t\t\tif (i === 0) {\n\t\t\t\t\treturn ret.url = el;\n\t\t\t\t}\n\n\t\t\t\tvar value = el.substring(0, el.length - 1);\n\t\t\t\tvar postfix = el[el.length - 1];\n\t\t\t\tvar intVal = parseInt(value, 10);\n\t\t\t\tvar floatVal = parseFloat(value);\n\n\t\t\t\tif (postfix === 'w' && reInt.test(value)) {\n\t\t\t\t\tret.width = intVal;\n\t\t\t\t} else if (postfix === 'h' && reInt.test(value)) {\n\t\t\t\t\tret.height = intVal;\n\t\t\t\t} else if (postfix === 'x' && !isNaN(floatVal)) {\n\t\t\t\t\tret.density = floatVal;\n\t\t\t\t} else {\n\t\t\t\t\tthrow new Error('Invalid srcset descriptor: ' + el + '.');\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn ret;\n\t\t}));\n\t}\n\n\tsrcset.stringify = function (arr) {\n\t\treturn unique(arr.map(function (el) {\n\t\t\tif (!el.url) {\n\t\t\t\tthrow new Error('URL is required.');\n\t\t\t}\n\n\t\t\tvar ret = [el.url];\n\n\t\t\tif (el.width) {\n\t\t\t\tret.push(el.width + 'w');\n\t\t\t}\n\n\t\t\tif (el.height) {\n\t\t\t\tret.push(el.height + 'h');\n\t\t\t}\n\n\t\t\tif (el.density) {\n\t\t\t\tret.push(el.density + 'x');\n\t\t\t}\n\n\t\t\treturn ret.join(' ');\n\t\t})).join(', ');\n\t}\n\n\tif (typeof module !== 'undefined' && module.exports) {\n\t\tmodule.exports = srcset;\n\t} else {\n\t\twindow.srcset = srcset;\n\t}\n})();\n","'use strict';\n\nvar _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }\n\nfunction promisifyRequest(obj) {\n  return new Promise(function (resolve, reject) {\n    function onsuccess(event) {\n      resolve(obj.result);\n      unlisten();\n    }\n    function onerror(event) {\n      reject(obj.error);\n      unlisten();\n    }\n    function unlisten() {\n      obj.removeEventListener('complete', onsuccess);\n      obj.removeEventListener('success', onsuccess);\n      obj.removeEventListener('error', onerror);\n      obj.removeEventListener('abort', onerror);\n    }\n    obj.addEventListener('complete', onsuccess);\n    obj.addEventListener('success', onsuccess);\n    obj.addEventListener('error', onerror);\n    obj.addEventListener('abort', onerror);\n  });\n}\n\nvar IndexedDouchebag = (function () {\n  function IndexedDouchebag(name, version, upgradeCallback) {\n    _classCallCheck(this, IndexedDouchebag);\n\n    var request = indexedDB.open(name, version);\n    this.ready = promisifyRequest(request);\n    request.onupgradeneeded = function (event) {\n      upgradeCallback(request.result, event.oldVersion);\n    };\n  }\n\n  _createClass(IndexedDouchebag, [{\n    key: 'transaction',\n    value: function transaction(stores, modeOrCallback, callback) {\n      return this.ready.then(function (db) {\n        var mode = 'readonly';\n\n        if (modeOrCallback.apply) {\n          callback = modeOrCallback;\n        } else if (modeOrCallback) {\n          mode = modeOrCallback;\n        }\n\n        var tx = db.transaction(stores, mode);\n        var val = callback(tx, db);\n        var promise = promisifyRequest(tx);\n        var readPromise;\n\n        if (!val) {\n          return promise;\n        }\n\n        if (val[0] && 'result' in val[0]) {\n          readPromise = Promise.all(val.map(promisifyRequest));\n        } else {\n          readPromise = promisifyRequest(val);\n        }\n\n        return promise.then(function () {\n          return readPromise;\n        });\n      });\n    }\n  }, {\n    key: 'get',\n    value: function get(store, key) {\n      return this.transaction(store, function (tx) {\n        return tx.objectStore(store).get(key);\n      });\n    }\n  }, {\n    key: 'put',\n    value: function put(store, key, value) {\n      return this.transaction(store, 'readwrite', function (tx) {\n        tx.objectStore(store).put(value, key);\n      });\n    }\n  }, {\n    key: 'delete',\n    value: function _delete(store, key) {\n      return this.transaction(store, 'readwrite', function (tx) {\n        tx.objectStore(store)['delete'](key);\n      });\n    }\n  }]);\n\n  return IndexedDouchebag;\n})();\n\nmodule.exports = IndexedDouchebag;\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9oZXJtYW53L0RvY3VtZW50cy9oZXJtd29uZy9vZmZsaW5lLXdpa2lwZWRpYS9wdWJsaWMvanMvc2hhcmVkL2luZGV4ZWRkb3VjaGJhZy5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxZQUFZLENBQUM7Ozs7OztBQUViLFNBQVMsZ0JBQWdCLENBQUMsR0FBRyxFQUFFO0FBQzdCLFNBQU8sSUFBSSxPQUFPLENBQUMsVUFBUyxPQUFPLEVBQUUsTUFBTSxFQUFFO0FBQzNDLGFBQVMsU0FBUyxDQUFDLEtBQUssRUFBRTtBQUN4QixhQUFPLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDO0FBQ3BCLGNBQVEsRUFBRSxDQUFDO0tBQ1o7QUFDRCxhQUFTLE9BQU8sQ0FBQyxLQUFLLEVBQUU7QUFDdEIsWUFBTSxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQztBQUNsQixjQUFRLEVBQUUsQ0FBQztLQUNaO0FBQ0QsYUFBUyxRQUFRLEdBQUc7QUFDbEIsU0FBRyxDQUFDLG1CQUFtQixDQUFDLFVBQVUsRUFBRSxTQUFTLENBQUMsQ0FBQztBQUMvQyxTQUFHLENBQUMsbUJBQW1CLENBQUMsU0FBUyxFQUFFLFNBQVMsQ0FBQyxDQUFDO0FBQzlDLFNBQUcsQ0FBQyxtQkFBbUIsQ0FBQyxPQUFPLEVBQUUsT0FBTyxDQUFDLENBQUM7QUFDMUMsU0FBRyxDQUFDLG1CQUFtQixDQUFDLE9BQU8sRUFBRSxPQUFPLENBQUMsQ0FBQztLQUMzQztBQUNELE9BQUcsQ0FBQyxnQkFBZ0IsQ0FBQyxVQUFVLEVBQUUsU0FBUyxDQUFDLENBQUM7QUFDNUMsT0FBRyxDQUFDLGdCQUFnQixDQUFDLFNBQVMsRUFBRSxTQUFTLENBQUMsQ0FBQztBQUMzQyxPQUFHLENBQUMsZ0JBQWdCLENBQUMsT0FBTyxFQUFFLE9BQU8sQ0FBQyxDQUFDO0FBQ3ZDLE9BQUcsQ0FBQyxnQkFBZ0IsQ0FBQyxPQUFPLEVBQUUsT0FBTyxDQUFDLENBQUM7R0FDeEMsQ0FBQyxDQUFD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aW5lLXdpa2lwZWRpYS9wdWJsaWMvanMvc2hhcmVkL2luZGV4ZWRkb3VjaGJhZy5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxuZnVuY3Rpb24gcHJvbWlzaWZ5UmVxdWVzdChvYmopIHtcbiAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuICAgIGZ1bmN0aW9uIG9uc3VjY2VzcyhldmVudCkge1xuICAgICAgcmVzb2x2ZShvYmoucmVzdWx0KTtcbiAgICAgIHVubGlzdGVuKCk7XG4gICAgfVxuICAgIGZ1bmN0aW9uIG9uZXJyb3IoZXZlbnQpIHtcbiAgICAgIHJlamVjdChvYmouZXJyb3IpO1xuICAgICAgdW5saXN0ZW4oKTtcbiAgICB9XG4gICAgZnVuY3Rpb24gdW5saXN0ZW4oKSB7XG4gICAgICBvYmoucmVtb3ZlRXZlbnRMaXN0ZW5lcignY29tcGxldGUnLCBvbnN1Y2Nlc3MpO1xuICAgICAgb2JqLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3N1Y2Nlc3MnLCBvbnN1Y2Nlc3MpO1xuICAgICAgb2JqLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2Vycm9yJywgb25lcnJvcik7XG4gICAgICBvYmoucmVtb3ZlRXZlbnRMaXN0ZW5lcignYWJvcnQnLCBvbmVycm9yKTtcbiAgICB9XG4gICAgb2JqLmFkZEV2ZW50TGlzdGVuZXIoJ2NvbXBsZXRlJywgb25zdWNjZXNzKTtcbiAgICBvYmouYWRkRXZlbnRMaXN0ZW5lcignc3VjY2VzcycsIG9uc3VjY2Vzcyk7XG4gICAgb2JqLmFkZEV2ZW50TGlzdGVuZXIoJ2Vycm9yJywgb25lcnJvcik7XG4gICAgb2JqLmFkZEV2ZW50TGlzdGVuZXIoJ2Fib3J0Jywgb25lcnJvcik7XG4gIH0pO1xufVxuXG5jbGFzcyBJbmRleGVkRG91Y2hlYmFnIHtcbiAgY29uc3RydWN0b3IobmFtZSwgdmVyc2lvbiwgdXBncmFkZUNhbGxiYWNrKSB7XG4gICAgdmFyIHJlcXVlc3QgPSBpbmRleGVkREIub3BlbihuYW1lLCB2ZXJzaW9uKTtcbiAgICB0aGlzLnJlYWR5ID0gcHJvbWlzaWZ5UmVxdWVzdChyZXF1ZXN0KTtcbiAgICByZXF1ZXN0Lm9udXBncmFkZW5lZWRlZCA9IGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICB1cGdyYWRlQ2FsbGJhY2socmVxdWVzdC5yZXN1bHQsIGV2ZW50Lm9sZFZlcnNpb24pO1xuICAgIH07XG4gIH1cblxuICB0cmFuc2FjdGlvbihzdG9yZXMsIG1vZGVPckNhbGxiYWNrLCBjYWxsYmFjaykge1xuICAgIHJldHVybiB0aGlzLnJlYWR5LnRoZW4oZnVuY3Rpb24oZGIpIHtcbiAgICAgIHZhciBtb2RlID0gJ3JlYWRvbmx5JztcblxuICAgICAgaWYgKG1vZGVPckNhbGxiYWNrLmFwcGx5KSB7XG4gICAgICAgIGNhbGxiYWNrID0gbW9kZU9yQ2FsbGJhY2s7XG4gICAgICB9XG4gICAgICBlbHNlIGlmIChtb2RlT3JDYWxsYmFjaykge1xuICAgICAgICBtb2RlID0gbW9kZU9yQ2FsbGJhY2s7XG4gICAgICB9XG5cbiAgICAgIHZhciB0eCA9IGRiLnRyYW5zYWN0aW9uKHN0b3JlcywgbW9kZSk7XG4gICAgICB2YXIgdmFsID0gY2FsbGJhY2sodHgsIGRiKTtcbiAgICAgIHZhciBwcm9taXNlID0gcHJvbWlzaWZ5UmVxdWVzdCh0eCk7XG4gICAgICB2YXIgcmVhZFByb21pc2U7XG5cbiAgICAgIGlmICghdmFsKSB7XG4gICAgICAgIHJldHVybiBwcm9taXNlO1xuICAgICAgfVxuXG4gICAgICBpZiAodmFsWzBdICYmICdyZXN1bHQnIGluIHZhbFswXSkge1xuICAgICAgICByZWFkUHJvbWlzZSA9IFByb21pc2UuYWxsKHZhbC5tYXAocHJvbWlzaWZ5UmVxdWVzdCkpO1xuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgIHJlYWRQcm9taXNlID0gcHJvbWlzaWZ5UmVxdWVzdCh2YWwpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gcHJvbWlzZS50aGVuKGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gcmVhZFByb21pc2U7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfTtcblxuICBnZXQoc3RvcmUsIGtleSkge1xuICAgIHJldHVybiB0aGlzLnRyYW5zYWN0aW9uKHN0b3JlLCBmdW5jdGlvbih0eCkge1xuICAgICAgcmV0dXJuIHR4Lm9iamVjdFN0b3JlKHN0b3JlKS5nZXQoa2V5KTtcbiAgICB9KTtcbiAgfTtcblxuICBwdXQoc3RvcmUsIGtleSwgdmFsdWUpIHtcbiAgICByZXR1cm4gdGhpcy50cmFuc2FjdGlvbihzdG9yZSwgJ3JlYWR3cml0ZScsIGZ1bmN0aW9uKHR4KSB7XG4gICAgICB0eC5vYmplY3RTdG9yZShzdG9yZSkucHV0KHZhbHVlLCBrZXkpO1xuICAgIH0pO1xuICB9O1xuXG4gIGRlbGV0ZShzdG9yZSwga2V5KSB7XG4gICAgcmV0dXJuIHRoaXMudHJhbnNhY3Rpb24oc3RvcmUsICdyZWFkd3JpdGUnLCBmdW5jdGlvbih0eCkge1xuICAgICAgdHgub2JqZWN0U3RvcmUoc3RvcmUpLmRlbGV0ZShrZXkpO1xuICAgIH0pO1xuICB9O1xufVxuXG5tb2R1bGUuZXhwb3J0cyA9IEluZGV4ZWREb3VjaGViYWc7Il19","'use strict';\n\nvar Idb = require('./indexeddouchbag');\nvar idb;\n\n// avoid opening idb until first call\nfunction getIdb() {\n  if (!idb) {\n    idb = new Idb('wiki-offline-keyval', 1, function (db) {\n      db.createObjectStore('keyval');\n    });\n  }\n  return idb;\n}\n\nif (self.indexedDB) {\n  module.exports = {\n    get: function get(key) {\n      return getIdb().get('keyval', key);\n    },\n    set: function set(key, val) {\n      return getIdb().put('keyval', key, val);\n    },\n    'delete': function _delete(key) {\n      return getIdb()['delete']('keyval', key);\n    }\n  };\n} else {\n  module.exports = {\n    get: function get(key) {\n      return Promise.resolve(localStorage.getItem(key));\n    },\n    set: function set(key, val) {\n      return Promise.resolve(localStorage.setItem(key, val));\n    },\n    'delete': function _delete(key) {\n      return Promise.resolve(localStorage.removeItem(key));\n    }\n  };\n}\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9oZXJtYW53L0RvY3VtZW50cy9oZXJtd29uZy9vZmZsaW5lLXdpa2lwZWRpYS9wdWJsaWMvanMvc2hhcmVkL3N0b3JhZ2UuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxJQUFJLEdBQUcsR0FBRyxPQUFPLENBQUMsbUJBQW1CLENBQUMsQ0FBQztBQUN2QyxJQUFJLEdBQUcsQ0FBQzs7O0FBR1IsU0FBUyxNQUFNLEdBQUc7QUFDaEIsTUFBSSxDQUFDLEdBQUcsRUFBRTtBQUNSLE9BQUcsR0FBRyxJQUFJLEdBQUcsQ0FBQyxxQkFBcUIsRUFBRSxDQUFDLEVBQUUsVUFBUyxFQUFFLEVBQUU7QUFDbkQsUUFBRSxDQUFDLGlCQUFpQixDQUFDLFFBQVEsQ0FBQyxDQUFDO0tBQ2hDLENBQUMsQ0FBQztHQUNKO0FBQ0QsU0FBTyxHQUFHLENBQUM7Q0FDWjs7QUFFRCxJQUFJLElBQUksQ0FBQyxTQUFTLEVBQUU7QUFDbEIsUUFBTSxDQUFDLE9BQU8sR0FBRztBQUNmLE9BQUcsRUFBRSxhQUFBLEdBQUc7YUFBSSxNQUFNLEVBQUUsQ0FBQyxHQUFHLENBQUMsUUFBUSxFQUFFLEdBQUcsQ0FBQztLQUFBO0FBQ3ZDLE9BQUcsRUFBRSxhQUFDLEdBQUcsRUFBRSxHQUFHO2FBQUssTUFBTSxFQUFFLENBQUMsR0FBRyxDQUFDLFFBQVEsRUFBRSxHQUFHLEVBQUUsR0FBRyxDQUFDO0tBQUE7QUFDbkQsY0FBUSxpQkFBQSxHQUFHO2FBQUksTUFBTSxFQUFFLFVBQU8sQ0FBQyxRQUFRLEVBQUUsR0FBRyxDQUFDO0tBQUE7R0FDOUMsQ0FBQztDQUNILE1BQ0k7QUFDSCxRQUFNLENBQUMsT0FBTyxHQUFHO0FBQ2YsT0FBRyxFQUFFLGFBQUEsR0FBRzthQUFJLE9BQU8sQ0FBQyxPQUFPLENBQUMsWUFBWSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQztLQUFBO0FBQ3RELE9BQUcsRUFBRSxhQUFDLEdBQUcsRUFBRSxHQUFHO2FBQUssT0FBTyxDQUFDLE9BQU8sQ0FBQyxZQUFZLENBQUMsT0FBTyxDQUFDLEdBQUcsRUFBRSxHQUFHLENBQUMsQ0FBQztLQUFBO0FBQ2xFLGNBQVEsaUJBQUEsR0FBRzthQUFJLE9BQU8sQ0FBQyxPQUFPLENBQUMsWUFBWSxDQUFDLFVBQVUsQ0FBQyxHQUFHLENBQUMsQ0FBQztLQUFBO0dBQzdELENBQUM7Q0FDSCIsImZpbGUiOiIvVXNlcnMvaGVybWFudy9Eb2N1bWVudHMvaGVybXdvbmcvb2ZmbGluZS13aWtpcGVkaWEvcHVibGljL2pzL3NoYXJlZC9zdG9yYWdlLmpzIiwic291cmNlc0NvbnRlbnQiOlsidmFyIElkYiA9IHJlcXVpcmUoJy4vaW5kZXhlZGRvdWNoYmFnJyk7XG52YXIgaWRiO1xuXG4vLyBhdm9pZCBvcGVuaW5nIGlkYiB1bnRpbCBmaXJzdCBjYWxsXG5mdW5jdGlvbiBnZXRJZGIoKSB7XG4gIGlmICghaWRiKSB7XG4gICAgaWRiID0gbmV3IElkYignd2lraS1vZmZsaW5lLWtleXZhbCcsIDEsIGZ1bmN0aW9uKGRiKSB7XG4gICAgICBkYi5jcmVhdGVPYmplY3RTdG9yZSgna2V5dmFsJyk7XG4gICAgfSk7XG4gIH1cbiAgcmV0dXJuIGlkYjtcbn1cblxuaWYgKHNlbGYuaW5kZXhlZERCKSB7XG4gIG1vZHVsZS5leHBvcnRzID0ge1xuICAgIGdldDoga2V5ID0+IGdldElkYigpLmdldCgna2V5dmFsJywga2V5KSxcbiAgICBzZXQ6IChrZXksIHZhbCkgPT4gZ2V0SWRiKCkucHV0KCdrZXl2YWwnLCBrZXksIHZhbCksXG4gICAgZGVsZXRlOiBrZXkgPT4gZ2V0SWRiKCkuZGVsZXRlKCdrZXl2YWwnLCBrZXkpXG4gIH07XG59XG5lbHNlIHtcbiAgbW9kdWxlLmV4cG9ydHMgPSB7XG4gICAgZ2V0OiBrZXkgPT4gUHJvbWlzZS5yZXNvbHZlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKGtleSkpLFxuICAgIHNldDogKGtleSwgdmFsKSA9PiBQcm9taXNlLnJlc29sdmUobG9jYWxTdG9yYWdlLnNldEl0ZW0oa2V5LCB2YWwpKSxcbiAgICBkZWxldGU6IGtleSA9PiBQcm9taXNlLnJlc29sdmUobG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oa2V5KSlcbiAgfTtcbn0iXX0=","'use strict';\n\nvar _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }\n\nvar srcset = require('srcset');\nvar storage = require('./storage');\n\nvar cachePrefix = \"wikioffline-article-\";\n\nfunction getMetaRequest(name) {\n  return new Request('/wiki/' + name + '.json', {\n    credentials: 'include' // needed for flag cookies\n  });\n}\n\nfunction getArticleRequest(name) {\n  return new Request('/wiki/' + name + '.inc', {\n    credentials: 'include' // needed for flag cookies\n  });\n}\n\nvar Article = (function () {\n  function Article(name) {\n    var _this = this;\n\n    var _ref = arguments.length <= 1 || arguments[1] === undefined ? {} : arguments[1];\n\n    var _ref$fromCache = _ref.fromCache;\n    var fromCache = _ref$fromCache === undefined ? false : _ref$fromCache;\n\n    _classCallCheck(this, Article);\n\n    var fetcher = fromCache ? caches.match.bind(caches) : fetch;\n    this._metaPromise = fetcher(getMetaRequest(name));\n    this._articlePromise = fetcher(getArticleRequest(name));\n\n    this.ready = this._metaPromise.then(function (r) {\n      if (!r) throw Error('No response');\n    });\n\n    var data = this.ready.then(function (_) {\n      return _this._metaPromise;\n    }).then(function (r) {\n      return r.clone().json();\n    });\n\n    this._html = undefined;\n\n    this.meta = data.then(function (meta) {\n      meta.updated = new Date(meta.updated);\n      return meta;\n    });\n\n    this._cacheName = this.meta.then(function (data) {\n      return cachePrefix + data.urlId;\n    });\n  }\n\n  _createClass(Article, [{\n    key: 'getHtml',\n    value: function getHtml() {\n      return regeneratorRuntime.async(function getHtml$(context$2$0) {\n        while (1) switch (context$2$0.prev = context$2$0.next) {\n          case 0:\n            if (!(this._html === undefined)) {\n              context$2$0.next = 4;\n              break;\n            }\n\n            context$2$0.next = 3;\n            return regeneratorRuntime.awrap(this._articlePromise.then(function (r) {\n              return r.clone().text();\n            }));\n\n          case 3:\n            this._html = context$2$0.sent;\n\n          case 4:\n            return context$2$0.abrupt('return', this._html);\n\n          case 5:\n          case 'end':\n            return context$2$0.stop();\n        }\n      }, null, this);\n    }\n  }, {\n    key: 'getHtmlResponse',\n    value: function getHtmlResponse() {\n      return this._articlePromise.then(function (r) {\n        return r.clone();\n      });\n    }\n  }, {\n    key: '_createCacheArticleResponse',\n    value: function _createCacheArticleResponse() {\n      var text, devicePixelRatio;\n      return regeneratorRuntime.async(function _createCacheArticleResponse$(context$2$0) {\n        while (1) switch (context$2$0.prev = context$2$0.next) {\n          case 0:\n            context$2$0.next = 2;\n            return regeneratorRuntime.awrap(this.getHtml());\n\n          case 2:\n            text = context$2$0.sent;\n            context$2$0.t1 = self.devicePixelRatio;\n\n            if (context$2$0.t1) {\n              context$2$0.next = 8;\n              break;\n            }\n\n            context$2$0.next = 7;\n            return regeneratorRuntime.awrap(storage.get('devicePixelRatio'));\n\n          case 7:\n            context$2$0.t1 = context$2$0.sent;\n\n          case 8:\n            context$2$0.t0 = context$2$0.t1;\n\n            if (context$2$0.t0) {\n              context$2$0.next = 11;\n              break;\n            }\n\n            context$2$0.t0 = 2;\n\n          case 11:\n            devicePixelRatio = context$2$0.t0;\n\n            // yes I'm parsing HTML with regex muahahaha\n            // I'm flattening srcset to make it deterministic\n            text = text.replace(/<img[^>]*>/ig, function (match) {\n              // start with the image src as density 1\n              var newSrc = (/src=(['\"])(.*?)\\1/i.exec(match) || [])[2];\n\n              match = match.replace(/srcset=(['\"])(.*?)\\1/ig, function (srcsetAll, _, srcsetInner) {\n                try {\n                  var parsedSrcset = srcset.parse(srcsetInner).sort(function (a, b) {\n                    return a.density < b.density ? -1 : 1;\n                  });\n                  var lastDensity = 1;\n\n                  var _iteratorNormalCompletion = true;\n                  var _didIteratorError = false;\n                  var _iteratorError = undefined;\n\n                  try {\n                    for (var _iterator = parsedSrcset[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n                      var srcSetItem = _step.value;\n\n                      if (devicePixelRatio > lastDensity) {\n                        newSrc = srcSetItem.url;\n                      }\n                      if (devicePixelRatio <= srcSetItem.density) {\n                        break;\n                      }\n                      lastDensity = srcSetItem.density;\n                    }\n                  } catch (err) {\n                    _didIteratorError = true;\n                    _iteratorError = err;\n                  } finally {\n                    try {\n                      if (!_iteratorNormalCompletion && _iterator['return']) {\n                        _iterator['return']();\n                      }\n                    } finally {\n                      if (_didIteratorError) {\n                        throw _iteratorError;\n                      }\n                    }\n                  }\n                } catch (e) {}\n\n                return '';\n              });\n\n              if (newSrc) {\n                match = match.replace(/src=(['\"]).*?\\1/ig, 'src=\"' + newSrc + '\"');\n              }\n\n              return match;\n            });\n\n            context$2$0.t2 = Response;\n            context$2$0.t3 = text;\n            context$2$0.next = 17;\n            return regeneratorRuntime.awrap(this._articlePromise);\n\n          case 17:\n            context$2$0.t4 = context$2$0.sent.headers;\n            context$2$0.t5 = {\n              headers: context$2$0.t4\n            };\n            return context$2$0.abrupt('return', new context$2$0.t2(context$2$0.t3, context$2$0.t5));\n\n          case 20:\n          case 'end':\n            return context$2$0.stop();\n        }\n      }, null, this);\n    }\n  }, {\n    key: 'cache',\n    value: function cache() {\n      var previouslyCached, cache, imgRe, regexResult, articleResponse, htmlText, imgSrcs, urlId, cacheOpeations;\n      return regeneratorRuntime.async(function cache$(context$2$0) {\n        var _this2 = this;\n\n        while (1) switch (context$2$0.prev = context$2$0.next) {\n          case 0:\n            context$2$0.next = 2;\n            return regeneratorRuntime.awrap(this.isCached());\n\n          case 2:\n            previouslyCached = context$2$0.sent;\n            context$2$0.t0 = regeneratorRuntime;\n            context$2$0.t1 = caches;\n            context$2$0.next = 7;\n            return regeneratorRuntime.awrap(this._cacheName);\n\n          case 7:\n            context$2$0.t2 = context$2$0.sent;\n            context$2$0.t3 = context$2$0.t1.open.call(context$2$0.t1, context$2$0.t2);\n            context$2$0.next = 11;\n            return context$2$0.t0.awrap.call(context$2$0.t0, context$2$0.t3);\n\n          case 11:\n            cache = context$2$0.sent;\n            imgRe = /<img[^>]*src=(['\"])(.*?)\\1[^>]*>/ig;\n            context$2$0.next = 15;\n            return regeneratorRuntime.awrap(this._createCacheArticleResponse());\n\n          case 15:\n            articleResponse = context$2$0.sent;\n            context$2$0.next = 18;\n            return regeneratorRuntime.awrap(articleResponse.clone().text());\n\n          case 18:\n            htmlText = context$2$0.sent;\n            imgSrcs = new Set();\n            context$2$0.next = 22;\n            return regeneratorRuntime.awrap(this.meta);\n\n          case 22:\n            urlId = context$2$0.sent.urlId;\n\n            while (regexResult = imgRe.exec(htmlText)) {\n              imgSrcs.add(regexResult[2]);\n            }\n\n            context$2$0.t4 = cache;\n            context$2$0.t5 = getMetaRequest(urlId);\n            context$2$0.next = 28;\n            return regeneratorRuntime.awrap(this._metaPromise);\n\n          case 28:\n            context$2$0.t6 = context$2$0.sent.clone();\n            context$2$0.t7 = context$2$0.t4.put.call(context$2$0.t4, context$2$0.t5, context$2$0.t6);\n            context$2$0.t8 = cache.put(getArticleRequest(urlId), articleResponse);\n            cacheOpeations = [context$2$0.t7, context$2$0.t8];\n\n            imgSrcs.forEach(function (url) {\n              var request = new Request(url, { mode: 'no-cors' });\n              cacheOpeations.push(\n              // This is a workaround to https://code.google.com/p/chromium/issues/detail?id=477658\n              // Once the bug is fixed, we can just do this:\n              // fetch(request).then(response => cache.put(request, response))\n              caches.match(request).then(function (response) {\n                return response || fetch(request);\n              }).then(function (response) {\n                return cache.put(request, response);\n              }));\n            });\n\n            return context$2$0.abrupt('return', Promise.all(cacheOpeations)['catch'](function (err) {\n              if (!previouslyCached) {\n                _this2.uncache();\n              }\n              throw err;\n            }).then(function (_) {\n              return undefined;\n            }));\n\n          case 34:\n          case 'end':\n            return context$2$0.stop();\n        }\n      }, null, this);\n    }\n  }, {\n    key: 'uncache',\n    value: function uncache() {\n      return regeneratorRuntime.async(function uncache$(context$2$0) {\n        while (1) switch (context$2$0.prev = context$2$0.next) {\n          case 0:\n            context$2$0.t0 = caches;\n            context$2$0.next = 3;\n            return regeneratorRuntime.awrap(this._cacheName);\n\n          case 3:\n            context$2$0.t1 = context$2$0.sent;\n            return context$2$0.abrupt('return', context$2$0.t0['delete'].call(context$2$0.t0, context$2$0.t1));\n\n          case 5:\n          case 'end':\n            return context$2$0.stop();\n        }\n      }, null, this);\n    }\n  }, {\n    key: 'isCached',\n    value: function isCached() {\n      return regeneratorRuntime.async(function isCached$(context$2$0) {\n        while (1) switch (context$2$0.prev = context$2$0.next) {\n          case 0:\n            context$2$0.t0 = caches;\n            context$2$0.next = 3;\n            return regeneratorRuntime.awrap(this._cacheName);\n\n          case 3:\n            context$2$0.t1 = context$2$0.sent;\n            return context$2$0.abrupt('return', context$2$0.t0.has.call(context$2$0.t0, context$2$0.t1));\n\n          case 5:\n          case 'end':\n            return context$2$0.stop();\n        }\n      }, null, this);\n    }\n  }]);\n\n  return Article;\n})();\n\nvar wikipedia = {\n  search: function search(term) {\n    return fetch('/search.json?s=' + term, {\n      credentials: 'include' // needed for flag cookies\n    }).then(function (r) {\n      return r.json();\n    });\n  },\n\n  article: function article(name) {\n    var _ref2,\n        _ref2$fromCache,\n        fromCache,\n        article,\n        args$1$0 = arguments;\n\n    return regeneratorRuntime.async(function article$(context$1$0) {\n      while (1) switch (context$1$0.prev = context$1$0.next) {\n        case 0:\n          _ref2 = args$1$0.length <= 1 || args$1$0[1] === undefined ? {} : args$1$0[1];\n          _ref2$fromCache = _ref2.fromCache;\n          fromCache = _ref2$fromCache === undefined ? false : _ref2$fromCache;\n\n          if (!(fromCache && !('caches' in self))) {\n            context$1$0.next = 5;\n            break;\n          }\n\n          return context$1$0.abrupt('return', Promise.reject(Error(\"Caching not supported\")));\n\n        case 5:\n          article = new Article(name, { fromCache: fromCache });\n          context$1$0.next = 8;\n          return regeneratorRuntime.awrap(article.ready);\n\n        case 8:\n          return context$1$0.abrupt('return', article);\n\n        case 9:\n        case 'end':\n          return context$1$0.stop();\n      }\n    }, null, this);\n  },\n\n  getCachedArticleData: function getCachedArticleData() {\n    var articleNames;\n    return regeneratorRuntime.async(function getCachedArticleData$(context$1$0) {\n      var _this3 = this;\n\n      while (1) switch (context$1$0.prev = context$1$0.next) {\n        case 0:\n          if ('caches' in self) {\n            context$1$0.next = 2;\n            break;\n          }\n\n          return context$1$0.abrupt('return', []);\n\n        case 2:\n          context$1$0.next = 4;\n          return regeneratorRuntime.awrap(caches.keys());\n\n        case 4:\n          context$1$0.t0 = function (cacheName) {\n            return cacheName.startsWith(cachePrefix);\n          };\n\n          context$1$0.t1 = function (cacheName) {\n            return cacheName.slice(cachePrefix.length);\n          };\n\n          articleNames = context$1$0.sent.filter(context$1$0.t0).map(context$1$0.t1);\n          return context$1$0.abrupt('return', Promise.all(articleNames.map(function callee$1$0(name) {\n            var response;\n            return regeneratorRuntime.async(function callee$1$0$(context$2$0) {\n              while (1) switch (context$2$0.prev = context$2$0.next) {\n                case 0:\n                  context$2$0.next = 2;\n                  return regeneratorRuntime.awrap(caches.match(getMetaRequest(name)));\n\n                case 2:\n                  response = context$2$0.sent;\n\n                  if (response) {\n                    context$2$0.next = 6;\n                    break;\n                  }\n\n                  wikipedia.uncache(name);\n                  return context$2$0.abrupt('return', false);\n\n                case 6:\n                  ;\n\n                  return context$2$0.abrupt('return', response.json());\n\n                case 8:\n                case 'end':\n                  return context$2$0.stop();\n              }\n            }, null, _this3);\n          })).then(function (vals) {\n            return vals.filter(function (val) {\n              return val;\n            });\n          }));\n\n        case 8:\n        case 'end':\n          return context$1$0.stop();\n      }\n    }, null, this);\n  },\n\n  uncache: function uncache(name) {\n    return caches['delete'](cachePrefix + name);\n  }\n};\n\nmodule.exports = wikipedia;\n\n// workers don't have access to DPR\n\n// get a fresh request, as it may have originally been redirected\n\n// seeing a bug where the response here is gone - not sure why\n// but I'll guard against it\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9oZXJtYW53L0RvY3VtZW50cy9oZXJtd29uZy9vZmZsaW5lLXdpa2lwZWRpYS9wdWJsaWMvanMvc2hhcmVkL3dpa2lwZWRpYS5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSxJQUFJLE1BQU0sR0FBRyxPQUFPLENBQUMsUUFBUSxDQUFDLENBQUM7QUFDL0IsSUFBSSxPQUFPLEdBQUcsT0FBTyxDQUFDLFdBQVcsQ0FBQyxDQUFDOztBQUVuQyxJQUFJLFdBQVcsR0FBRyxzQkFBc0IsQ0FBQzs7QUFFekMsU0FBUyxjQUFjLENBQUMsSUFBSSxFQUFFO0FBQzVCLFNBQU8sSUFBSSxPQUFPLENBQUMsUUFBUSxHQUFHLElBQUksR0FBRyxPQUFPLEVBQUU7QUFDNUMsZUFBVyxFQUFFLFNBQVM7R0FDdkIsQ0FBQyxDQUFDO0NBQ0o7O0FBRUQsU0FBUyxpQkFBaUIsQ0FBQyxJQUFJLEVBQUU7QUFDL0IsU0FBTyxJQUFJLE9BQU8sQ0FBQyxRQUFRLEdBQUcsSUFBSSxHQUFHLE1BQU0sRUFBRTtBQUMzQyxlQUFXLEVBQUUsU0FBUztHQUN2QixDQUFDLENBQUM7Q0FDSjs7SUFFSyxPQUFPO0FBQ0EsV0FEUCxPQUFPLENBQ0MsSUFBSSxFQUVWOzs7cUVBQUosRUFBRTs7OEJBREYsU0FBUztRQUFULFNBQVMsa0NBQUcsS0FBSzs7MEJBRmYsT0FBTzs7QUFJVCxRQUFJLE9BQU8sR0FBRyxTQUFTLEdBQUcsTUFBTSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsS0FBSyxDQUFDO0FBQzVELFFBQUksQ0FBQyxZQUFZLEdBQUcsT0FBTyxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO0FBQ2xELFFBQUksQ0FBQyxlQUFlLEdBQUcsT0FBTyxDQUFDLGlCQUFpQixDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7O0FBRXhELFFBQUksQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsVUFBQSxDQUFDLEVBQUk7QUFDdkMsVUFBSSxDQUFDLENBQUMsRUFBRSxNQUFNLEtBQUssQ0FBQyxhQUFhLENBQUMsQ0FBQztLQUNwQyxDQUFDLENBQUM7O0FBRUgsUUFBSSxJQUFJLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsVUFBQSxDQUFDO2FBQUksTUFBSyxZQUFZO0tBQUEsQ0FBQyxDQUFDLElBQUksQ0FBQyxVQUFBLENBQUM7YUFBSSxDQUFDLENBQUMsS0FBSyxFQUFFLENBQUMsSUFBSSxFQUFFO0tBQUEsQ0FBQyxDQUFDOztBQUUvRSxRQUFJLENBQUMsS0FBSyxHQUFHLFNBQVMsQ0FBQzs7QUFFdkIsUUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLFVBQUEsSUFBSSxFQUFJO0FBQzVCLFVBQUksQ0FBQyxPQUFPLEdBQUcsSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO0FBQ3RDLGFBQU8sSUFBSSxDQUFDO0tBQ2IsQ0FBQyxDQUFDOztBQUVILFFBQUksQ0FBQyxVQUFVLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsVUFBQSxJQUFJO2FBQUksV0FBVyxHQUFHLElBQUksQ0FBQyxLQUFLO0tBQUEsQ0FBQyxDQUFDO0dBQ3BFOztlQXRCRyxPQUFPOztXQXdCRTs7OztrQkFDUCxJQUFJLENBQUMsS0FBSyxLQUFLLFNBQVMsQ0FBQTs7Ozs7OzRDQUNQLElBQUksQ0FBQyxlQUFlLENBQUMsSUFBSSxDQUFDLFVBQUEsQ0FBQztxQkFBSSxDQUFDLENBQUMsS0FBSyxFQUFFLENBQUMsSUFBSSxFQUFFO2FBQUEsQ0FBQzs7O0FBQW5FLGdCQUFJLENBQUMsS0FBSzs7O2dEQUdMLElBQUksQ0FBQyxLQUFLOzs7Ozs7O0tBQ2xCOzs7V0FFYywyQkFBRztBQUNoQixhQUFPLElBQUksQ0FBQyxlQUFlLENBQUMsSUFBSSxDQUFDLFVBQUEsQ0FBQztlQUFJLENBQUMsQ0FBQyxLQUFLLEVBQUU7T0FBQSxDQUFDLENBQUM7S0FDbEQ7OztXQUVnQztVQUMzQixJQUFJLEVBRUosZ0JBQWdCOzs7Ozs0Q0FGSCxJQUFJLENBQUMsT0FBTyxFQUFFOzs7QUFBM0IsZ0JBQUk7NkJBRWUsSUFBSSxDQUFDLGdCQUFnQjs7Ozs7Ozs7NENBQVcsT0FBTyxDQUFDLEdBQUcsQ0FBQyxrQkFBa0IsQ0FBQzs7Ozs7Ozs7Ozs7Ozs2QkFBSyxDQUFDOzs7QUFBeEYsNEJBQWdCOzs7O0FBSXBCLGdCQUFJLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxjQUFjLEVBQUUsVUFBQSxLQUFLLEVBQUk7O0FBRTNDLGtCQUFJLE1BQU0sR0FBRyxDQUFDLG9CQUFvQixDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxFQUFFLENBQUEsQ0FBRSxDQUFDLENBQUMsQ0FBQzs7QUFFekQsbUJBQUssR0FBRyxLQUFLLENBQUMsT0FBTyxDQUFDLHdCQUF3QixFQUFFLFVBQUMsU0FBUyxFQUFFLENBQUMsRUFBRSxXQUFXLEVBQUs7QUFDN0Usb0JBQUk7QUFDRixzQkFBSSxZQUFZLEdBQUcsTUFBTSxDQUFDLEtBQUssQ0FBQyxXQUFXLENBQUMsQ0FBQyxJQUFJLENBQUMsVUFBQyxDQUFDLEVBQUUsQ0FBQyxFQUFLO0FBQzFELDJCQUFPLENBQUMsQ0FBQyxPQUFPLEdBQUcsQ0FBQyxDQUFDLE9BQU8sR0FBRyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUM7bUJBQ3ZDLENBQUMsQ0FBQztBQUNILHNCQUFJLFdBQVcsR0FBRyxDQUFDLENBQUM7Ozs7Ozs7QUFFcEIseUNBQXVCLFlBQVksOEhBQUU7MEJBQTVCLFVBQVU7O0FBQ2pCLDBCQUFJLGdCQUFnQixHQUFHLFdBQVcsRUFBRTtBQUNsQyw4QkFBTSxHQUFHLFVBQVUsQ0FBQyxHQUFHLENBQUM7dUJBQ3pCO0FBQ0QsMEJBQUksZ0JBQWdCLElBQUksVUFBVSxDQUFDLE9BQU8sRUFBRTtBQUMxQyw4QkFBTTt1QkFDUDtBQUNELGlDQUFXLEdBQUcsVUFBVSxDQUFDLE9BQU8sQ0FBQztxQkFDbEM7Ozs7Ozs7Ozs7Ozs7OztpQkFDRixDQUNELE9BQU8sQ0FBQyxFQUFFLEVBQUU7O0FBRVosdUJBQU8sRUFBRSxDQUFDO2VBQ1gsQ0FBQyxDQUFDOztBQUVILGtCQUFJLE1BQU0sRUFBRTtBQUNWLHFCQUFLLEdBQUcsS0FBSyxDQUFDLE9BQU8sQ0FBQyxtQkFBbUIsWUFBVSxNQUFNLE9BQUksQ0FBQztlQUMvRDs7QUFFRCxxQkFBTyxLQUFLLENBQUM7YUFDZCxDQUFDLENBQUM7OzZCQUVRLFFBQVE7NkJBQUMsSUFBSTs7NENBQ04sSUFBSSxDQUFDLGVBQWU7Ozs4Q0FBRSxPQUFPOztBQUE3QyxxQkFBTzs7Ozs7Ozs7O0tBRVY7OztXQUVVO1VBQ0wsZ0JBQWdCLEVBQ2hCLEtBQUssRUFDTCxLQUFLLEVBQ0wsV0FBVyxFQUNYLGVBQWUsRUFDZixRQUFRLEVBQ1IsT0FBTyxFQUNQLEtBQUssRUFNTCxjQUFjOzs7Ozs7OzRDQWJXLElBQUksQ0FBQyxRQUFRLEVBQUU7OztBQUF4Qyw0QkFBZ0I7OzZCQUNGLE1BQU07OzRDQUFZLElBQUksQ0FBQyxVQUFVOzs7OzRDQUExQixJQUFJOzs7OztBQUF6QixpQkFBSztBQUNMLGlCQUFLLEdBQUcsb0NBQW9DOzs0Q0FFcEIsSUFBSSxDQUFDLDJCQUEyQixFQUFFOzs7QUFBMUQsMkJBQWU7OzRDQUNFLGVBQWUsQ0FBQyxLQUFLLEVBQUUsQ0FBQyxJQUFJLEVBQUU7OztBQUEvQyxvQkFBUTtBQUNSLG1CQUFPLEdBQUcsSUFBSSxHQUFHLEVBQUU7OzRDQUNKLElBQUksQ0FBQyxJQUFJOzs7QUFBeEIsaUJBQUssb0JBQXFCLEtBQUs7O0FBRW5DLG1CQUFPLFdBQVcsR0FBRyxLQUFLLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxFQUFFO0FBQ3pDLHFCQUFPLENBQUMsR0FBRyxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO2FBQzdCOzs2QkFJQyxLQUFLOzZCQUFLLGNBQWMsQ0FBQyxLQUFLLENBQUM7OzRDQUFTLElBQUksQ0FBQyxZQUFZOzs7OENBQUUsS0FBSzs0Q0FBMUQsR0FBRzs2QkFDVCxLQUFLLENBQUMsR0FBRyxDQUFDLGlCQUFpQixDQUFDLEtBQUssQ0FBQyxFQUFFLGVBQWUsQ0FBQztBQUhsRCwwQkFBYzs7QUFNbEIsbUJBQU8sQ0FBQyxPQUFPLENBQUMsVUFBQSxHQUFHLEVBQUk7QUFDckIsa0JBQUksT0FBTyxHQUFHLElBQUksT0FBTyxDQUFDLEdBQUcsRUFBRSxFQUFDLElBQUksRUFBRSxTQUFTLEVBQUMsQ0FBQyxDQUFDO0FBQ2xELDRCQUFjLENBQUMsSUFBSTs7OztBQUlqQixvQkFBTSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQyxJQUFJLENBQUMsVUFBQSxRQUFRO3VCQUFJLFFBQVEsSUFBSSxLQUFLLENBQUMsT0FBTyxDQUFDO2VBQUEsQ0FBQyxDQUFDLElBQUksQ0FBQyxVQUFBLFFBQVE7dUJBQUksS0FBSyxDQUFDLEdBQUcsQ0FBQyxPQUFPLEVBQUUsUUFBUSxDQUFDO2VBQUEsQ0FBQyxDQUNsSCxDQUFDO2FBQ0gsQ0FBQyxDQUFDOztnREFFSSxPQUFPLENBQUMsR0FBRyxDQUFDLGNBQWMsQ0FBQyxTQUFNLENBQUMsVUFBQSxHQUFHLEVBQUk7QUFDOUMsa0JBQUksQ0FBQyxnQkFBZ0IsRUFBRTtBQUNyQix1QkFBSyxPQUFPLEVBQUUsQ0FBQztlQUNoQjtBQUNELG9CQUFNLEdBQUcsQ0FBQzthQUNYLENBQUMsQ0FBQyxJQUFJLENBQUMsVUFBQSxDQUFDO3FCQUFJLFNBQVM7YUFBQSxDQUFDOzs7Ozs7O0tBQ3hCOzs7V0FFWTs7Ozs2QkFDSixNQUFNOzs0Q0FBYyxJQUFJLENBQUMsVUFBVTs7Ozs7Ozs7Ozs7S0FDM0M7OztXQUVhOzs7OzZCQUNMLE1BQU07OzRDQUFXLElBQUksQ0FBQyxVQUFVOzs7OytEQUF6QixHQUFHOzs7Ozs7O0tBQ2xCOzs7U0E3SEcsT0FBTzs7O0FBZ0liLElBQUksU0FBUyxHQUFHO0FBQ2QsUUFBTSxFQUFBLGdCQUFDLElBQUksRUFBRTtBQUNYLFdBQU8sS0FBSyxDQUFDLGlCQUFpQixHQUFHLElBQUksRUFBRTtBQUNyQyxpQkFBVyxFQUFFLFNBQVM7S0FDdkIsQ0FBQyxDQUFDLElBQUksQ0FBQyxVQUFBLENBQUM7YUFBSSxDQUFDLENBQUMsSUFBSSxFQUFFO0tBQUEsQ0FBQyxDQUFDO0dBQ3hCOztBQUVELEFBQU0sU0FBTyxFQUFBLGlCQUFDLElBQUk7OztRQUNoQixTQUFTO1FBSUwsT0FBTzs7Ozs7O3NFQUhYLEVBQUU7a0NBREYsU0FBUztBQUFULG1CQUFTLG1DQUFHLEtBQUs7O2dCQUViLFNBQVMsSUFBSSxFQUFFLFFBQVEsSUFBSSxJQUFJLENBQUEsQUFBQyxDQUFBOzs7Ozs4Q0FBUyxPQUFPLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyx1QkFBdUIsQ0FBQyxDQUFDOzs7QUFFdkYsaUJBQU8sR0FBRyxJQUFJLE9BQU8sQ0FBQyxJQUFJLEVBQUUsRUFBQyxTQUFTLEVBQVQsU0FBUyxFQUFDLENBQUM7OzBDQUN0QyxPQUFPLENBQUMsS0FBSzs7OzhDQUNaLE9BQU87Ozs7Ozs7R0FDZjs7QUFFRCxBQUFNLHNCQUFvQixFQUFBO1FBR3BCLFlBQVk7Ozs7OztjQUZWLFFBQVEsSUFBSSxJQUFJOzs7Ozs4Q0FBVSxFQUFFOzs7OzBDQUVSLE1BQU0sQ0FBQyxJQUFJLEVBQUU7OzsyQkFDN0IsVUFBQSxTQUFTO21CQUFJLFNBQVMsQ0FBQyxVQUFVLENBQUMsV0FBVyxDQUFDO1dBQUE7OzJCQUNqRCxVQUFBLFNBQVM7bUJBQUksU0FBUyxDQUFDLEtBQUssQ0FBQyxXQUFXLENBQUMsTUFBTSxDQUFDO1dBQUE7O0FBRm5ELHNCQUFZLG9CQUNiLE1BQU0saUJBQ04sR0FBRzs4Q0FFQyxPQUFPLENBQUMsR0FBRyxDQUNoQixZQUFZLENBQUMsR0FBRyxDQUFDLG9CQUFNLElBQUk7Z0JBQ3JCLFFBQVE7Ozs7O2tEQUFTLE1BQU0sQ0FBQyxLQUFLLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxDQUFDOzs7QUFBbkQsMEJBQVE7O3NCQUlQLFFBQVE7Ozs7O0FBQ1gsMkJBQVMsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7c0RBQ2pCLEtBQUs7OztBQUNiLG1CQUFDOztzREFFSyxRQUFRLENBQUMsSUFBSSxFQUFFOzs7Ozs7O1dBQ3ZCLENBQUMsQ0FDSCxDQUFDLElBQUksQ0FBQyxVQUFBLElBQUk7bUJBQUksSUFBSSxDQUFDLE1BQU0sQ0FBQyxVQUFBLEdBQUc7cUJBQUksR0FBRzthQUFBLENBQUM7V0FBQSxDQUFDOzs7Ozs7O0dBQ3hDOztBQUVELFNBQU8sRUFBQSxpQkFBQyxJQUFJLEVBQUU7QUFDWixXQUFPLE1BQU0sVUFBTyxDQUFDLFdBQVcsR0FBRyxJQUFJLENBQUMsQ0FBQztHQUMxQztDQUNGLENBQUM7O0FBRUYsTUFBTSxDQUFDLE9BQU8sR0FBRyxTQUFTLENBQUMiLCJmaWxlIjoiL1VzZXJzL2hlcm1hbncvRG9jdW1lbnRzL2hlcm13b25nL29mZmxpbmUtd2lraXBlZGlhL3B1YmxpYy9qcy9zaGFyZWQvd2lraXBlZGlhLmpzIiwic291cmNlc0NvbnRlbnQiOlsidmFyIHNyY3NldCA9IHJlcXVpcmUoJ3NyY3NldCcpO1xudmFyIHN0b3JhZ2UgPSByZXF1aXJlKCcuL3N0b3JhZ2UnKTtcblxudmFyIGNhY2hlUHJlZml4ID0gXCJ3aWtpb2ZmbGluZS1hcnRpY2xlLVwiO1xuXG5mdW5jdGlvbiBnZXRNZXRhUmVxdWVzdChuYW1lKSB7XG4gIHJldHVybiBuZXcgUmVxdWVzdCgnL3dpa2kvJyArIG5hbWUgKyAnLmpzb24nLCB7XG4gICAgY3JlZGVudGlhbHM6ICdpbmNsdWRlJyAvLyBuZWVkZWQgZm9yIGZsYWcgY29va2llc1xuICB9KTtcbn1cblxuZnVuY3Rpb24gZ2V0QXJ0aWNsZVJlcXVlc3QobmFtZSkge1xuICByZXR1cm4gbmV3IFJlcXVlc3QoJy93aWtpLycgKyBuYW1lICsgJy5pbmMnLCB7XG4gICAgY3JlZGVudGlhbHM6ICdpbmNsdWRlJyAvLyBuZWVkZWQgZm9yIGZsYWcgY29va2llc1xuICB9KTtcbn1cblxuY2xhc3MgQXJ0aWNsZSB7XG4gIGNvbnN0cnVjdG9yKG5hbWUsIHtcbiAgICBmcm9tQ2FjaGUgPSBmYWxzZVxuICB9PXt9KSB7XG4gICAgdmFyIGZldGNoZXIgPSBmcm9tQ2FjaGUgPyBjYWNoZXMubWF0Y2guYmluZChjYWNoZXMpIDogZmV0Y2g7XG4gICAgdGhpcy5fbWV0YVByb21pc2UgPSBmZXRjaGVyKGdldE1ldGFSZXF1ZXN0KG5hbWUpKTtcbiAgICB0aGlzLl9hcnRpY2xlUHJvbWlzZSA9IGZldGNoZXIoZ2V0QXJ0aWNsZVJlcXVlc3QobmFtZSkpO1xuXG4gICAgdGhpcy5yZWFkeSA9IHRoaXMuX21ldGFQcm9taXNlLnRoZW4ociA9PiB7XG4gICAgICBpZiAoIXIpIHRocm93IEVycm9yKCdObyByZXNwb25zZScpO1xuICAgIH0pO1xuXG4gICAgdmFyIGRhdGEgPSB0aGlzLnJlYWR5LnRoZW4oXyA9PiB0aGlzLl9tZXRhUHJvbWlzZSkudGhlbihyID0+IHIuY2xvbmUoKS5qc29uKCkpO1xuXG4gICAgdGhpcy5faHRtbCA9IHVuZGVmaW5lZDtcblxuICAgIHRoaXMubWV0YSA9IGRhdGEudGhlbihtZXRhID0+IHtcbiAgICAgIG1ldGEudXBkYXRlZCA9IG5ldyBEYXRlKG1ldGEudXBkYXRlZCk7XG4gICAgICByZXR1cm4gbWV0YTtcbiAgICB9KTtcblxuICAgIHRoaXMuX2NhY2hlTmFtZSA9IHRoaXMubWV0YS50aGVuKGRhdGEgPT4gY2FjaGVQcmVmaXggKyBkYXRhLnVybElkKTtcbiAgfVxuXG4gIGFzeW5jIGdldEh0bWwoKSB7XG4gICAgaWYgKHRoaXMuX2h0bWwgPT09IHVuZGVmaW5lZCkge1xuICAgICAgdGhpcy5faHRtbCA9IGF3YWl0IHRoaXMuX2FydGljbGVQcm9taXNlLnRoZW4ociA9PiByLmNsb25lKCkudGV4dCgpKTtcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcy5faHRtbDtcbiAgfVxuXG4gIGdldEh0bWxSZXNwb25zZSgpIHtcbiAgICByZXR1cm4gdGhpcy5fYXJ0aWNsZVByb21pc2UudGhlbihyID0+IHIuY2xvbmUoKSk7XG4gIH1cblxuICBhc3luYyBfY3JlYXRlQ2FjaGVBcnRpY2xlUmVzcG9uc2UoKSB7XG4gICAgdmFyIHRleHQgPSBhd2FpdCB0aGlzLmdldEh0bWwoKTtcbiAgICAvLyB3b3JrZXJzIGRvbid0IGhhdmUgYWNjZXNzIHRvIERQUlxuICAgIHZhciBkZXZpY2VQaXhlbFJhdGlvID0gc2VsZi5kZXZpY2VQaXhlbFJhdGlvIHx8IChhd2FpdCBzdG9yYWdlLmdldCgnZGV2aWNlUGl4ZWxSYXRpbycpKSB8fCAyO1xuXG4gICAgLy8geWVzIEknbSBwYXJzaW5nIEhUTUwgd2l0aCByZWdleCBtdWFoYWhhaGFcbiAgICAvLyBJJ20gZmxhdHRlbmluZyBzcmNzZXQgdG8gbWFrZSBpdCBkZXRlcm1pbmlzdGljXG4gICAgdGV4dCA9IHRleHQucmVwbGFjZSgvPGltZ1tePl0qPi9pZywgbWF0Y2ggPT4ge1xuICAgICAgLy8gc3RhcnQgd2l0aCB0aGUgaW1hZ2Ugc3JjIGFzIGRlbnNpdHkgMVxuICAgICAgdmFyIG5ld1NyYyA9ICgvc3JjPShbJ1wiXSkoLio/KVxcMS9pLmV4ZWMobWF0Y2gpIHx8IFtdKVsyXTtcblxuICAgICAgbWF0Y2ggPSBtYXRjaC5yZXBsYWNlKC9zcmNzZXQ9KFsnXCJdKSguKj8pXFwxL2lnLCAoc3Jjc2V0QWxsLCBfLCBzcmNzZXRJbm5lcikgPT4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIHZhciBwYXJzZWRTcmNzZXQgPSBzcmNzZXQucGFyc2Uoc3Jjc2V0SW5uZXIpLnNvcnQoKGEsIGIpID0+IHtcbiAgICAgICAgICAgIHJldHVybiBhLmRlbnNpdHkgPCBiLmRlbnNpdHkgPyAtMSA6IDE7XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgdmFyIGxhc3REZW5zaXR5ID0gMTtcblxuICAgICAgICAgIGZvciAodmFyIHNyY1NldEl0ZW0gb2YgcGFyc2VkU3Jjc2V0KSB7XG4gICAgICAgICAgICBpZiAoZGV2aWNlUGl4ZWxSYXRpbyA+IGxhc3REZW5zaXR5KSB7XG4gICAgICAgICAgICAgIG5ld1NyYyA9IHNyY1NldEl0ZW0udXJsO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGRldmljZVBpeGVsUmF0aW8gPD0gc3JjU2V0SXRlbS5kZW5zaXR5KSB7XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbGFzdERlbnNpdHkgPSBzcmNTZXRJdGVtLmRlbnNpdHk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlKSB7fVxuXG4gICAgICAgIHJldHVybiAnJztcbiAgICAgIH0pO1xuXG4gICAgICBpZiAobmV3U3JjKSB7XG4gICAgICAgIG1hdGNoID0gbWF0Y2gucmVwbGFjZSgvc3JjPShbJ1wiXSkuKj9cXDEvaWcsIGBzcmM9XCIke25ld1NyY31cImApO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gbWF0Y2g7XG4gICAgfSk7XG5cbiAgICByZXR1cm4gbmV3IFJlc3BvbnNlKHRleHQsIHtcbiAgICAgIGhlYWRlcnM6IChhd2FpdCB0aGlzLl9hcnRpY2xlUHJvbWlzZSkuaGVhZGVyc1xuICAgIH0pO1xuICB9XG5cbiAgYXN5bmMgY2FjaGUoKSB7XG4gICAgdmFyIHByZXZpb3VzbHlDYWNoZWQgPSBhd2FpdCB0aGlzLmlzQ2FjaGVkKCk7XG4gICAgdmFyIGNhY2hlID0gYXdhaXQgY2FjaGVzLm9wZW4oYXdhaXQgdGhpcy5fY2FjaGVOYW1lKTtcbiAgICB2YXIgaW1nUmUgPSAvPGltZ1tePl0qc3JjPShbJ1wiXSkoLio/KVxcMVtePl0qPi9pZztcbiAgICB2YXIgcmVnZXhSZXN1bHQ7XG4gICAgdmFyIGFydGljbGVSZXNwb25zZSA9IGF3YWl0IHRoaXMuX2NyZWF0ZUNhY2hlQXJ0aWNsZVJlc3BvbnNlKCk7XG4gICAgdmFyIGh0bWxUZXh0ID0gYXdhaXQgYXJ0aWNsZVJlc3BvbnNlLmNsb25lKCkudGV4dCgpO1xuICAgIHZhciBpbWdTcmNzID0gbmV3IFNldCgpO1xuICAgIHZhciB1cmxJZCA9IChhd2FpdCB0aGlzLm1ldGEpLnVybElkO1xuXG4gICAgd2hpbGUgKHJlZ2V4UmVzdWx0ID0gaW1nUmUuZXhlYyhodG1sVGV4dCkpIHtcbiAgICAgIGltZ1NyY3MuYWRkKHJlZ2V4UmVzdWx0WzJdKTtcbiAgICB9XG5cbiAgICB2YXIgY2FjaGVPcGVhdGlvbnMgPSBbXG4gICAgICAvLyBnZXQgYSBmcmVzaCByZXF1ZXN0LCBhcyBpdCBtYXkgaGF2ZSBvcmlnaW5hbGx5IGJlZW4gcmVkaXJlY3RlZFxuICAgICAgY2FjaGUucHV0KGdldE1ldGFSZXF1ZXN0KHVybElkKSwgKGF3YWl0IHRoaXMuX21ldGFQcm9taXNlKS5jbG9uZSgpKSxcbiAgICAgIGNhY2hlLnB1dChnZXRBcnRpY2xlUmVxdWVzdCh1cmxJZCksIGFydGljbGVSZXNwb25zZSlcbiAgICBdO1xuXG4gICAgaW1nU3Jjcy5mb3JFYWNoKHVybCA9PiB7XG4gICAgICB2YXIgcmVxdWVzdCA9IG5ldyBSZXF1ZXN0KHVybCwge21vZGU6ICduby1jb3JzJ30pO1xuICAgICAgY2FjaGVPcGVhdGlvbnMucHVzaChcbiAgICAgICAgLy8gVGhpcyBpcyBhIHdvcmthcm91bmQgdG8gaHR0cHM6Ly9jb2RlLmdvb2dsZS5jb20vcC9jaHJvbWl1bS9pc3N1ZXMvZGV0YWlsP2lkPTQ3NzY1OFxuICAgICAgICAvLyBPbmNlIHRoZSBidWcgaXMgZml4ZWQsIHdlIGNhbiBqdXN0IGRvIHRoaXM6XG4gICAgICAgIC8vIGZldGNoKHJlcXVlc3QpLnRoZW4ocmVzcG9uc2UgPT4gY2FjaGUucHV0KHJlcXVlc3QsIHJlc3BvbnNlKSlcbiAgICAgICAgY2FjaGVzLm1hdGNoKHJlcXVlc3QpLnRoZW4ocmVzcG9uc2UgPT4gcmVzcG9uc2UgfHwgZmV0Y2gocmVxdWVzdCkpLnRoZW4ocmVzcG9uc2UgPT4gY2FjaGUucHV0KHJlcXVlc3QsIHJlc3BvbnNlKSlcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICByZXR1cm4gUHJvbWlzZS5hbGwoY2FjaGVPcGVhdGlvbnMpLmNhdGNoKGVyciA9PiB7XG4gICAgICBpZiAoIXByZXZpb3VzbHlDYWNoZWQpIHtcbiAgICAgICAgdGhpcy51bmNhY2hlKCk7XG4gICAgICB9XG4gICAgICB0aHJvdyBlcnI7XG4gICAgfSkudGhlbihfID0+IHVuZGVmaW5lZCk7XG4gIH1cblxuICBhc3luYyB1bmNhY2hlKCkge1xuICAgIHJldHVybiBjYWNoZXMuZGVsZXRlKGF3YWl0IHRoaXMuX2NhY2hlTmFtZSk7XG4gIH1cblxuICBhc3luYyBpc0NhY2hlZCgpIHtcbiAgICByZXR1cm4gY2FjaGVzLmhhcyhhd2FpdCB0aGlzLl9jYWNoZU5hbWUpO1xuICB9XG59XG5cbnZhciB3aWtpcGVkaWEgPSB7XG4gIHNlYXJjaCh0ZXJtKSB7XG4gICAgcmV0dXJuIGZldGNoKCcvc2VhcmNoLmpzb24/cz0nICsgdGVybSwge1xuICAgICAgY3JlZGVudGlhbHM6ICdpbmNsdWRlJyAvLyBuZWVkZWQgZm9yIGZsYWcgY29va2llc1xuICAgIH0pLnRoZW4ociA9PiByLmpzb24oKSk7XG4gIH0sXG5cbiAgYXN5bmMgYXJ0aWNsZShuYW1lLCB7XG4gICAgZnJvbUNhY2hlID0gZmFsc2VcbiAgfT17fSkge1xuICAgIGlmIChmcm9tQ2FjaGUgJiYgISgnY2FjaGVzJyBpbiBzZWxmKSkgcmV0dXJuIFByb21pc2UucmVqZWN0KEVycm9yKFwiQ2FjaGluZyBub3Qgc3VwcG9ydGVkXCIpKTtcblxuICAgIHZhciBhcnRpY2xlID0gbmV3IEFydGljbGUobmFtZSwge2Zyb21DYWNoZX0pO1xuICAgIGF3YWl0IGFydGljbGUucmVhZHk7XG4gICAgcmV0dXJuIGFydGljbGU7XG4gIH0sXG5cbiAgYXN5bmMgZ2V0Q2FjaGVkQXJ0aWNsZURhdGEoKSB7XG4gICAgaWYgKCEoJ2NhY2hlcycgaW4gc2VsZikpIHJldHVybiBbXTtcblxuICAgIHZhciBhcnRpY2xlTmFtZXMgPSAoYXdhaXQgY2FjaGVzLmtleXMoKSlcbiAgICAgIC5maWx0ZXIoY2FjaGVOYW1lID0+IGNhY2hlTmFtZS5zdGFydHNXaXRoKGNhY2hlUHJlZml4KSlcbiAgICAgIC5tYXAoY2FjaGVOYW1lID0+IGNhY2hlTmFtZS5zbGljZShjYWNoZVByZWZpeC5sZW5ndGgpKTtcblxuICAgIHJldHVybiBQcm9taXNlLmFsbChcbiAgICAgIGFydGljbGVOYW1lcy5tYXAoYXN5bmMgbmFtZSA9PiB7XG4gICAgICAgIHZhciByZXNwb25zZSA9IGF3YWl0IGNhY2hlcy5tYXRjaChnZXRNZXRhUmVxdWVzdChuYW1lKSk7XG5cbiAgICAgICAgLy8gc2VlaW5nIGEgYnVnIHdoZXJlIHRoZSByZXNwb25zZSBoZXJlIGlzIGdvbmUgLSBub3Qgc3VyZSB3aHlcbiAgICAgICAgLy8gYnV0IEknbGwgZ3VhcmQgYWdhaW5zdCBpdFxuICAgICAgICBpZiAoIXJlc3BvbnNlKSB7XG4gICAgICAgICAgd2lraXBlZGlhLnVuY2FjaGUobmFtZSk7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiByZXNwb25zZS5qc29uKCk7XG4gICAgICB9KVxuICAgICkudGhlbih2YWxzID0+IHZhbHMuZmlsdGVyKHZhbCA9PiB2YWwpKTtcbiAgfSxcblxuICB1bmNhY2hlKG5hbWUpIHtcbiAgICByZXR1cm4gY2FjaGVzLmRlbGV0ZShjYWNoZVByZWZpeCArIG5hbWUpO1xuICB9XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IHdpa2lwZWRpYTsiXX0="],"preExistingComment":"//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9oZXJtYW53L0RvY3VtZW50cy9oZXJtd29uZy9vZmZsaW5lLXdpa2lwZWRpYS9wdWJsaWMvanMvc3cvaW5kZXguanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDO0FBQy9CLE9BQU8sQ0FBQyw4QkFBOEIsQ0FBQyxDQUFDO0FBQ3hDLElBQUksU0FBUyxHQUFHLE9BQU8sQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDO0FBQy9DLElBQUksT0FBTyxHQUFHLE9BQU8sQ0FBQyxtQkFBbUIsQ0FBQyxDQUFDOztBQUUzQyxJQUFJLE9BQU8sR0FBRyxJQUFJLENBQUM7QUFDbkIsSUFBSSxNQUFNLEdBQUcsYUFBYSxDQUFDO0FBQzNCLElBQUksZUFBZSxHQUFNLE1BQU0saUJBQVksT0FBTyxBQUFFLENBQUM7O0FBRXJELElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxTQUFTLEVBQUUsVUFBQSxLQUFLLEVBQUk7QUFDeEMsT0FBSyxDQUFDLFNBQVMsQ0FDYixNQUFNLENBQUMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxDQUFDLElBQUksQ0FBQyxVQUFBLEtBQUssRUFBSTtBQUN6QyxXQUFPLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FDbEIsR0FBRyxFQUNILGFBQWEsRUFDYixhQUFhLEVBQ2IsdUJBQXVCO0FBQ3ZCLHdCQUFvQjtBQUNwQixtQkFBZSxDQUNoQixDQUFDLENBQUMsSUFBSSxDQUFDO2FBQU0sS0FBSyxDQUFDLEtBQUssQ0FBQyxhQUFhLENBQUM7S0FBQSxDQUFDLENBQUMsSUFBSSxDQUFDLFVBQUEsUUFBUSxFQUFJOztBQUV6RCxhQUFPLFFBQVEsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxJQUFJLENBQUMsVUFBQSxJQUFJLEVBQUk7QUFDbEMsWUFBTSxTQUFTLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyx5Q0FBeUMsQ0FBQyxDQUFDO0FBQzFFLFlBQU0sVUFBVSxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMs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SUFBSSxDQUFDLGdCQUFnQixDQUFDLG1CQUFtQixFQUFFLFVBQVMsS0FBSyxFQUFFOztBQUV6RCxPQUFLLENBQUMsWUFBWSxDQUFDLEtBQUssRUFBRSxDQUFDO0FBQzNCLFNBQU8sQ0FBQyxVQUFVLENBQUksUUFBUSxDQUFDLE1BQU0sY0FBUyxLQUFLLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBRyxDQUFDO0NBQzFFLENBQUMsQ0FBQzs7QUFFSCxJQUFJLENBQUMsZ0JBQWdCLENBQUMsU0FBUyxFQUFFLFVBQUEsS0FBSyxFQUFJO0FBQ3hDLE1BQUksS0FBSyxDQUFDLElBQUksSUFBSSxhQUFhLEVBQUU7QUFDL0IsUUFBSSxDQUFDLFdBQVcsRUFBRSxDQUFDO0dBQ3BCO0NBQ0YsQ0FBQyxDQUFDIiwiZmlsZSI6Ii9Vc2Vycy9oZXJtYW53L0RvY3VtZW50cy9oZXJtd29uZy9vZmZsaW5lLXdpa2lwZWRpYS9wdWJsaWMvanMvc3cvaW5kZXguanMiLCJzb3VyY2VzQ29udGVudCI6WyJyZXF1aXJlKCdyZWdlbmVyYXRvci9ydW50aW1lJyk7XG5yZXF1aXJlKCdzZXJ2aWNld29ya2VyLWNhY2hlLXBvbHlmaWxsJyk7XG52YXIgd2lraXBlZGlhID0gcmVxdWlyZSgnLi4vc2hhcmVkL3dpa2lwZWRpYScpO1xudmFyIHN0b3JhZ2UgPSByZXF1aXJlKCcuLi9zaGFyZWQvc3RvcmFnZScpO1xuXG52YXIgdmVyc2lvbiA9ICcyNCc7XG52YXIgcHJlZml4ID0gJ3dpa2lvZmZsaW5lJztcbnZhciBzdGF0aWNDYWNoZU5hbWUgPSBgJHtwcmVmaXh9LXN0YXRpYy12JHt2ZXJzaW9ufWA7XG4gXG5zZWxmLmFkZEV2ZW50TGlzdGVuZXIoJ2luc3RhbGwnLCBldmVudCA9PiB7XG4gIGV2ZW50LndhaXRVbnRpbChcbiAgICBjYWNoZXMub3BlbihzdGF0aWNDYWNoZU5hbWUpLnRoZW4oY2FjaGUgPT4ge1xuICAgICAgcmV0dXJuIGNhY2hlLmFkZEFsbChbXG4gICAgICAgICcvJyxcbiAgICAgICAgJy9zaGVsbC5odG1sJyxcbiAgICAgICAgJy9qcy9wYWdlLmpzJyxcbiAgICAgICAgJy9qcy9wYWdlLWZyYW1ld29yay5qcycsIC8vIHllYWhoaGgsIHdlJ3JlIGNhY2hpbmcgd2FheXl5eXkgbW9yZSB0aGFuIHdlIG5lZWQsIGJ1dCBrZWVwcyB0aGUgcmVxdWVzdCB0ZXN0cyBmYWlyXG4gICAgICAgICcvY3NzL2hlYWQtd2lraS5jc3MnLCAvLyBkb24ndCBuZWVkIHRoaXMgd2hlbiBpdCdzIGlubGluZWQsIGJ1dCBoZWxwcyB3aGVuIHJlbmRlcmVkIHdpdGggYmxvY2tpbmcgQ1NTIGluIHNldHRpbmdzXG4gICAgICAgICcvY3NzL3dpa2kuY3NzJ1xuICAgICAgXSkudGhlbigoKSA9PiBjYWNoZS5tYXRjaCgnL3NoZWxsLmh0bWwnKSkudGhlbihyZXNwb25zZSA9PiB7XG4gICAgICAgIC8vIGJpdCBoYWNreSwgbWFraW5nIHRoZSBzaGVsbCBzdGFydCAmIGVuZCBmcm9tIHRoZSBzaGVsbCBqdXN0IGZldGNoZWRcbiAgICAgICAgcmV0dXJuIHJlc3BvbnNlLnRleHQoKS50aGVuKHRleHQgPT4ge1xuICAgICAgICAgIGNvbnN0IGhlYWRlckVuZCA9IHRleHQuaW5kZXhPZignPGRpdiBjbGFzcz1cImFydGljbGUtaGVhZGVyIHN1YmhlYWRpbmdcIj4nKTtcbiAgICAgICAgICBjb25zdCBhcnRpY2xlRW5kID0gdGV4dC5pbmRleE9mKCc8ZGl2IGNsYXNzPVwiYmFja2dyb3VuZC1sb2FkLW9mZmVyIGNhcmRcIj4nKTtcbiAgICAgICAgICByZXR1cm4gUHJvbWlzZS5hbGwoW1xuICAgICAgICAgICAgY2FjaGUucHV0KCcvc2hlbGwtc3RhcnQuaHRtbCcsIG5ldyBSZXNwb25zZSh0ZXh0LnNsaWNlKDAsIGhlYWRlckVuZCksIHJlc3BvbnNlKSksXG4gICAgICAgICAgICBjYWNoZS5wdXQoJy9zaGVsbC1lbmQuaHRtbCcsIG5ldyBSZXNwb25zZSh0ZXh0LnNsaWNlKGFydGljbGVFbmQpLCByZXNwb25zZSkpXG4gICAgICAgICAgXSk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfSlcbiAgKTtcbn0pO1xuXG52YXIgZXhwZWN0ZWRDYWNoZXMgPSBbXG4gIHN0YXRpY0NhY2hlTmFtZVxuXTtcblxuc2VsZi5hZGRFdmVudExpc3RlbmVyKCdhY3RpdmF0ZScsIGV2ZW50ID0+IHtcbiAgZXZlbnQud2FpdFVudGlsKFxuICAgIGNhY2hlcy5rZXlzKCkudGhlbihrZXlzID0+IHtcbiAgICAgIHJldHVybiBQcm9taXNlLmFsbChcbiAgICAgICAga2V5cy5tYXAoa2V5ID0+IHtcbiAgICAgICAgICBpZiAoa2V5LnN0YXJ0c1dpdGgocHJlZml4ICsgJy0nKVxuICAgICAgICAgICAgJiYgIWtleS5zdGFydHNXaXRoKGAke3ByZWZpeH0tYXJ0aWNsZS1gKVxuICAgICAgICAgICAgJiYgZXhwZWN0ZWRDYWNoZXMuaW5kZXhPZihrZXkpID09IC0xKSB7XG4gICAgICAgICAgICByZXR1cm4gY2FjaGVzLmRlbGV0ZShrZXkpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICAgICk7XG4gICAgfSlcbiAgKTtcbn0pO1xuXG4vLyBUaGlzIHdpbGwgdmFuaXNoIHdoZW4gdGhlIFNlcnZpY2VXb3JrZXIgY2xvc2VzLFxuLy8gYnV0IHRoYXQncyBjb29sLCBJIHdhbnQgdGhhdC5cbnZhciBkYXRhVG1wQ2FjaGUgPSB7fTtcblxuc2VsZi5hZGRFdmVudExpc3RlbmVyKCdmZXRjaCcsIGV2ZW50ID0+IHtcbiAgdmFyIHJlcXVlc3RVUkwgPSBuZXcgVVJMKGV2ZW50LnJlcXVlc3QudXJsKTtcblxuICAvLyBjYXRjaCB0aGUgcm9vdCByZXF1ZXN0XG4gIGlmIChyZXF1ZXN0VVJMLm9yaWdpbiA9PSBsb2NhdGlvbi5vcmlnaW4pIHtcbiAgICBpZiAocmVxdWVzdFVSTC5wYXRobmFtZSA9PSAnLycpIHtcbiAgICAgIGV2ZW50LnJlc3BvbmRXaXRoKGNhY2hlcy5tYXRjaCgnLycpKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKHJlcXVlc3RVUkwucGF0aG5hbWUuc3RhcnRzV2l0aCgnL3dpa2kvJykpIHtcbiAgICAgIGlmICgvXFwuKG1pZGRsZS5pbmMpJC8udGVzdChyZXF1ZXN0VVJMLnBhdGhuYW1lKSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGlmICgvXFwuKGpzb258aW5jKSQvLnRlc3QocmVxdWVzdFVSTC5wYXRobmFtZSkpIHtcbiAgICAgICAgaWYgKGRhdGFUbXBDYWNoZVtyZXF1ZXN0VVJMLmhyZWZdKSB7XG4gICAgICAgICAgdmFyIHJlc3BvbnNlID0gZGF0YVRtcENhY2hlW3JlcXVlc3RVUkwuaHJlZl07XG4gICAgICAgICAgZGVsZXRlIGRhdGFUbXBDYWNoZVtyZXF1ZXN0VVJMLmhyZWZdO1xuICAgICAgICAgIGV2ZW50LnJlc3BvbmRXaXRoKHJlc3BvbnNlKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGlmIChyZXF1ZXN0VVJMLnNlYXJjaC5pbmNsdWRlcygnc3ctc3RyZWFtJykpIHtcbiAgICAgICAgZXZlbnQucmVzcG9uZFdpdGgoc3RyZWFtQXJ0aWNsZShyZXF1ZXN0VVJMKSk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgLy8gR2V0IGFoZWFkIG9mIHRoZSBwYWNrIGJ5IHN0YXJ0aW5nIHRoZSBqc29uIHJlcXVlc3Qgbm93XG4gICAgICBpZiAoIXJlcXVlc3RVUkwuc2VhcmNoLmluY2x1ZGVzKCduby1wcmVmZXRjaCcpKSB7XG4gICAgICAgIHZhciBqc29uVVJMID0gbmV3IFVSTChyZXF1ZXN0VVJMKTtcbiAgICAgICAganNvblVSTC5wYXRobmFtZSArPSAnLmpzb24nO1xuICAgICAgICBqc29uVVJMLnNlYXJjaCA9ICcnO1xuICAgICAgICB2YXIgaW5jVVJMID0gbmV3IFVSTChyZXF1ZXN0VVJMKTtcbiAgICAgICAgaW5jVVJMLnBhdGhuYW1lICs9ICcuaW5jJztcbiAgICAgICAgaW5jVVJMLnNlYXJjaCA9ICcnO1xuICAgICAgICBkYXRhVG1wQ2FjaGVbanNvblVSTC5ocmVmXSA9IGZldGNoKGpzb25VUkwsIHtcbiAgICAgICAgICBjcmVkZW50aWFsczogJ2luY2x1ZGUnIC8vIG5lZWRlZCBmb3IgZmxhZyBjb29raWVzXG4gICAgICAgIH0pO1xuICAgICAgICBkYXRhVG1wQ2FjaGVbaW5jVVJMLmhyZWZdID0gZmV0Y2goaW5jVVJMLCB7XG4gICAgICAgICAgY3JlZGVudGlhbHM6ICdpbmNsdWRlJyAvLyBuZWVkZWQgZm9yIGZsYWcgY29va2llc1xuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgZXZlbnQucmVzcG9uZFdpdGgoY2FjaGVzLm1hdGNoKCcvc2hlbGwuaHRtbCcpKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gIH1cblxuICAvLyBkZWZhdWx0IGZldGNoIGJlaGF2aW91clxuICBldmVudC5yZXNwb25kV2l0aChcbiAgICBjYWNoZXMubWF0Y2goZXZlbnQucmVxdWVzdCkudGhlbihyZXNwb25zZSA9PiB7XG4gICAgICByZXR1cm4gcmVzcG9uc2UgfHwgZmV0Y2goZXZlbnQucmVxdWVzdCk7XG4gICAgfSlcbiAgKTtcbn0pO1xuXG5mdW5jdGlvbiBzdHJlYW1BcnRpY2xlKHVybCkge1xuICB0cnkge1xuICAgIG5ldyBSZWFkYWJsZVN0cmVhbSh7fSk7XG4gIH1cbiAgY2F0Y2goZSkge1xuICAgIHJldHVybiBuZXcgUmVzcG9uc2UoXCJTdHJlYW1zIG5vdCBzdXBwb3J0ZWRcIik7XG4gIH1cbiAgY29uc3Qgc3RyZWFtID0gbmV3IFJlYWRhYmxlU3RyZWFtKHtcbiAgICBzdGFydChjb250cm9sbGVyKSB7XG4gICAgICBjb25zdCBjb250ZW50VVJMID0gbmV3IFVSTCh1cmwpO1xuICAgICAgY29udGVudFVSTC5wYXRobmFtZSArPSAnLm1pZGRsZS5pbmMnO1xuICAgICAgY29uc3Qgc3RhcnRGZXRjaCA9IGNhY2hlcy5tYXRjaCgnL3NoZWxsLXN0YXJ0Lmh0bWwnKTtcbiAgICAgIGNvbnN0IGNvbnRlbnRGZXRjaCA9IGZldGNoKGNvbnRlbnRVUkwpLmNhdGNoKCgpID0+IG5ldyBSZXNwb25zZShcIkZhaWxlZCwgc296XCIpKTtcbiAgICAgIGNvbnN0IGVuZEZldGNoID0gY2FjaGVzLm1hdGNoKCcvc2hlbGwtZW5kLmh0bWwnKTtcblxuICAgICAgZnVuY3Rpb24gcHVzaFN0cmVhbShzdHJlYW0pIHtcbiAgICAgICAgY29uc3QgcmVhZGVyID0gc3RyZWFtLmdldFJlYWRlcigpO1xuICAgICAgICBmdW5jdGlvbiByZWFkKCkge1xuICAgICAgICAgIHJldHVybiByZWFkZXIucmVhZCgpLnRoZW4ocmVzdWx0ID0+IHtcbiAgICAgICAgICAgIGlmIChyZXN1bHQuZG9uZSkgcmV0dXJuO1xuICAgICAgICAgICAgY29udHJvbGxlci5lbnF1ZXVlKHJlc3VsdC52YWx1ZSk7XG4gICAgICAgICAgICByZXR1cm4gcmVhZCgpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiByZWFkKCk7XG4gICAgICB9XG5cbiAgICAgIHN0YXJ0RmV0Y2hcbiAgICAgICAgLnRoZW4ocmVzcG9uc2UgPT4gcHVzaFN0cmVhbShyZXNwb25zZS5ib2R5KSlcbiAgICAgICAgLnRoZW4oKCkgPT4gY29udGVudEZldGNoKVxuICAgICAgICAudGhlbihyZXNwb25zZSA9PiBwdXNoU3RyZWFtKHJlc3BvbnNlLmJvZHkpKVxuICAgICAgICAudGhlbigoKSA9PiBlbmRGZXRjaClcbiAgICAgICAgLnRoZW4ocmVzcG9uc2UgPT4gcHVzaFN0cmVhbShyZXNwb25zZS5ib2R5KSlcbiAgICAgICAgLnRoZW4oKCkgPT4gY29udHJvbGxlci5jbG9zZSgpKTtcbiAgICB9XG4gIH0pO1xuXG4gIHJldHVybiBuZXcgUmVzcG9uc2Uoc3RyZWFtLCB7XG4gICAgaGVhZGVyczogeydDb250ZW50LVR5cGUnOiAndGV4dC9odG1sJ31cbiAgfSlcbn1cblxuc2VsZi5hZGRFdmVudExpc3RlbmVyKCdzeW5jJywgZXZlbnQgPT4ge1xuICAvLyBNeSB1c2Ugb2Ygc3RvcmFnZSBoZXJlIGhhcyByYWNlIGNvbmRpdGlvbnMuIE1laC5cbiAgY29uc29sZS5sb2coXCJHb29kIGxvcmQsIGEgc3luYyBldmVudFwiKTtcblxuICBldmVudC53YWl0VW50aWwoXG4gICAgc3RvcmFnZS5nZXQoJ3RvLWJnLWNhY2hlJykudGhlbih0b0NhY2hlID0+IHtcbiAgICAgIHRvQ2FjaGUgPSB0b0NhY2hlIHx8IFtdO1xuXG4gICAgICByZXR1cm4gUHJvbWlzZS5hbGwodG9DYWNoZS5tYXAoYXN5bmMgYXJ0aWNsZU5hbWUgPT4ge1xuICAgICAgICB2YXIgYXJ0aWNsZSA9IGF3YWl0IHdpa2lwZWRpYS5hcnRpY2xlKGFydGljbGVOYW1lKTtcbiAgICAgICAgYXdhaXQgYXJ0aWNsZS5jYWNoZSgpO1xuICAgICAgICByZWdpc3RyYXRpb24uc2hvd05vdGlmaWNhdGlvbigoYXdhaXQgYXJ0aWNsZS5tZXRhKS50aXRsZSArIFwiIHJlYWR5IVwiLCB7XG4gICAgICAgICAgaWNvbjogXCIvaW1ncy93aWtpcGVkaWEtMTkyLnBuZ1wiLFxuICAgICAgICAgIGJvZHk6IFwiVmlldyB0aGUgYXJ0aWNsZVwiLFxuICAgICAgICAgIGRhdGE6IChhd2FpdCBhcnRpY2xlLm1ldGEpLnVybElkXG4gICAgICAgIH0pO1xuICAgICAgfSkpO1xuICAgIH0pLnRoZW4oXyA9PiB7XG4gICAgICBzdG9yYWdlLnNldCgndG8tYmctY2FjaGUnLCBbXSk7XG4gICAgfSlcbiAgKTtcbn0pO1xuXG5zZWxmLmFkZEV2ZW50TGlzdGVuZXIoJ25vdGlmaWNhdGlvbmNsaWNrJywgZnVuY3Rpb24oZXZlbnQpIHtcbiAgLy8gYXNzdW1pbmcgb25seSBvbmUgdHlwZSBvZiBub3RpZmljYXRpb24gcmlnaHQgbm93XG4gIGV2ZW50Lm5vdGlmaWNhdGlvbi5jbG9zZSgpO1xuICBjbGllbnRzLm9wZW5XaW5kb3coYCR7bG9jYXRpb24ub3JpZ2lufS93aWtpLyR7ZXZlbnQubm90aWZpY2F0aW9uLmRhdGF9YCk7XG59KTtcblxuc2VsZi5hZGRFdmVudExpc3RlbmVyKCdtZXNzYWdlJywgZXZlbnQgPT4ge1xuICBpZiAoZXZlbnQuZGF0YSA9PSAnc2tpcFdhaXRpbmcnKSB7XG4gICAgc2VsZi5za2lwV2FpdGluZygpO1xuICB9XG59KTsiXX0="}