{"version":3,"sources":["wikipedia/index.js"],"names":[],"mappings":"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","file":"index.js","sourcesContent":["var querystring = require('querystring');\nvar RSVP = require('rsvp');\nvar request = require('request');\nvar requestPromise = RSVP.denodeify(request);\nvar replaceStream = require('replacestream');\n\nvar apiBase = 'https://en.wikipedia.org/w/api.php?';\nvar viewBase = 'https://en.m.wikipedia.org/wiki/';\n\nmodule.exports = {\n  apiBase,\n\n  getMetaData(name) {\n    return requestPromise(apiBase + querystring.stringify({\n      action: 'query',\n      titles: name,\n      format: 'json',\n      redirects: 'resolve',\n      prop: 'extracts|revisions',\n      explaintext: 1,\n      exsentences: 1\n    })).then(r => JSON.parse(r.body)).then(data => {\n      var page = data.query.pages[Object.keys(data.query.pages)[0]];\n      \n      if ('missing' in page) {\n        return {err: \"Not found\"};\n      }\n\n      return {\n        title: page.title,\n        extract: page.extract,\n        urlId: page.title.replace(/\\s/g, '_'),\n        updated: page.revisions[0].timestamp\n      };\n    });\n  },\n\n  search(term) {\n    return requestPromise(apiBase + querystring.stringify({\n      action: 'opensearch',\n      search: term,\n      format: 'json',\n      redirects: 'resolve',\n      limit: 4\n    })).then(r => JSON.parse(r.body)).then(([term, pageTitles, descriptions, urls]) => {\n      return pageTitles.map((title, i) => {\n        return {\n          title,\n          description: descriptions[i],\n          id: /en.wikipedia.org\\/wiki\\/(.+)$/.exec(urls[i])[1]\n        }\n      });\n    });\n  },\n\n  getArticle(name) {\n    return requestPromise(viewBase + name + '?action=render')\n      .then(r => r.body.replace(/\\/\\/en\\.wikipedia\\.org\\/wiki\\//g, '/wiki/'));\n  },\n\n  getArticleStream(name) {\n    return request(viewBase + name + '?action=render').pipe(replaceStream('//en.wikipedia.org/wiki/', '/wiki/'));\n  }\n};"]}